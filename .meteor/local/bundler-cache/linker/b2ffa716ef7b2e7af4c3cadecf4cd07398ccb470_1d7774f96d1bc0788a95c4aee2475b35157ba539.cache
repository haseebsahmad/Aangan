[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar ReactiveVar = Package['reactive-var'].ReactiveVar;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar HTTP = Package.http.HTTP;\nvar DDP = Package['ddp-client'].DDP;\nvar Mongo = Package.mongo.Mongo;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar Random = Package.random.Random;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Promise = Package.promise.Promise;\n\n/* Package-scope variables */\nvar FilesCollection;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"ostrio:files\":{\"client.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/client.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  FilesCollection: () => FilesCollection\n});\nlet Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet DDP;\nmodule.link(\"meteor/ddp-client\", {\n  DDP(v) {\n    DDP = v;\n  }\n\n}, 2);\nlet Cookies;\nmodule.link(\"meteor/ostrio:cookies\", {\n  Cookies(v) {\n    Cookies = v;\n  }\n\n}, 3);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 4);\nlet UploadInstance;\nmodule.link(\"./upload.js\", {\n  UploadInstance(v) {\n    UploadInstance = v;\n  }\n\n}, 5);\nlet FilesCollectionCore;\nmodule.link(\"./core.js\", {\n  default(v) {\n    FilesCollectionCore = v;\n  }\n\n}, 6);\nlet formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL(v) {\n    formatFleURL = v;\n  },\n\n  helpers(v) {\n    helpers = v;\n  }\n\n}, 7);\n\nconst NOOP = () => {};\n\nconst allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\n\nclass FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n\n    if (config) {\n      Object.keys(config).forEach(param => {\n        if (allowedParams.includes(param)) {\n          this[param] = config[param];\n        }\n      });\n    }\n\n    const self = this;\n    const cookie = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies\n    });\n\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, \"[FilesCollection.\".concat(this.collectionName, \"]: \\\"downloadRoute\\\" must be precisely provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal or be inside of your web/proxy-server (relative) root.\"));\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, {\n          path: '/',\n          sameSite: 'Lax'\n        });\n\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect(conn => {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {\n          type: 'application/javascript'\n        }));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n    this._methodNames = {\n      _Abort: \"_FilesCollectionAbort_\".concat(this.collectionName),\n      _Write: \"_FilesCollectionWrite_\".concat(this.collectionName),\n      _Start: \"_FilesCollectionStart_\".concat(this.collectionName),\n      _Remove: \"_FilesCollectionRemove_\".concat(this.collectionName)\n    };\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n\n\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n\n    if (helpers.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n\n    return mime;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n\n\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n\n      userId: null\n    };\n\n    if (helpers.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n\n\n  insert(config) {\n    let autoStart = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n\n    return new UploadInstance(config, this)[autoStart ? 'start' : 'manual']();\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n\n\n  remove() {\n    let selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n\n    this._debug(\"[FilesCollection] [remove(\".concat(JSON.stringify(selector), \")]\"));\n\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, callback || NOOP);\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', function (fileRef) {\n      let _version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n      let _URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      const version = !helpers.isString(_version) ? 'original' : _version;\n      const URIBase = !helpers.isString(_URIBase) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"core.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/core.js                                                                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  default: () => FilesCollectionCore\n});\nlet EventEmitter;\nmodule.link(\"eventemitter3\", {\n  EventEmitter(v) {\n    EventEmitter = v;\n  }\n\n}, 0);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 1);\nlet formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL(v) {\n    formatFleURL = v;\n  },\n\n  helpers(v) {\n    helpers = v;\n  }\n\n}, 2);\nlet FilesCursor, FileCursor;\nmodule.link(\"./cursor.js\", {\n  FilesCursor(v) {\n    FilesCursor = v;\n  },\n\n  FileCursor(v) {\n    FileCursor = v;\n  }\n\n}, 3);\n\nclass FilesCollectionCore extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _debug() {\n    if (this.debug) {\n      (console.info || console.log || function () {}).apply(void 0, arguments);\n    }\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n\n\n  _getFileName(fileData) {\n    const fileName = fileData.name || fileData.fileName;\n\n    if (helpers.isString(fileName) && fileName.length > 0) {\n      return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n    }\n\n    return '';\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n\n\n  _getExt(fileName) {\n    if (fileName.includes('.')) {\n      const extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n      return {\n        ext: extension,\n        extension,\n        extensionWithDot: \".\".concat(extension)\n      };\n    }\n\n    return {\n      ext: '',\n      extension: '',\n      extensionWithDot: ''\n    };\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n\n\n  _updateFileTypes(data) {\n    data.isVideo = /^video\\//i.test(data.type);\n    data.isAudio = /^audio\\//i.test(data.type);\n    data.isImage = /^image\\//i.test(data.type);\n    data.isText = /^text\\//i.test(data.type);\n    data.isJSON = /^application\\/json$/i.test(data.type);\n    data.isPDF = /^application\\/(x-)?pdf$/i.test(data.type);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n\n\n  _dataToSchema(data) {\n    const ds = {\n      name: data.name,\n      extension: data.extension,\n      ext: data.extension,\n      extensionWithDot: '.' + data.extension,\n      path: data.path,\n      meta: data.meta,\n      type: data.type,\n      mime: data.type,\n      'mime-type': data.type,\n      size: data.size,\n      userId: data.userId || null,\n      versions: {\n        original: {\n          path: data.path,\n          size: data.size,\n          type: data.type,\n          extension: data.extension\n        }\n      },\n      _downloadRoute: data._downloadRoute || this.downloadRoute,\n      _collectionName: data._collectionName || this.collectionName\n    }; //Optional fileId\n\n    if (data.fileId) {\n      ds._id = data.fileId;\n    }\n\n    this._updateFileTypes(ds);\n\n    ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n    return ds;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n\n\n  findOne() {\n    let selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n\n    this._debug(\"[FilesCollection] [findOne(\".concat(JSON.stringify(selector), \", \").concat(JSON.stringify(options), \")]\"));\n\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n    const doc = this.collection.findOne(selector, options);\n\n    if (doc) {\n      return new FileCursor(doc, this);\n    }\n\n    return doc;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n\n\n  find() {\n    let selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n\n    this._debug(\"[FilesCollection] [find(\".concat(JSON.stringify(selector), \", \").concat(JSON.stringify(options), \")]\"));\n\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n    return new FilesCursor(selector, options, this);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n\n\n  update() {\n    this.collection.update.apply(this.collection, arguments);\n    return this.collection;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n\n\n  link(fileRef) {\n    let version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n    let URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n    this._debug(\"[FilesCollection] [link(\".concat(helpers.isObject(fileRef) ? fileRef._id : void 0, \", \").concat(version, \")]\"));\n\n    check(fileRef, Object);\n\n    if (!fileRef) {\n      return '';\n    }\n\n    return formatFleURL(fileRef, version, URIBase);\n  }\n\n}\n\nFilesCollectionCore.__helpers = helpers;\nFilesCollectionCore.schema = {\n  _id: {\n    type: String\n  },\n  size: {\n    type: Number\n  },\n  name: {\n    type: String\n  },\n  type: {\n    type: String\n  },\n  path: {\n    type: String\n  },\n  isVideo: {\n    type: Boolean\n  },\n  isAudio: {\n    type: Boolean\n  },\n  isImage: {\n    type: Boolean\n  },\n  isText: {\n    type: Boolean\n  },\n  isJSON: {\n    type: Boolean\n  },\n  isPDF: {\n    type: Boolean\n  },\n  extension: {\n    type: String,\n    optional: true\n  },\n  ext: {\n    type: String,\n    optional: true\n  },\n  extensionWithDot: {\n    type: String,\n    optional: true\n  },\n  mime: {\n    type: String,\n    optional: true\n  },\n  'mime-type': {\n    type: String,\n    optional: true\n  },\n  _storagePath: {\n    type: String\n  },\n  _downloadRoute: {\n    type: String\n  },\n  _collectionName: {\n    type: String\n  },\n  public: {\n    type: Boolean,\n    optional: true\n  },\n  meta: {\n    type: Object,\n    blackbox: true,\n    optional: true\n  },\n  userId: {\n    type: String,\n    optional: true\n  },\n  updatedAt: {\n    type: Date,\n    optional: true\n  },\n  versions: {\n    type: Object,\n    blackbox: true\n  }\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"cursor.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/cursor.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  FileCursor: () => FileCursor,\n  FilesCursor: () => FilesCursor\n});\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\n\nclass FileCursor {\n  constructor(_fileRef, _collection) {\n    this._fileRef = _fileRef;\n    this._collection = _collection;\n    Object.assign(this, _fileRef);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Remove document\n   * @returns {FileCursor}\n   */\n\n\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FileCursor] [remove()]');\n\n    if (this._fileRef) {\n      this._collection.remove(this._fileRef._id, callback);\n    } else {\n      callback && callback(new Meteor.Error(404, 'No such file'));\n    }\n\n    return this;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name link\n   * @param version {String} - Name of file's subversion\n   * @param URIBase {String} - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL to File\n   * @returns {String}\n   */\n\n\n  link() {\n    let version = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'original';\n    let URIBase = arguments.length > 1 ? arguments[1] : undefined;\n\n    this._collection._debug(\"[FilesCollection] [FileCursor] [link(\".concat(version, \")]\"));\n\n    if (this._fileRef) {\n      return this._collection.link(this._fileRef, version, URIBase);\n    }\n\n    return '';\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name get\n   * @param property {String} - Name of sub-object property\n   * @summary Returns current document as a plain Object, if `property` is specified - returns value of sub-object property\n   * @returns {Object|mix}\n   */\n\n\n  get(property) {\n    this._collection._debug(\"[FilesCollection] [FileCursor] [get(\".concat(property, \")]\"));\n\n    if (property) {\n      return this._fileRef[property];\n    }\n\n    return this._fileRef;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name fetch\n   * @summary Returns document as plain Object in Array\n   * @returns {[Object]}\n   */\n\n\n  fetch() {\n    this._collection._debug('[FilesCollection] [FileCursor] [fetch()]');\n\n    return [this._fileRef];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name with\n   * @summary Returns reactive version of current FileCursor, useful to use with `{{#with}}...{{/with}}` block template helper\n   * @returns {[Object]}\n   */\n\n\n  with() {\n    this._collection._debug('[FilesCollection] [FileCursor] [with()]');\n\n    return Object.assign(this, this._collection.collection.findOne(this._fileRef._id));\n  }\n\n}\n\nclass FilesCursor {\n  constructor() {\n    let _selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    let options = arguments.length > 1 ? arguments[1] : undefined;\n\n    let _collection = arguments.length > 2 ? arguments[2] : undefined;\n\n    this._collection = _collection;\n    this._selector = _selector;\n    this._current = -1;\n    this.cursor = this._collection.collection.find(this._selector, options);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name get\n   * @summary Returns all matching document(s) as an Array. Alias of `.fetch()`\n   * @returns {[Object]}\n   */\n\n\n  get() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [get()]');\n\n    return this.cursor.fetch();\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasNext\n   * @summary Returns `true` if there is next item available on Cursor\n   * @returns {Boolean}\n   */\n\n\n  hasNext() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasNext()]');\n\n    return this._current < this.cursor.count() - 1;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name next\n   * @summary Returns next item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n\n\n  next() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [next()]');\n\n    this.cursor.fetch()[++this._current];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasPrevious\n   * @summary Returns `true` if there is previous item available on Cursor\n   * @returns {Boolean}\n   */\n\n\n  hasPrevious() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasPrevious()]');\n\n    return this._current !== -1;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name previous\n   * @summary Returns previous item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n\n\n  previous() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [previous()]');\n\n    this.cursor.fetch()[--this._current];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name fetch\n   * @summary Returns all matching document(s) as an Array.\n   * @returns {[Object]}\n   */\n\n\n  fetch() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [fetch()]');\n\n    return this.cursor.fetch() || [];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name first\n   * @summary Returns first item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n\n\n  first() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [first()]');\n\n    this._current = 0;\n    return this.fetch()[this._current];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name last\n   * @summary Returns last item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n\n\n  last() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [last()]');\n\n    this._current = this.count() - 1;\n    return this.fetch()[this._current];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name count\n   * @summary Returns the number of documents that match a query\n   * @returns {Number}\n   */\n\n\n  count() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [count()]');\n\n    return this.cursor.count();\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Removes all documents that match a query\n   * @returns {FilesCursor}\n   */\n\n\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [remove()]');\n\n    this._collection.remove(this._selector, callback);\n\n    return this;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name forEach\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Call `callback` once for each matching document, sequentially and synchronously.\n   * @returns {undefined}\n   */\n\n\n  forEach(callback) {\n    let context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    this._collection._debug('[FilesCollection] [FilesCursor] [forEach()]');\n\n    this.cursor.forEach(callback, context);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name each\n   * @summary Returns an Array of FileCursor made for each document on current cursor\n   *          Useful when using in {{#each FilesCursor#each}}...{{/each}} block template helper\n   * @returns {[FileCursor]}\n   */\n\n\n  each() {\n    return this.map(file => {\n      return new FileCursor(file, this._collection);\n    });\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name map\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Map `callback` over all matching documents. Returns an Array.\n   * @returns {Array}\n   */\n\n\n  map(callback) {\n    let context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    this._collection._debug('[FilesCollection] [FilesCursor] [map()]');\n\n    return this.cursor.map(callback, context);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name current\n   * @summary Returns current item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n\n\n  current() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [current()]');\n\n    if (this._current < 0) {\n      this._current = 0;\n    }\n\n    return this.fetch()[this._current];\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observe\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observe\n   * @returns {Object} - live query handle\n   */\n\n\n  observe(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observe()]');\n\n    return this.cursor.observe(callbacks);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observeChanges\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes. Only the differences between the old and new documents are passed to the callbacks.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observeChanges\n   * @returns {Object} - live query handle\n   */\n\n\n  observeChanges(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observeChanges()]');\n\n    return this.cursor.observeChanges(callbacks);\n  }\n\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/lib.js                                                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  fixJSONParse: () => fixJSONParse,\n  fixJSONStringify: () => fixJSONStringify,\n  formatFleURL: () => formatFleURL,\n  helpers: () => helpers\n});\nlet check;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  }\n\n}, 0);\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n\n  isObject(obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n\n    return obj === Object(obj);\n  },\n\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n\n  isBoolean(obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n\n  isFunction(obj) {\n    return typeof obj === 'function' || false;\n  },\n\n  isEmpty(obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n\n    return false;\n  },\n\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n\n  has(_obj, path) {\n    let obj = _obj;\n\n    if (!this.isObject(obj)) {\n      return false;\n    }\n\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    const length = path.length;\n\n    for (let i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n\n      obj = obj[path[i]];\n    }\n\n    return !!length;\n  },\n\n  omit(obj) {\n    const clear = Object.assign({}, obj);\n\n    for (var _len = arguments.length, keys = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      keys[_key - 1] = arguments[_key];\n    }\n\n    for (let i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n\n  now: Date.now,\n\n  throttle(func, wait) {\n    let options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    let previous = 0;\n    let timeout = null;\n    let result;\n    const that = this;\n    let self;\n    let args;\n\n    const later = () => {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n\n      if (!timeout) {\n        self = args = null;\n      }\n    };\n\n    const throttled = function () {\n      const now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      const remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n\n        previous = now;\n        result = func.apply(self, args);\n\n        if (!timeout) {\n          self = args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n\n      return result;\n    };\n\n    throttled.cancel = () => {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n\n};\nconst _helpers = ['String', 'Number', 'Date'];\n\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n/*\n * @const {Function} fixJSONParse - Fix issue with Date parse\n */\n\n\nconst fixJSONParse = function (obj) {\n  for (let key in obj) {\n    if (helpers.isString(obj[key]) && obj[key].includes('=--JSON-DATE--=')) {\n      obj[key] = obj[key].replace('=--JSON-DATE--=', '');\n      obj[key] = new Date(parseInt(obj[key]));\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONParse(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONParse(v);\n        } else if (helpers.isString(v) && v.includes('=--JSON-DATE--=')) {\n          v = v.replace('=--JSON-DATE--=', '');\n          obj[key][i] = new Date(parseInt(v));\n        }\n      }\n    }\n  }\n\n  return obj;\n};\n/*\n * @const {Function} fixJSONStringify - Fix issue with Date stringify\n */\n\n\nconst fixJSONStringify = function (obj) {\n  for (let key in obj) {\n    if (helpers.isDate(obj[key])) {\n      obj[key] = \"=--JSON-DATE--=\".concat(+obj[key]);\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONStringify(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONStringify(v);\n        } else if (helpers.isDate(v)) {\n          obj[key][i] = \"=--JSON-DATE--=\".concat(+v);\n        }\n      }\n    }\n  }\n\n  return obj;\n};\n/*\n * @locus Anywhere\n * @private\n * @name formatFleURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like build URL for\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Returns formatted URL for file\n * @returns {String} Downloadable link\n */\n\n\nconst formatFleURL = function (fileRef) {\n  let version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n  let _URIBase = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (__meteor_runtime_config__ || {}).ROOT_URL;\n\n  check(fileRef, Object);\n  check(version, String);\n  let URIBase = _URIBase;\n\n  if (!helpers.isString(URIBase)) {\n    URIBase = (__meteor_runtime_config__ || {}).ROOT_URL || '/';\n  }\n\n  const _root = URIBase.replace(/\\/+$/, '');\n\n  const vRef = fileRef.versions && fileRef.versions[version] || fileRef || {};\n  let ext;\n\n  if (helpers.isString(vRef.extension)) {\n    ext = \".\".concat(vRef.extension.replace(/^\\./, ''));\n  } else {\n    ext = '';\n  }\n\n  if (fileRef.public === true) {\n    return _root + (version === 'original' ? \"\".concat(fileRef._downloadRoute, \"/\").concat(fileRef._id).concat(ext) : \"\".concat(fileRef._downloadRoute, \"/\").concat(version, \"-\").concat(fileRef._id).concat(ext));\n  }\n\n  return _root + \"\".concat(fileRef._downloadRoute, \"/\").concat(fileRef._collectionName, \"/\").concat(fileRef._id, \"/\").concat(version, \"/\").concat(fileRef._id).concat(ext);\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"upload.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/upload.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  FileUpload: () => FileUpload,\n  UploadInstance: () => UploadInstance\n});\nlet HTTP;\nmodule.link(\"meteor/http\", {\n  HTTP(v) {\n    HTTP = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Random;\nmodule.link(\"meteor/random\", {\n  Random(v) {\n    Random = v;\n  }\n\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 3);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 4);\nlet EventEmitter;\nmodule.link(\"eventemitter3\", {\n  EventEmitter(v) {\n    EventEmitter = v;\n  }\n\n}, 5);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 6);\nlet fixJSONParse, fixJSONStringify, helpers;\nmodule.link(\"./lib.js\", {\n  fixJSONParse(v) {\n    fixJSONParse = v;\n  },\n\n  fixJSONStringify(v) {\n    fixJSONStringify = v;\n  },\n\n  helpers(v) {\n    helpers = v;\n  }\n\n}, 7);\n\nconst _rootUrl = (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.ROOT_URL).replace(/\\/+$/, '');\n\nconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n/*\n * @locus Client\n * @name FileUpload\n * @class FileUpload\n * @summary Internal Class, instance of this class is returned from `.insert()` method\n */\n\nclass FileUpload extends EventEmitter {\n  constructor(config) {\n    super();\n    this.config = config;\n\n    this.config._debug('[FilesCollection] [FileUpload] [constructor]');\n\n    if (!this.config.isBase64) {\n      this.file = Object.assign({}, helpers.clone(this.config.file), this.config.fileData);\n    } else {\n      this.file = this.config.fileData;\n    }\n\n    this.state = new ReactiveVar('active');\n    this.onPause = new ReactiveVar(false);\n    this.progress = new ReactiveVar(0);\n\n    this.continueFunc = () => {};\n\n    this.estimateTime = new ReactiveVar(1000);\n    this.estimateSpeed = new ReactiveVar(0);\n    this.estimateTimer = Meteor.setInterval(() => {\n      if (this.state.get() === 'active') {\n        const _currentTime = this.estimateTime.get();\n\n        if (_currentTime > 1000) {\n          this.estimateTime.set(_currentTime - 1000);\n        }\n      }\n    }, 1000);\n  }\n\n  pause() {\n    this.config._debug('[FilesCollection] [insert] [.pause()]');\n\n    if (!this.onPause.get()) {\n      this.onPause.set(true);\n      this.state.set('paused');\n      this.emit('pause', this.file);\n    }\n  }\n\n  continue() {\n    this.config._debug('[FilesCollection] [insert] [.continue()]');\n\n    if (this.onPause.get()) {\n      this.onPause.set(false);\n      this.state.set('active');\n      this.emit('continue', this.file);\n      this.continueFunc();\n    }\n  }\n\n  toggle() {\n    this.config._debug('[FilesCollection] [insert] [.toggle()]');\n\n    if (this.onPause.get()) {\n      this.continue();\n    } else {\n      this.pause();\n    }\n  }\n\n  abort() {\n    this.config._debug('[FilesCollection] [insert] [.abort()]');\n\n    window.removeEventListener('beforeunload', this.config.beforeunload, false);\n    this.pause();\n\n    this.config._onEnd();\n\n    this.state.set('aborted');\n    this.config.onAbort && this.config.onAbort.call(this, this.file);\n    this.emit('abort', this.file);\n\n    if (this.config.debug) {\n      console.timeEnd(\"insert \".concat(this.config.fileData.name));\n    }\n\n    this.config.ddp.call(this.config._Abort, this.config.fileId);\n  }\n\n}\n\nclass UploadInstance extends EventEmitter {\n  constructor(config, collection) {\n    super();\n    this.config = config;\n    this.collection = collection;\n\n    this.collection._debug('[FilesCollection] [insert()]');\n\n    if (!this.config.ddp) {\n      this.config.ddp = this.collection.ddp;\n    }\n\n    if (!this.config.meta) {\n      this.config.meta = {};\n    }\n\n    if (!this.config.streams) {\n      this.config.streams = 2;\n    }\n\n    if (this.config.streams < 1) {\n      this.config.streams = 2;\n    }\n\n    if (!helpers.isString(this.config.transport)) {\n      this.config.transport = 'ddp';\n    }\n\n    this.config.transport = this.config.transport.toLowerCase();\n\n    if (this.config.transport !== 'ddp' && this.config.transport !== 'http') {\n      this.config.transport = 'ddp';\n    }\n\n    if (!this.config.chunkSize) {\n      this.config.chunkSize = this.collection.chunkSize;\n    }\n\n    if (!helpers.isBoolean(this.config.allowWebWorkers)) {\n      this.config.allowWebWorkers = true;\n    }\n\n    check(this.config, {\n      ddp: Match.Any,\n      file: Match.Any,\n      fileId: Match.Optional(String),\n      meta: Match.Optional(Object),\n      type: Match.Optional(String),\n      onError: Match.Optional(Function),\n      onAbort: Match.Optional(Function),\n      streams: Match.OneOf('dynamic', Number),\n      onStart: Match.Optional(Function),\n      fileName: Match.Optional(String),\n      isBase64: Match.Optional(Boolean),\n      transport: Match.OneOf('http', 'ddp'),\n      chunkSize: Match.OneOf('dynamic', Number),\n      onUploaded: Match.Optional(Function),\n      onProgress: Match.Optional(Function),\n      onBeforeUpload: Match.Optional(Function),\n      allowWebWorkers: Boolean\n    });\n\n    if (this.config.isBase64 === true) {\n      check(this.config.file, String);\n\n      if (!this.config.fileName) {\n        throw new Meteor.Error(400, '\"fileName\" must me specified for base64 upload!');\n      }\n\n      if (this.config.file.includes('data:')) {\n        this.config.file = this.config.file.replace('data:', '');\n      }\n\n      if (this.config.file.includes(',')) {\n        const _file = this.config.file.split(',');\n\n        this.fileData = {\n          size: Math.floor(_file[1].replace(/\\=/g, '').length / 4 * 3),\n          type: _file[0].split(';')[0],\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n        this.config.file = _file[1];\n      } else if (!this.config.type) {\n        throw new Meteor.Error(400, '\"type\" must me specified for base64 upload! And represent mime-type of the file');\n      } else {\n        this.fileData = {\n          size: Math.floor(this.config.file.replace(/\\=/g, '').length / 4 * 3),\n          type: this.config.type,\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n      }\n    }\n\n    if (this.config.file) {\n      if (!this.config.isBase64) {\n        try {\n          if (!this.config.file.name || !this.config.file.size) {\n            throw new Meteor.Error(500, 'Not a File!');\n          }\n        } catch (e) {\n          throw new Meteor.Error(500, '[FilesCollection] [insert] Insert method accepts File, not a FileList. You need to provide a real File. File must have `.name` property, and its size must be larger than zero.');\n        }\n\n        this.fileData = {\n          size: this.config.file.size,\n          type: this.config.type || this.config.file.type,\n          name: this.config.fileName || this.config.file.name,\n          meta: this.config.meta\n        };\n      }\n\n      if (this.collection.debug) {\n        console.time(\"insert \".concat(this.fileData.name));\n        console.time(\"loadFile \".concat(this.fileData.name));\n      }\n\n      if (this.collection._supportWebWorker && this.config.allowWebWorkers) {\n        try {\n          this.worker = new Worker(this.collection._webWorkerUrl);\n        } catch (wwError) {\n          this.worker = false;\n\n          this.collection._debug('[FilesCollection] [insert] [create WebWorker]: Can\\'t create WebWorker, fallback to MainThread', wwError);\n        }\n      } else {\n        this.worker = null;\n      }\n\n      this.startTime = {};\n      this.config.debug = this.collection.debug;\n      this.config._debug = this.collection._debug;\n      this.currentChunk = 0;\n      this.transferTime = 0;\n      this.trackerComp = null;\n      this.sentChunks = 0;\n      this.fileLength = 1;\n      this.EOFsent = false;\n      this.fileId = this.config.fileId || Random.id();\n      this.FSName = this.collection.namingFunction ? this.collection.namingFunction(this.fileData) : this.fileId;\n      this.pipes = [];\n      this.fileData = Object.assign(this.fileData, this.collection._getExt(this.fileData.name), {\n        mime: this.collection._getMimeType(this.fileData)\n      });\n      this.fileData['mime-type'] = this.fileData.mime;\n      this.result = new FileUpload(Object.assign({}, this.config, {\n        fileData: this.fileData,\n        fileId: this.fileId,\n        _Abort: this.collection._methodNames._Abort\n      }));\n\n      this.beforeunload = e => {\n        const message = helpers.isFunction(this.collection.onbeforeunloadMessage) ? this.collection.onbeforeunloadMessage.call(this.result, this.fileData) : this.collection.onbeforeunloadMessage;\n\n        if (e) {\n          e.returnValue = message;\n        }\n\n        return message;\n      };\n\n      this.result.config.beforeunload = this.beforeunload;\n      window.addEventListener('beforeunload', this.beforeunload, false);\n\n      this.result.config._onEnd = () => this.emit('_onEnd');\n\n      this.addListener('end', this.end);\n      this.addListener('start', this.start);\n      this.addListener('upload', this.upload);\n      this.addListener('sendEOF', this.sendEOF);\n      this.addListener('prepare', this.prepare);\n      this.addListener('sendChunk', this.sendChunk);\n      this.addListener('proceedChunk', this.proceedChunk);\n      this.addListener('createStreams', this.createStreams);\n      this.addListener('calculateStats', helpers.throttle(() => {\n        const _t = this.transferTime / this.sentChunks / this.config.streams;\n\n        this.result.estimateTime.set(_t * (this.fileLength - this.sentChunks));\n        this.result.estimateSpeed.set(this.config.chunkSize / (_t / 1000));\n        const progress = Math.round(this.sentChunks / this.fileLength * 100);\n        let sentBytes = this.config.chunkSize * this.sentChunks;\n\n        if (sentBytes > this.fileData.size) {\n          // this case often occurs, when the last chunk\n          // is smaller than chunkSize, so we limit to fileSize\n          sentBytes = this.fileData.size;\n        }\n\n        this.result.progress.set(progress);\n        this.config.onProgress && this.config.onProgress.call(this.result, progress, this.fileData);\n        this.result.emit('progress', progress, this.fileData, {\n          chunksSent: this.sentChunks,\n          chunksLength: this.fileLength,\n          bytesSent: sentBytes\n        });\n      }, 250));\n      this.addListener('_onEnd', () => {\n        if (this.result.estimateTimer) {\n          Meteor.clearInterval(this.result.estimateTimer);\n        }\n\n        if (this.worker) {\n          this.worker.terminate();\n        }\n\n        if (this.trackerComp) {\n          this.trackerComp.stop();\n        }\n\n        if (this.beforeunload) {\n          window.removeEventListener('beforeunload', this.beforeunload, false);\n        }\n\n        if (this.result) {\n          return this.result.progress.set(0);\n        }\n\n        return void 0;\n      });\n    } else {\n      throw new Meteor.Error(500, '[FilesCollection] [insert] Have you forget to pass a File itself?');\n    }\n  }\n\n  end(error, data) {\n    this.collection._debug('[FilesCollection] [UploadInstance] [end]', this.fileData.name);\n\n    if (this.collection.debug) {\n      console.timeEnd(\"insert \".concat(this.fileData.name));\n    }\n\n    this.emit('_onEnd');\n    this.result.emit('uploaded', error, data);\n    this.config.onUploaded && this.config.onUploaded.call(this.result, error, data);\n\n    if (error) {\n      this.collection._debug('[FilesCollection] [insert] [end] Error:', error);\n\n      this.result.abort();\n      this.result.state.set('aborted');\n      this.result.emit('error', error, this.fileData);\n      this.config.onError && this.config.onError.call(this.result, error, this.fileData);\n    } else {\n      this.result.state.set('completed');\n      this.collection.emit('afterUpload', data);\n    }\n\n    this.result.emit('end', error, data || this.fileData);\n    return this.result;\n  }\n\n  sendChunk(evt) {\n    const opts = {\n      fileId: this.fileId,\n      binData: evt.data.bin,\n      chunkId: evt.data.chunkId\n    };\n\n    if (this.config.isBase64) {\n      const pad = opts.binData.length % 4;\n\n      if (pad) {\n        let p = 0;\n\n        while (p < pad) {\n          opts.binData += '=';\n          p++;\n        }\n      }\n    }\n\n    this.emit('data', evt.data.bin);\n\n    if (this.pipes.length) {\n      for (let i = this.pipes.length - 1; i >= 0; i--) {\n        opts.binData = this.pipes[i](opts.binData);\n      }\n    }\n\n    if (this.fileLength === evt.data.chunkId) {\n      if (this.collection.debug) {\n        console.timeEnd(\"loadFile \".concat(this.fileData.name));\n      }\n\n      this.emit('readEnd');\n    }\n\n    if (opts.binData) {\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, error => {\n          this.transferTime += +new Date() - this.startTime[opts.chunkId];\n\n          if (error) {\n            if (this.result.state.get() !== 'aborted') {\n              this.emit('end', error);\n            }\n          } else {\n            ++this.sentChunks;\n\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n\n            this.emit('calculateStats');\n          }\n        });\n      } else {\n        HTTP.call('POST', \"\".concat(_rootUrl).concat(this.collection.downloadRoute, \"/\").concat(this.collection.collectionName, \"/__upload\"), {\n          content: opts.binData,\n          headers: {\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileid': opts.fileId,\n            'x-chunkid': opts.chunkId,\n            'content-type': 'text/plain'\n          },\n\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n\n        }, error => {\n          this.transferTime += +new Date() - this.startTime[opts.chunkId];\n\n          if (error) {\n            if (\"\".concat(error) === 'Error: network' || \"\".concat(error) === 'Error: Connection lost') {\n              this.result.pause();\n            } else {\n              if (this.result.state.get() !== 'aborted') {\n                this.emit('end', error);\n              }\n            }\n          } else {\n            ++this.sentChunks;\n\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n\n            this.emit('calculateStats');\n          }\n        });\n      }\n    }\n  }\n\n  sendEOF() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [sendEOF]', this.EOFsent);\n\n    if (!this.EOFsent) {\n      this.EOFsent = true;\n      const opts = {\n        eof: true,\n        fileId: this.fileId\n      };\n\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, (error, result) => {\n          this.emit('end', error, result);\n        });\n      } else {\n        HTTP.call('POST', \"\".concat(_rootUrl).concat(this.collection.downloadRoute, \"/\").concat(this.collection.collectionName, \"/__upload\"), {\n          content: '',\n          headers: {\n            'x-eof': '1',\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileId': opts.fileId,\n            'content-type': 'text/plain'\n          },\n\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n\n        }, (error, _result) => {\n          let result;\n\n          try {\n            result = JSON.parse((helpers.isObject(_result) ? _result.content : void 0) || {});\n          } catch (e) {\n            console.warn('Something went wrong! [sendEOF] method doesn\\'t returned JSON! Looks like you\\'re on Cordova app or behind proxy, switching to DDP transport is recommended.');\n            result = {};\n          }\n\n          if (result.meta) {\n            result.meta = fixJSONParse(result.meta);\n          }\n\n          this.emit('end', error, result);\n        });\n      }\n    }\n  }\n\n  proceedChunk(chunkId) {\n    const chunk = this.config.file.slice(this.config.chunkSize * (chunkId - 1), this.config.chunkSize * chunkId);\n\n    if (this.config.isBase64) {\n      this.emit('sendChunk', {\n        data: {\n          bin: chunk,\n          chunkId\n        }\n      });\n    } else {\n      let fileReader;\n\n      if (window.FileReader) {\n        fileReader = new window.FileReader();\n\n        fileReader.onloadend = evt => {\n          this.emit('sendChunk', {\n            data: {\n              bin: ((helpers.isObject(fileReader) ? fileReader.result : void 0) || (evt.srcElement ? evt.srcElement.result : void 0) || (evt.target ? evt.target.result : void 0)).split(',')[1],\n              chunkId\n            }\n          });\n        };\n\n        fileReader.onerror = e => {\n          this.emit('end', (e.target || e.srcElement).error);\n        };\n\n        fileReader.readAsDataURL(chunk);\n      } else if (window.FileReaderSync) {\n        fileReader = new window.FileReaderSync();\n        this.emit('sendChunk', {\n          data: {\n            bin: fileReader.readAsDataURL(chunk).split(',')[1],\n            chunkId\n          }\n        });\n      } else {\n        this.emit('end', 'File API is not supported in this Browser!');\n      }\n    }\n  }\n\n  upload() {\n    if (this.result.onPause.get()) {\n      return this;\n    }\n\n    if (this.result.state.get() === 'aborted') {\n      return this;\n    }\n\n    if (this.currentChunk <= this.fileLength) {\n      ++this.currentChunk;\n\n      if (this.worker) {\n        this.worker.postMessage({\n          f: this.config.file,\n          sc: this.sentChunks,\n          cc: this.currentChunk,\n          cs: this.config.chunkSize,\n          ib: this.config.isBase64\n        });\n      } else {\n        this.emit('proceedChunk', this.currentChunk);\n      }\n    } else {\n      this.emit('sendEOF');\n    }\n\n    this.startTime[this.currentChunk] = +new Date();\n    return this;\n  }\n\n  createStreams() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [createStreams]');\n\n    let i = 1;\n\n    while (i <= this.config.streams) {\n      this.emit('upload');\n      i++;\n    }\n  }\n\n  prepare() {\n    let _len;\n\n    this.config.onStart && this.config.onStart.call(this.result, null, this.fileData);\n    this.result.emit('start', null, this.fileData);\n\n    if (this.config.chunkSize === 'dynamic') {\n      this.config.chunkSize = this.fileData.size / 1000;\n\n      if (this.config.chunkSize < 327680) {\n        this.config.chunkSize = 327680;\n      } else if (this.config.chunkSize > 1048576) {\n        this.config.chunkSize = 1048576;\n      }\n\n      if (this.config.transport === 'http') {\n        this.config.chunkSize = Math.round(this.config.chunkSize / 2);\n      } else if (isSafari) {\n        this.config.chunkSize = Math.ceil(this.config.chunkSize / 8);\n      }\n    }\n\n    if (this.config.isBase64) {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 4) * 4;\n      _len = Math.ceil(this.config.file.length / this.config.chunkSize);\n    } else {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 8) * 8;\n      _len = Math.ceil(this.fileData.size / this.config.chunkSize);\n    }\n\n    if (this.config.streams === 'dynamic') {\n      this.config.streams = helpers.clone(_len);\n\n      if (this.config.streams > 24) {\n        this.config.streams = 24;\n      }\n\n      if (this.config.transport === 'http') {\n        this.config.streams = Math.round(this.config.streams / 2);\n      } else if (isSafari) {\n        this.config.streams = 1;\n      }\n    }\n\n    this.fileLength = _len <= 0 ? 1 : _len;\n\n    if (this.config.streams > this.fileLength) {\n      this.config.streams = this.fileLength;\n    }\n\n    this.result.config.fileLength = this.fileLength;\n    const opts = {\n      file: this.fileData,\n      fileId: this.fileId,\n      chunkSize: this.config.isBase64 ? this.config.chunkSize / 4 * 3 : this.config.chunkSize,\n      fileLength: this.fileLength\n    };\n\n    if (this.FSName !== this.fileId) {\n      opts.FSName = this.FSName;\n    }\n\n    const handleStart = error => {\n      if (error) {\n        this.collection._debug('[FilesCollection] [_Start] Error:', error);\n\n        this.emit('end', error);\n      } else {\n        this.result.continueFunc = () => {\n          this.collection._debug('[FilesCollection] [insert] [continueFunc]');\n\n          this.emit('createStreams');\n        };\n\n        this.emit('createStreams');\n      }\n    };\n\n    if (this.config.transport === 'ddp') {\n      this.config.ddp.call(this.collection._methodNames._Start, opts, handleStart);\n    } else {\n      if (helpers.isObject(opts.file) ? opts.file.meta : void 0) {\n        opts.file.meta = fixJSONStringify(opts.file.meta);\n      }\n\n      HTTP.call('POST', \"\".concat(_rootUrl).concat(this.collection.downloadRoute, \"/\").concat(this.collection.collectionName, \"/__upload\"), {\n        data: opts,\n        headers: {\n          'x-start': '1',\n          'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null\n        },\n\n        beforeSend(xhr) {\n          xhr.withCredentials = true;\n          return true;\n        }\n\n      }, handleStart);\n    }\n  }\n\n  pipe(func) {\n    this.pipes.push(func);\n    return this;\n  }\n\n  start() {\n    let isUploadAllowed;\n\n    if (this.fileData.size <= 0) {\n      this.end(new Meteor.Error(400, 'Can\\'t upload empty file'));\n      return this.result;\n    }\n\n    if (this.config.onBeforeUpload && helpers.isFunction(this.config.onBeforeUpload)) {\n      isUploadAllowed = this.config.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'config.onBeforeUpload() returned false'));\n      }\n    }\n\n    if (this.collection.onBeforeUpload && helpers.isFunction(this.collection.onBeforeUpload)) {\n      isUploadAllowed = this.collection.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'collection.onBeforeUpload() returned false'));\n      }\n    }\n\n    Tracker.autorun(computation => {\n      this.trackerComp = computation;\n\n      if (!this.result.onPause.curValue && !Meteor.status().connected) {\n        this.collection._debug('[FilesCollection] [insert] [Tracker] [pause]');\n\n        this.result.pause();\n      }\n    });\n\n    if (this.worker) {\n      this.collection._debug('[FilesCollection] [insert] using WebWorkers');\n\n      this.worker.onmessage = evt => {\n        if (evt.data.error) {\n          this.collection._debug('[FilesCollection] [insert] [worker] [onmessage] [ERROR:]', evt.data.error);\n\n          this.emit('proceedChunk', evt.data.chunkId);\n        } else {\n          this.emit('sendChunk', evt);\n        }\n      };\n\n      this.worker.onerror = e => {\n        this.collection._debug('[FilesCollection] [insert] [worker] [onerror] [ERROR:]', e);\n\n        this.emit('end', e.message);\n      };\n    } else {\n      this.collection._debug('[FilesCollection] [insert] using MainThread');\n    }\n\n    this.emit('prepare');\n    return this.result;\n  }\n\n  manual() {\n    this.result.start = () => {\n      this.emit('start');\n    };\n\n    const self = this;\n\n    this.result.pipe = function (func) {\n      self.pipe(func);\n      return this;\n    };\n\n    return this.result;\n  }\n\n}\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"node_modules\":{\"eventemitter3\":{\"package.json\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/ostrio_files/node_modules/eventemitter3/package.json                                           //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exports = {\n  \"name\": \"eventemitter3\",\n  \"version\": \"4.0.7\",\n  \"main\": \"index.js\"\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/ostrio_files/node_modules/eventemitter3/index.js                                               //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/ostrio:files/client.js\");\n\n/* Exports */\nPackage._define(\"ostrio:files\", exports, {\n  FilesCollection: FilesCollection\n});\n\n})();\n","servePath":"/packages/ostrio_files.js","sourceMap":{"version":3,"sources":["packages/ostrio:files/client.js","packages/ostrio:files/core.js","packages/ostrio:files/cursor.js","packages/ostrio:files/lib.js","packages/ostrio:files/upload.js"],"names":["module","export","FilesCollection","Mongo","link","v","Meteor","DDP","Cookies","check","Match","UploadInstance","FilesCollectionCore","default","formatFleURL","helpers","NOOP","allowedParams","constructor","config","Object","keys","forEach","param","includes","self","cookie","allowQueryStringCookies","isBoolean","debug","public","chunkSize","Math","floor","isString","collectionName","collection","Collection","_name","filesCollection","String","downloadRoute","Error","disableUpload","replace","isFunction","namingFunction","onBeforeUpload","allowClientCode","ddp","onbeforeunloadMessage","setTokenCookie","connection","_lastSessionId","set","path","sameSite","isCordova","send","Accounts","onReconnect","conn","startup","onLogin","OneOf","Function","_URL","window","URL","webkitURL","mozURL","msURL","oURL","Worker","Blob","createObjectURL","_supportWebWorker","_webWorkerUrl","type","absoluteUrl","e","_debug","schema","Boolean","Number","Any","_methodNames","_Abort","_Write","_Start","_Remove","_getMimeType","fileData","mime","isObject","_getUser","result","user","userId","insert","autoStart","console","warn","remove","selector","callback","JSON","stringify","Optional","call","Template","registerHelper","fileRef","_version","_URIBase","version","URIBase","EventEmitter","FilesCursor","FileCursor","info","log","apply","arguments","_getFileName","fileName","name","length","_getExt","extension","split","pop","toLowerCase","ext","extensionWithDot","_updateFileTypes","data","isVideo","test","isAudio","isImage","isText","isJSON","isPDF","_dataToSchema","ds","meta","size","versions","original","_downloadRoute","_collectionName","fileId","_id","_storagePath","storagePath","assign","findOne","options","doc","find","update","__helpers","optional","blackbox","updatedAt","Date","_fileRef","_collection","get","property","fetch","with","_selector","_current","cursor","hasNext","count","next","hasPrevious","previous","first","last","context","each","map","file","current","observe","callbacks","observeChanges","fixJSONParse","fixJSONStringify","isUndefined","obj","isArray","Array","prototype","toString","isEmpty","isDate","clone","slice","has","_obj","hasOwnProperty","i","omit","clear","now","throttle","func","wait","timeout","that","args","later","leading","throttled","remaining","clearTimeout","trailing","setTimeout","cancel","_helpers","key","parseInt","__meteor_runtime_config__","ROOT_URL","_root","vRef","FileUpload","HTTP","Random","Tracker","ReactiveVar","_rootUrl","MOBILE_ROOT_URL","isSafari","navigator","userAgent","isBase64","state","onPause","progress","continueFunc","estimateTime","estimateSpeed","estimateTimer","setInterval","_currentTime","pause","emit","continue","toggle","abort","removeEventListener","beforeunload","_onEnd","onAbort","timeEnd","streams","transport","allowWebWorkers","onError","onStart","onUploaded","onProgress","_file","time","worker","wwError","startTime","currentChunk","transferTime","trackerComp","sentChunks","fileLength","EOFsent","id","FSName","pipes","message","returnValue","addEventListener","addListener","end","start","upload","sendEOF","prepare","sendChunk","proceedChunk","createStreams","_t","round","sentBytes","chunksSent","chunksLength","bytesSent","clearInterval","terminate","stop","error","evt","opts","binData","bin","chunkId","pad","p","content","headers","beforeSend","xhr","withCredentials","eof","_result","parse","chunk","fileReader","FileReader","onloadend","srcElement","target","onerror","readAsDataURL","FileReaderSync","postMessage","f","sc","cc","cs","ib","_len","ceil","handleStart","pipe","push","isUploadAllowed","autorun","computation","curValue","status","connected","onmessage","manual"],"mappings":"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","file":"/packages/ostrio_files.js","sourcesContent":["import { Mongo }           from 'meteor/mongo';\nimport { Meteor }          from 'meteor/meteor';\nimport { DDP }             from 'meteor/ddp-client';\nimport { Cookies }         from 'meteor/ostrio:cookies';\nimport { check, Match }    from 'meteor/check';\nimport { UploadInstance }  from './upload.js';\nimport FilesCollectionCore from './core.js';\nimport { formatFleURL, helpers } from './lib.js';\n\nconst NOOP = () => { };\nconst allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\nexport class FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n    if (config) {\n      Object.keys(config).forEach((param) => {\n        if (allowedParams.includes(param)) {\n          this[param] = config[param];\n        }\n      });\n    }\n\n    const self = this;\n    const cookie = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies\n    });\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: \"downloadRoute\" must be precisely provided on \"public\" collections! Note: \"downloadRoute\" must be equal or be inside of your web/proxy-server (relative) root.`);\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, { path: '/', sameSite: 'Lax' });\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect((conn) => {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {type: 'application/javascript'}));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n\n    this._methodNames = {\n      _Abort: `_FilesCollectionAbort_${this.collectionName}`,\n      _Write: `_FilesCollectionWrite_${this.collectionName}`,\n      _Start: `_FilesCollectionStart_${this.collectionName}`,\n      _Remove: `_FilesCollectionRemove_${this.collectionName}`\n    };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n    if (helpers.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n    return mime;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n      userId: null\n    };\n\n    if (helpers.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n  insert(config, autoStart = true) {\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n    return (new UploadInstance(config, this))[autoStart ? 'start' : 'manual']();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n  remove(selector = {}, callback) {\n    this._debug(`[FilesCollection] [remove(${JSON.stringify(selector)})]`);\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, (callback || NOOP));\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', (fileRef, _version = 'original', _URIBase) => {\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      const version = (!helpers.isString(_version)) ? 'original' : _version;\n      const URIBase = (!helpers.isString(_URIBase)) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});\n","import { EventEmitter }            from 'eventemitter3';\nimport { check, Match }            from 'meteor/check';\nimport { formatFleURL, helpers }   from './lib.js';\nimport { FilesCursor, FileCursor } from './cursor.js';\n\nexport default class FilesCollectionCore extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  static __helpers = helpers;\n\n  static schema = {\n    _id: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    name: {\n      type: String\n    },\n    type: {\n      type: String\n    },\n    path: {\n      type: String\n    },\n    isVideo: {\n      type: Boolean\n    },\n    isAudio: {\n      type: Boolean\n    },\n    isImage: {\n      type: Boolean\n    },\n    isText: {\n      type: Boolean\n    },\n    isJSON: {\n      type: Boolean\n    },\n    isPDF: {\n      type: Boolean\n    },\n    extension: {\n      type: String,\n      optional: true\n    },\n    ext: {\n      type: String,\n      optional: true\n    },\n    extensionWithDot: {\n      type: String,\n      optional: true\n    },\n    mime: {\n      type: String,\n      optional: true\n    },\n    'mime-type': {\n      type: String,\n      optional: true\n    },\n    _storagePath: {\n      type: String\n    },\n    _downloadRoute: {\n      type: String\n    },\n    _collectionName: {\n      type: String\n    },\n    public: {\n      type: Boolean,\n      optional: true\n    },\n    meta: {\n      type: Object,\n      blackbox: true,\n      optional: true\n    },\n    userId: {\n      type: String,\n      optional: true\n    },\n    updatedAt: {\n      type: Date,\n      optional: true\n    },\n    versions: {\n      type: Object,\n      blackbox: true\n    }\n  };\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _debug() {\n    if (this.debug) {\n      (console.info || console.log || function () { }).apply(void 0, arguments);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  _getFileName(fileData) {\n    const fileName = fileData.name || fileData.fileName;\n    if (helpers.isString(fileName) && (fileName.length > 0)) {\n      return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  _getExt(fileName) {\n    if (fileName.includes('.')) {\n      const extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n      return { ext: extension, extension, extensionWithDot: `.${extension}` };\n    }\n    return { ext: '', extension: '', extensionWithDot: '' };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  _updateFileTypes(data) {\n    data.isVideo  = /^video\\//i.test(data.type);\n    data.isAudio  = /^audio\\//i.test(data.type);\n    data.isImage  = /^image\\//i.test(data.type);\n    data.isText   = /^text\\//i.test(data.type);\n    data.isJSON   = /^application\\/json$/i.test(data.type);\n    data.isPDF    = /^application\\/(x-)?pdf$/i.test(data.type);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  _dataToSchema(data) {\n    const ds = {\n      name: data.name,\n      extension: data.extension,\n      ext: data.extension,\n      extensionWithDot: '.' + data.extension,\n      path: data.path,\n      meta: data.meta,\n      type: data.type,\n      mime: data.type,\n      'mime-type': data.type,\n      size: data.size,\n      userId: data.userId || null,\n      versions: {\n        original: {\n          path: data.path,\n          size: data.size,\n          type: data.type,\n          extension: data.extension\n        }\n      },\n      _downloadRoute: data._downloadRoute || this.downloadRoute,\n      _collectionName: data._collectionName || this.collectionName\n    };\n\n    //Optional fileId\n    if (data.fileId) {\n      ds._id = data.fileId;\n    }\n\n    this._updateFileTypes(ds);\n    ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n    return ds;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n  findOne(selector = {}, options) {\n    this._debug(`[FilesCollection] [findOne(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    const doc = this.collection.findOne(selector, options);\n    if (doc) {\n      return new FileCursor(doc, this);\n    }\n    return doc;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  find(selector = {}, options) {\n    this._debug(`[FilesCollection] [find(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    return new FilesCursor(selector, options, this);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n  update() {\n    this.collection.update.apply(this.collection, arguments);\n    return this.collection;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  link(fileRef, version = 'original', URIBase) {\n    this._debug(`[FilesCollection] [link(${(helpers.isObject(fileRef) ? fileRef._id : void 0)}, ${version})]`);\n    check(fileRef, Object);\n\n    if (!fileRef) {\n      return '';\n    }\n    return formatFleURL(fileRef, version, URIBase);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\n\n/*\n * @private\n * @locus Anywhere\n * @class FileCursor\n * @param _fileRef    {Object} - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Internal class, represents each record in `FilesCursor.each()` or document returned from `.findOne()` method\n */\nexport class FileCursor {\n  constructor(_fileRef, _collection) {\n    this._fileRef    = _fileRef;\n    this._collection = _collection;\n    Object.assign(this, _fileRef);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Remove document\n   * @returns {FileCursor}\n   */\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FileCursor] [remove()]');\n    if (this._fileRef) {\n      this._collection.remove(this._fileRef._id, callback);\n    } else {\n      callback && callback(new Meteor.Error(404, 'No such file'));\n    }\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name link\n   * @param version {String} - Name of file's subversion\n   * @param URIBase {String} - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL to File\n   * @returns {String}\n   */\n  link(version = 'original', URIBase) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [link(${version})]`);\n    if (this._fileRef) {\n      return this._collection.link(this._fileRef, version, URIBase);\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name get\n   * @param property {String} - Name of sub-object property\n   * @summary Returns current document as a plain Object, if `property` is specified - returns value of sub-object property\n   * @returns {Object|mix}\n   */\n  get(property) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [get(${property})]`);\n    if (property) {\n      return this._fileRef[property];\n    }\n    return this._fileRef;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name fetch\n   * @summary Returns document as plain Object in Array\n   * @returns {[Object]}\n   */\n  fetch() {\n    this._collection._debug('[FilesCollection] [FileCursor] [fetch()]');\n    return [this._fileRef];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name with\n   * @summary Returns reactive version of current FileCursor, useful to use with `{{#with}}...{{/with}}` block template helper\n   * @returns {[Object]}\n   */\n  with() {\n    this._collection._debug('[FilesCollection] [FileCursor] [with()]');\n    return Object.assign(this, this._collection.collection.findOne(this._fileRef._id));\n  }\n}\n\n/*\n * @private\n * @locus Anywhere\n * @class FilesCursor\n * @param _selector   {String|Object}   - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param options     {Object}          - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Implementation of Cursor for FilesCollection\n */\nexport class FilesCursor {\n  constructor(_selector = {}, options, _collection) {\n    this._collection = _collection;\n    this._selector   = _selector;\n    this._current    = -1;\n    this.cursor      = this._collection.collection.find(this._selector, options);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name get\n   * @summary Returns all matching document(s) as an Array. Alias of `.fetch()`\n   * @returns {[Object]}\n   */\n  get() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [get()]');\n    return this.cursor.fetch();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasNext\n   * @summary Returns `true` if there is next item available on Cursor\n   * @returns {Boolean}\n   */\n  hasNext() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasNext()]');\n    return this._current < (this.cursor.count() - 1);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name next\n   * @summary Returns next item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  next() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [next()]');\n    this.cursor.fetch()[++this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasPrevious\n   * @summary Returns `true` if there is previous item available on Cursor\n   * @returns {Boolean}\n   */\n  hasPrevious() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasPrevious()]');\n    return this._current !== -1;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name previous\n   * @summary Returns previous item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  previous() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [previous()]');\n    this.cursor.fetch()[--this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name fetch\n   * @summary Returns all matching document(s) as an Array.\n   * @returns {[Object]}\n   */\n  fetch() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [fetch()]');\n    return this.cursor.fetch() || [];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name first\n   * @summary Returns first item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  first() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [first()]');\n    this._current = 0;\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name last\n   * @summary Returns last item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  last() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [last()]');\n    this._current = this.count() - 1;\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name count\n   * @summary Returns the number of documents that match a query\n   * @returns {Number}\n   */\n  count() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [count()]');\n    return this.cursor.count();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Removes all documents that match a query\n   * @returns {FilesCursor}\n   */\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [remove()]');\n    this._collection.remove(this._selector, callback);\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name forEach\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Call `callback` once for each matching document, sequentially and synchronously.\n   * @returns {undefined}\n   */\n  forEach(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [forEach()]');\n    this.cursor.forEach(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name each\n   * @summary Returns an Array of FileCursor made for each document on current cursor\n   *          Useful when using in {{#each FilesCursor#each}}...{{/each}} block template helper\n   * @returns {[FileCursor]}\n   */\n  each() {\n    return this.map((file) => {\n      return new FileCursor(file, this._collection);\n    });\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name map\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Map `callback` over all matching documents. Returns an Array.\n   * @returns {Array}\n   */\n  map(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [map()]');\n    return this.cursor.map(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name current\n   * @summary Returns current item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  current() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [current()]');\n    if (this._current < 0) {\n      this._current = 0;\n    }\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observe\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observe\n   * @returns {Object} - live query handle\n   */\n  observe(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observe()]');\n    return this.cursor.observe(callbacks);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observeChanges\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes. Only the differences between the old and new documents are passed to the callbacks.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observeChanges\n   * @returns {Object} - live query handle\n   */\n  observeChanges(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observeChanges()]');\n    return this.cursor.observeChanges(callbacks);\n  }\n}\n","import { check } from 'meteor/check';\n\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isObject(obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n    return obj === Object(obj);\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  isBoolean(obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n  isFunction(obj) {\n    return typeof obj === 'function' || false;\n  },\n  isEmpty(obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n    return false;\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n  has(_obj, path) {\n    let obj = _obj;\n    if (!this.isObject(obj)) {\n      return false;\n    }\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    const length = path.length;\n    for (let i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n      obj = obj[path[i]];\n    }\n    return !!length;\n  },\n  omit(obj, ...keys) {\n    const clear = Object.assign({}, obj);\n    for (let i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n  now: Date.now,\n  throttle(func, wait, options = {}) {\n    let previous = 0;\n    let timeout = null;\n    let result;\n    const that = this;\n    let self;\n    let args;\n\n    const later = () => {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n      if (!timeout) {\n        self = args = null;\n      }\n    };\n\n    const throttled = function () {\n      const now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      const remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(self, args);\n        if (!timeout) {\n          self = args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = () => {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n};\n\nconst _helpers = ['String', 'Number', 'Date'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @const {Function} fixJSONParse - Fix issue with Date parse\n */\nconst fixJSONParse = function(obj) {\n  for (let key in obj) {\n    if (helpers.isString(obj[key]) && obj[key].includes('=--JSON-DATE--=')) {\n      obj[key] = obj[key].replace('=--JSON-DATE--=', '');\n      obj[key] = new Date(parseInt(obj[key]));\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONParse(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONParse(v);\n        } else if (helpers.isString(v) && v.includes('=--JSON-DATE--=')) {\n          v = v.replace('=--JSON-DATE--=', '');\n          obj[key][i] = new Date(parseInt(v));\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @const {Function} fixJSONStringify - Fix issue with Date stringify\n */\nconst fixJSONStringify = function(obj) {\n  for (let key in obj) {\n    if (helpers.isDate(obj[key])) {\n      obj[key] = `=--JSON-DATE--=${+obj[key]}`;\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONStringify(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONStringify(v);\n        } else if (helpers.isDate(v)) {\n          obj[key][i] = `=--JSON-DATE--=${+v}`;\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @locus Anywhere\n * @private\n * @name formatFleURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like build URL for\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Returns formatted URL for file\n * @returns {String} Downloadable link\n */\nconst formatFleURL = (fileRef, version = 'original', _URIBase = (__meteor_runtime_config__ || {}).ROOT_URL) => {\n  check(fileRef, Object);\n  check(version, String);\n  let URIBase = _URIBase;\n\n  if (!helpers.isString(URIBase)) {\n    URIBase = (__meteor_runtime_config__ || {}).ROOT_URL || '/';\n  }\n\n  const _root = URIBase.replace(/\\/+$/, '');\n  const vRef = (fileRef.versions && fileRef.versions[version]) || fileRef || {};\n\n  let ext;\n  if (helpers.isString(vRef.extension)) {\n    ext = `.${vRef.extension.replace(/^\\./, '')}`;\n  } else {\n    ext = '';\n  }\n\n  if (fileRef.public === true) {\n    return _root + (version === 'original' ? `${fileRef._downloadRoute}/${fileRef._id}${ext}` : `${fileRef._downloadRoute}/${version}-${fileRef._id}${ext}`);\n  }\n  return _root + `${fileRef._downloadRoute}/${fileRef._collectionName}/${fileRef._id}/${version}/${fileRef._id}${ext}`;\n};\n\nexport { fixJSONParse, fixJSONStringify, formatFleURL, helpers };\n","import { HTTP }         from 'meteor/http';\nimport { Meteor }       from 'meteor/meteor';\nimport { Random }       from 'meteor/random';\nimport { Tracker }      from 'meteor/tracker';\nimport { ReactiveVar }  from 'meteor/reactive-var';\nimport { EventEmitter } from 'eventemitter3';\nimport { check, Match } from 'meteor/check';\nimport { fixJSONParse, fixJSONStringify, helpers } from './lib.js';\n\nconst _rootUrl = (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.ROOT_URL).replace(/\\/+$/, '');\nconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n/*\n * @locus Client\n * @name FileUpload\n * @class FileUpload\n * @summary Internal Class, instance of this class is returned from `.insert()` method\n */\nexport class FileUpload extends EventEmitter {\n  constructor(config) {\n    super();\n    this.config = config;\n    this.config._debug('[FilesCollection] [FileUpload] [constructor]');\n\n    if (!this.config.isBase64) {\n      this.file        = Object.assign({}, helpers.clone(this.config.file), this.config.fileData);\n    } else {\n      this.file        = this.config.fileData;\n    }\n    this.state         = new ReactiveVar('active');\n    this.onPause       = new ReactiveVar(false);\n    this.progress      = new ReactiveVar(0);\n    this.continueFunc  = () => { };\n    this.estimateTime  = new ReactiveVar(1000);\n    this.estimateSpeed = new ReactiveVar(0);\n    this.estimateTimer = Meteor.setInterval(() => {\n      if (this.state.get() === 'active') {\n        const _currentTime = this.estimateTime.get();\n        if (_currentTime > 1000) {\n          this.estimateTime.set(_currentTime - 1000);\n        }\n      }\n    }, 1000);\n  }\n  pause() {\n    this.config._debug('[FilesCollection] [insert] [.pause()]');\n    if (!this.onPause.get()) {\n      this.onPause.set(true);\n      this.state.set('paused');\n      this.emit('pause', this.file);\n    }\n  }\n  continue() {\n    this.config._debug('[FilesCollection] [insert] [.continue()]');\n    if (this.onPause.get()) {\n      this.onPause.set(false);\n      this.state.set('active');\n      this.emit('continue', this.file);\n      this.continueFunc();\n    }\n  }\n  toggle() {\n    this.config._debug('[FilesCollection] [insert] [.toggle()]');\n    if (this.onPause.get()) {\n      this.continue();\n    } else {\n      this.pause();\n    }\n  }\n  abort() {\n    this.config._debug('[FilesCollection] [insert] [.abort()]');\n    window.removeEventListener('beforeunload', this.config.beforeunload, false);\n    this.pause();\n    this.config._onEnd();\n    this.state.set('aborted');\n    this.config.onAbort && this.config.onAbort.call(this, this.file);\n    this.emit('abort', this.file);\n    if (this.config.debug) {\n      console.timeEnd(`insert ${this.config.fileData.name}`);\n    }\n\n    this.config.ddp.call(this.config._Abort, this.config.fileId);\n  }\n}\n\n/*\n * @locus Client\n * @name UploadInstance\n * @class UploadInstance\n * @summary Internal Class, used for file upload\n */\nexport class UploadInstance extends EventEmitter {\n  constructor(config, collection) {\n    super();\n    this.config     = config;\n    this.collection = collection;\n    this.collection._debug('[FilesCollection] [insert()]');\n\n    if (!this.config.ddp) {\n      this.config.ddp = this.collection.ddp;\n    }\n\n    if (!this.config.meta) {\n      this.config.meta = {};\n    }\n\n    if (!this.config.streams) {\n      this.config.streams = 2;\n    }\n\n    if (this.config.streams < 1) {\n      this.config.streams = 2;\n    }\n\n    if (!helpers.isString(this.config.transport)) {\n      this.config.transport = 'ddp';\n    }\n\n    this.config.transport = this.config.transport.toLowerCase();\n\n    if (this.config.transport !== 'ddp' && this.config.transport !== 'http') {\n      this.config.transport = 'ddp';\n    }\n\n    if (!this.config.chunkSize) {\n      this.config.chunkSize = this.collection.chunkSize;\n    }\n\n    if (!helpers.isBoolean(this.config.allowWebWorkers)) {\n      this.config.allowWebWorkers = true;\n    }\n\n    check(this.config, {\n      ddp: Match.Any,\n      file: Match.Any,\n      fileId: Match.Optional(String),\n      meta: Match.Optional(Object),\n      type: Match.Optional(String),\n      onError: Match.Optional(Function),\n      onAbort: Match.Optional(Function),\n      streams: Match.OneOf('dynamic', Number),\n      onStart: Match.Optional(Function),\n      fileName: Match.Optional(String),\n      isBase64: Match.Optional(Boolean),\n      transport: Match.OneOf('http', 'ddp'),\n      chunkSize: Match.OneOf('dynamic', Number),\n      onUploaded: Match.Optional(Function),\n      onProgress: Match.Optional(Function),\n      onBeforeUpload: Match.Optional(Function),\n      allowWebWorkers: Boolean\n    });\n\n    if (this.config.isBase64 === true) {\n      check(this.config.file, String);\n\n      if (!this.config.fileName) {\n        throw new Meteor.Error(400, '\"fileName\" must me specified for base64 upload!');\n      }\n\n      if (this.config.file.includes('data:')) {\n        this.config.file = this.config.file.replace('data:', '');\n      }\n\n      if (this.config.file.includes(',')) {\n        const _file = this.config.file.split(',');\n        this.fileData = {\n          size: Math.floor(((_file[1].replace(/\\=/g, '')).length / 4) * 3),\n          type: _file[0].split(';')[0],\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n        this.config.file = _file[1];\n      } else if (!this.config.type) {\n        throw new Meteor.Error(400, '\"type\" must me specified for base64 upload! And represent mime-type of the file');\n      } else {\n        this.fileData = {\n          size: Math.floor(((this.config.file.replace(/\\=/g, '')).length / 4) * 3),\n          type: this.config.type,\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n      }\n    }\n\n    if (this.config.file) {\n      if (!this.config.isBase64) {\n        try {\n          if (!this.config.file.name || !this.config.file.size) {\n            throw new Meteor.Error(500, 'Not a File!');\n          }\n        } catch (e) {\n          throw new Meteor.Error(500, '[FilesCollection] [insert] Insert method accepts File, not a FileList. You need to provide a real File. File must have `.name` property, and its size must be larger than zero.');\n        }\n\n        this.fileData = {\n          size: this.config.file.size,\n          type: this.config.type || this.config.file.type,\n          name: this.config.fileName || this.config.file.name,\n          meta: this.config.meta\n        };\n      }\n\n      if (this.collection.debug) {\n        console.time(`insert ${this.fileData.name}`);\n        console.time(`loadFile ${this.fileData.name}`);\n      }\n\n      if (this.collection._supportWebWorker && this.config.allowWebWorkers) {\n        try {\n          this.worker = new Worker(this.collection._webWorkerUrl);\n        } catch (wwError) {\n          this.worker = false;\n          this.collection._debug('[FilesCollection] [insert] [create WebWorker]: Can\\'t create WebWorker, fallback to MainThread', wwError);\n        }\n      } else {\n        this.worker = null;\n      }\n\n      this.startTime     = {};\n      this.config.debug  = this.collection.debug;\n      this.config._debug = this.collection._debug;\n      this.currentChunk  = 0;\n      this.transferTime  = 0;\n      this.trackerComp   = null;\n      this.sentChunks    = 0;\n      this.fileLength    = 1;\n      this.EOFsent       = false;\n      this.fileId        = this.config.fileId || Random.id();\n      this.FSName        = this.collection.namingFunction ? this.collection.namingFunction(this.fileData) : this.fileId;\n      this.pipes         = [];\n\n      this.fileData = Object.assign(this.fileData, this.collection._getExt(this.fileData.name), {mime: this.collection._getMimeType(this.fileData)});\n      this.fileData['mime-type'] = this.fileData.mime;\n\n      this.result = new FileUpload(Object.assign({}, this.config, {\n        fileData: this.fileData,\n        fileId: this.fileId,\n        _Abort: this.collection._methodNames._Abort\n      }));\n\n      this.beforeunload = (e) => {\n        const message = helpers.isFunction(this.collection.onbeforeunloadMessage) ? this.collection.onbeforeunloadMessage.call(this.result, this.fileData) : this.collection.onbeforeunloadMessage;\n\n        if (e) {\n          e.returnValue = message;\n        }\n        return message;\n      };\n\n      this.result.config.beforeunload = this.beforeunload;\n      window.addEventListener('beforeunload', this.beforeunload, false);\n\n      this.result.config._onEnd = () => this.emit('_onEnd');\n\n      this.addListener('end', this.end);\n      this.addListener('start', this.start);\n      this.addListener('upload', this.upload);\n      this.addListener('sendEOF', this.sendEOF);\n      this.addListener('prepare', this.prepare);\n      this.addListener('sendChunk', this.sendChunk);\n      this.addListener('proceedChunk', this.proceedChunk);\n      this.addListener('createStreams', this.createStreams);\n\n      this.addListener('calculateStats', helpers.throttle(() => {\n        const _t = (this.transferTime / this.sentChunks) / this.config.streams;\n        this.result.estimateTime.set((_t * (this.fileLength - this.sentChunks)));\n        this.result.estimateSpeed.set((this.config.chunkSize / (_t / 1000)));\n\n        const progress = Math.round((this.sentChunks / this.fileLength) * 100);\n        let sentBytes = this.config.chunkSize * this.sentChunks;\n        if (sentBytes > this.fileData.size) {\n          // this case often occurs, when the last chunk\n          // is smaller than chunkSize, so we limit to fileSize\n          sentBytes = this.fileData.size;\n        }\n\n        this.result.progress.set(progress);\n        this.config.onProgress && this.config.onProgress.call(this.result, progress, this.fileData);\n        this.result.emit('progress', progress, this.fileData, { chunksSent: this.sentChunks, chunksLength: this.fileLength, bytesSent: sentBytes });\n      }, 250));\n\n      this.addListener('_onEnd', () => {\n        if (this.result.estimateTimer) {\n          Meteor.clearInterval(this.result.estimateTimer);\n        }\n        if (this.worker) {\n          this.worker.terminate();\n        }\n        if (this.trackerComp) {\n          this.trackerComp.stop();\n        }\n        if (this.beforeunload) {\n          window.removeEventListener('beforeunload', this.beforeunload, false);\n        }\n        if (this.result) {\n          return this.result.progress.set(0);\n        }\n        return void 0;\n      });\n    } else {\n      throw new Meteor.Error(500, '[FilesCollection] [insert] Have you forget to pass a File itself?');\n    }\n  }\n\n  end(error, data) {\n    this.collection._debug('[FilesCollection] [UploadInstance] [end]', this.fileData.name);\n    if (this.collection.debug) {\n      console.timeEnd(`insert ${this.fileData.name}`);\n    }\n\n    this.emit('_onEnd');\n    this.result.emit('uploaded', error, data);\n    this.config.onUploaded && this.config.onUploaded.call(this.result, error, data);\n\n    if (error) {\n      this.collection._debug('[FilesCollection] [insert] [end] Error:', error);\n      this.result.abort();\n      this.result.state.set('aborted');\n      this.result.emit('error', error, this.fileData);\n      this.config.onError && this.config.onError.call(this.result, error, this.fileData);\n    } else {\n      this.result.state.set('completed');\n      this.collection.emit('afterUpload', data);\n    }\n    this.result.emit('end', error, (data || this.fileData));\n    return this.result;\n  }\n\n  sendChunk(evt) {\n    const opts = {\n      fileId: this.fileId,\n      binData: evt.data.bin,\n      chunkId: evt.data.chunkId\n    };\n\n    if (this.config.isBase64) {\n      const pad = opts.binData.length % 4;\n      if (pad) {\n        let p = 0;\n        while (p < pad) {\n          opts.binData += '=';\n          p++;\n        }\n      }\n    }\n\n    this.emit('data', evt.data.bin);\n    if (this.pipes.length) {\n      for (let i = this.pipes.length - 1; i >= 0; i--) {\n        opts.binData = this.pipes[i](opts.binData);\n      }\n    }\n\n    if (this.fileLength === evt.data.chunkId) {\n      if (this.collection.debug) {\n        console.timeEnd(`loadFile ${this.fileData.name}`);\n      }\n      this.emit('readEnd');\n    }\n\n    if (opts.binData) {\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, (error) => {\n          this.transferTime += (+new Date) - this.startTime[opts.chunkId];\n          if (error) {\n            if (this.result.state.get() !== 'aborted') {\n              this.emit('end', error);\n            }\n          } else {\n            ++this.sentChunks;\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n            this.emit('calculateStats');\n          }\n        });\n      } else {\n        HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n          content: opts.binData,\n          headers: {\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileid': opts.fileId,\n            'x-chunkid': opts.chunkId,\n            'content-type': 'text/plain'\n          },\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, (error) => {\n          this.transferTime += +new Date() - this.startTime[opts.chunkId];\n          if (error) {\n            if (`${error}` === 'Error: network' || `${error}` === 'Error: Connection lost') {\n              this.result.pause();\n            } else {\n              if (this.result.state.get() !== 'aborted') {\n                this.emit('end', error);\n              }\n            }\n          } else {\n            ++this.sentChunks;\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n            this.emit('calculateStats');\n          }\n        });\n      }\n    }\n  }\n\n  sendEOF() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [sendEOF]', this.EOFsent);\n    if (!this.EOFsent) {\n      this.EOFsent = true;\n      const opts = {\n        eof: true,\n        fileId: this.fileId\n      };\n\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, (error, result) => {\n          this.emit('end', error, result);\n        });\n      } else {\n        HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n          content: '',\n          headers: {\n            'x-eof': '1',\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileId': opts.fileId,\n            'content-type': 'text/plain'\n          },\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, (error, _result) => {\n          let result;\n          try {\n            result = JSON.parse((helpers.isObject(_result) ? _result.content : void 0) || {});\n          } catch (e) {\n            console.warn('Something went wrong! [sendEOF] method doesn\\'t returned JSON! Looks like you\\'re on Cordova app or behind proxy, switching to DDP transport is recommended.');\n            result = {};\n          }\n\n          if (result.meta) {\n            result.meta = fixJSONParse(result.meta);\n          }\n\n          this.emit('end', error, result);\n        });\n      }\n    }\n  }\n\n  proceedChunk(chunkId) {\n    const chunk = this.config.file.slice((this.config.chunkSize * (chunkId - 1)), (this.config.chunkSize * chunkId));\n\n    if (this.config.isBase64) {\n      this.emit('sendChunk', {\n        data: {\n          bin: chunk,\n          chunkId\n        }\n      });\n    } else {\n      let fileReader;\n      if (window.FileReader) {\n        fileReader = new window.FileReader;\n\n        fileReader.onloadend = (evt) => {\n          this.emit('sendChunk', {\n            data: {\n              bin: ((helpers.isObject(fileReader) ? fileReader.result : void 0) || (evt.srcElement ? evt.srcElement.result : void 0) || (evt.target ? evt.target.result : void 0)).split(',')[1],\n              chunkId\n            }\n          });\n        };\n\n        fileReader.onerror = (e) => {\n          this.emit('end', (e.target || e.srcElement).error);\n        };\n\n        fileReader.readAsDataURL(chunk);\n      } else if (window.FileReaderSync) {\n        fileReader = new window.FileReaderSync;\n\n        this.emit('sendChunk', {\n          data: {\n            bin: fileReader.readAsDataURL(chunk).split(',')[1],\n            chunkId\n          }\n        });\n      } else {\n        this.emit('end', 'File API is not supported in this Browser!');\n      }\n    }\n  }\n\n  upload() {\n    if (this.result.onPause.get()) {\n      return this;\n    }\n\n    if (this.result.state.get() === 'aborted') {\n      return this;\n    }\n\n    if (this.currentChunk <= this.fileLength) {\n      ++this.currentChunk;\n      if (this.worker) {\n        this.worker.postMessage({\n          f: this.config.file,\n          sc: this.sentChunks,\n          cc: this.currentChunk,\n          cs: this.config.chunkSize,\n          ib: this.config.isBase64\n        });\n      } else {\n        this.emit('proceedChunk', this.currentChunk);\n      }\n    } else {\n      this.emit('sendEOF');\n    }\n    this.startTime[this.currentChunk] = +new Date();\n    return this;\n  }\n\n  createStreams() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [createStreams]');\n    let i = 1;\n    while (i <= this.config.streams) {\n      this.emit('upload');\n      i++;\n    }\n  }\n\n  prepare() {\n    let _len;\n\n    this.config.onStart && this.config.onStart.call(this.result, null, this.fileData);\n    this.result.emit('start', null, this.fileData);\n\n    if (this.config.chunkSize === 'dynamic') {\n      this.config.chunkSize = this.fileData.size / 1000;\n      if (this.config.chunkSize < 327680) {\n        this.config.chunkSize = 327680;\n      } else if (this.config.chunkSize > 1048576) {\n        this.config.chunkSize = 1048576;\n      }\n\n      if (this.config.transport === 'http') {\n        this.config.chunkSize = Math.round(this.config.chunkSize / 2);\n      } else if (isSafari) {\n        this.config.chunkSize = Math.ceil(this.config.chunkSize / 8);\n      }\n    }\n\n    if (this.config.isBase64) {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 4) * 4;\n      _len = Math.ceil(this.config.file.length / this.config.chunkSize);\n    } else {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 8) * 8;\n      _len = Math.ceil(this.fileData.size / this.config.chunkSize);\n    }\n\n    if (this.config.streams === 'dynamic') {\n      this.config.streams = helpers.clone(_len);\n      if (this.config.streams > 24) { this.config.streams = 24; }\n\n      if (this.config.transport === 'http') {\n        this.config.streams = Math.round(this.config.streams / 2);\n      } else if (isSafari) {\n        this.config.streams = 1;\n      }\n    }\n\n    this.fileLength = _len <= 0 ? 1 : _len;\n    if (this.config.streams > this.fileLength) {\n      this.config.streams = this.fileLength;\n    }\n    this.result.config.fileLength = this.fileLength;\n\n    const opts = {\n      file: this.fileData,\n      fileId: this.fileId,\n      chunkSize: this.config.isBase64 ? ((this.config.chunkSize  / 4) * 3) : this.config.chunkSize,\n      fileLength: this.fileLength\n    };\n\n    if (this.FSName !== this.fileId) {\n      opts.FSName = this.FSName;\n    }\n\n    const handleStart = (error) => {\n      if (error) {\n        this.collection._debug('[FilesCollection] [_Start] Error:', error);\n        this.emit('end', error);\n      } else {\n        this.result.continueFunc = () => {\n          this.collection._debug('[FilesCollection] [insert] [continueFunc]');\n          this.emit('createStreams');\n        };\n        this.emit('createStreams');\n      }\n    };\n\n    if (this.config.transport === 'ddp') {\n      this.config.ddp.call(this.collection._methodNames._Start, opts, handleStart);\n    } else {\n      if (helpers.isObject(opts.file) ? opts.file.meta : void 0) {\n        opts.file.meta = fixJSONStringify(opts.file.meta);\n      }\n\n      HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n        data: opts,\n        headers: {\n          'x-start': '1',\n          'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null\n        },\n        beforeSend(xhr) {\n          xhr.withCredentials = true;\n          return true;\n        }\n      }, handleStart);\n    }\n  }\n\n  pipe(func) {\n    this.pipes.push(func);\n    return this;\n  }\n\n  start() {\n    let isUploadAllowed;\n    if (this.fileData.size <= 0) {\n      this.end(new Meteor.Error(400, 'Can\\'t upload empty file'));\n      return this.result;\n    }\n\n    if (this.config.onBeforeUpload && helpers.isFunction(this.config.onBeforeUpload)) {\n      isUploadAllowed = this.config.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'config.onBeforeUpload() returned false'));\n      }\n    }\n\n    if (this.collection.onBeforeUpload && helpers.isFunction(this.collection.onBeforeUpload)) {\n      isUploadAllowed = this.collection.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'collection.onBeforeUpload() returned false'));\n      }\n    }\n\n    Tracker.autorun((computation) => {\n      this.trackerComp = computation;\n      if (!this.result.onPause.curValue && !Meteor.status().connected) {\n        this.collection._debug('[FilesCollection] [insert] [Tracker] [pause]');\n        this.result.pause();\n      }\n    });\n\n    if (this.worker) {\n      this.collection._debug('[FilesCollection] [insert] using WebWorkers');\n      this.worker.onmessage = (evt) => {\n        if (evt.data.error) {\n          this.collection._debug('[FilesCollection] [insert] [worker] [onmessage] [ERROR:]', evt.data.error);\n          this.emit('proceedChunk', evt.data.chunkId);\n        } else {\n          this.emit('sendChunk', evt);\n        }\n      };\n\n      this.worker.onerror = (e) => {\n        this.collection._debug('[FilesCollection] [insert] [worker] [onerror] [ERROR:]', e);\n        this.emit('end', e.message);\n      };\n    } else {\n      this.collection._debug('[FilesCollection] [insert] using MainThread');\n    }\n\n    this.emit('prepare');\n    return this.result;\n  }\n\n  manual() {\n    this.result.start = () => {\n      this.emit('start');\n    };\n\n    const self = this;\n    this.result.pipe = function (func) {\n      self.pipe(func);\n      return this;\n    };\n    return this.result;\n  }\n}\n"]}}]