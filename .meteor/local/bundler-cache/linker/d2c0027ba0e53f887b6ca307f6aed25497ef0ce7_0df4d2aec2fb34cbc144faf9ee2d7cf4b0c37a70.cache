[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar HTTP = Package.http.HTTP;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package.modules.meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\nvar Symbol = Package['ecmascript-runtime-client'].Symbol;\nvar Map = Package['ecmascript-runtime-client'].Map;\nvar Set = Package['ecmascript-runtime-client'].Set;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"ostrio:cookies\":{\"cookies.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_cookies/cookies.js                                                                                 //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _assertThisInitialized;\n\nmodule.link(\"@babel/runtime/helpers/assertThisInitialized\", {\n  default: function (v) {\n    _assertThisInitialized = v;\n  }\n}, 0);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 1);\n\nvar _typeof;\n\nmodule.link(\"@babel/runtime/helpers/typeof\", {\n  default: function (v) {\n    _typeof = v;\n  }\n}, 2);\nmodule.export({\n  Cookies: function () {\n    return Cookies;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar HTTP;\nvar WebApp;\n\nif (Meteor.isServer) {\n  WebApp = require('meteor/webapp').WebApp;\n} else {\n  HTTP = require('meteor/http').HTTP;\n}\n\nvar NoOp = function () {};\n\nvar urlRE = /\\/___cookie___\\/set/;\nvar rootUrl = Meteor.isServer ? process.env.ROOT_URL : window.__meteor_runtime_config__.ROOT_URL || window.__meteor_runtime_config__.meteorEnv.ROOT_URL || false;\nvar mobileRootUrl = Meteor.isServer ? process.env.MOBILE_ROOT_URL : window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.meteorEnv.MOBILE_ROOT_URL || false;\nvar helpers = {\n  isUndefined: function (obj) {\n    return obj === void 0;\n  },\n  isArray: function (obj) {\n    return Array.isArray(obj);\n  },\n  clone: function (obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  }\n};\nvar _helpers = ['Number', 'Object', 'Function'];\n\nvar _loop = function (i) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n};\n\nfor (var i = 0; i < _helpers.length; i++) {\n  _loop(i);\n}\n/*\n * @url https://github.com/jshttp/cookie/blob/master/index.js\n * @name cookie\n * @author jshttp\n * @license\n * (The MIT License)\n *\n * Copyright (c) 2012-2014 Roman Shtylman <shtylman@gmail.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n/*\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n/*\n * @function\n * @name tryDecode\n * @param {String} str\n * @param {Function} d\n * @summary Try decoding a string using a decoding function.\n * @private\n */\n\nvar tryDecode = function (str, d) {\n  try {\n    return d(str);\n  } catch (e) {\n    return str;\n  }\n};\n/*\n * @function\n * @name parse\n * @param {String} str\n * @param {Object} [options]\n * @return {Object}\n * @summary\n * Parse a cookie header.\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n * @private\n */\n\n\nvar parse = function (str, options) {\n  if (typeof str !== 'string') {\n    throw new Meteor.Error(404, 'argument str must be a string');\n  }\n\n  var obj = {};\n  var opt = options || {};\n  var val;\n  var key;\n  var eqIndx;\n  str.split(pairSplitRegExp).forEach(function (pair) {\n    eqIndx = pair.indexOf('=');\n\n    if (eqIndx < 0) {\n      return;\n    }\n\n    key = pair.substr(0, eqIndx).trim();\n    key = tryDecode(unescape(key), opt.decode || decode);\n    val = pair.substr(++eqIndx, pair.length).trim();\n\n    if (val[0] === '\"') {\n      val = val.slice(1, -1);\n    }\n\n    if (void 0 === obj[key]) {\n      obj[key] = tryDecode(val, opt.decode || decode);\n    }\n  });\n  return obj;\n};\n/*\n * @function\n * @name antiCircular\n * @param data {Object} - Circular or any other object which needs to be non-circular\n * @private\n */\n\n\nvar antiCircular = function (_obj) {\n  var object = helpers.clone(_obj);\n  var cache = new Map();\n  return JSON.stringify(object, function (key, value) {\n    if (_typeof(value) === 'object' && value !== null) {\n      if (cache.get(value)) {\n        return void 0;\n      }\n\n      cache.set(value, true);\n    }\n\n    return value;\n  });\n};\n/*\n * @function\n * @name serialize\n * @param {String} name\n * @param {String} val\n * @param {Object} [options]\n * @return { cookieString: String, sanitizedValue: Mixed }\n * @summary\n * Serialize data into a cookie header.\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n * serialize('foo', 'bar', { httpOnly: true }) => \"foo=bar; httpOnly\"\n * @private\n */\n\n\nvar serialize = function (key, val) {\n  var opt = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var name;\n\n  if (!fieldContentRegExp.test(key)) {\n    name = escape(key);\n  } else {\n    name = key;\n  }\n\n  var sanitizedValue = val;\n  var value = val;\n\n  if (!helpers.isUndefined(value)) {\n    if (helpers.isObject(value) || helpers.isArray(value)) {\n      var stringified = antiCircular(value);\n      value = encode(\"JSON.parse(\" + stringified + \")\");\n      sanitizedValue = JSON.parse(stringified);\n    } else {\n      value = encode(value);\n\n      if (value && !fieldContentRegExp.test(value)) {\n        value = escape(value);\n      }\n    }\n  } else {\n    value = '';\n  }\n\n  var pairs = [name + \"=\" + value];\n\n  if (helpers.isNumber(opt.maxAge)) {\n    pairs.push(\"Max-Age=\" + opt.maxAge);\n  }\n\n  if (opt.domain && typeof opt.domain === 'string') {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new Meteor.Error(404, 'option domain is invalid');\n    }\n\n    pairs.push(\"Domain=\" + opt.domain);\n  }\n\n  if (opt.path && typeof opt.path === 'string') {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new Meteor.Error(404, 'option path is invalid');\n    }\n\n    pairs.push(\"Path=\" + opt.path);\n  } else {\n    pairs.push('Path=/');\n  }\n\n  opt.expires = opt.expires || opt.expire || false;\n\n  if (opt.expires === Infinity) {\n    pairs.push('Expires=Fri, 31 Dec 9999 23:59:59 GMT');\n  } else if (opt.expires instanceof Date) {\n    pairs.push(\"Expires=\" + opt.expires.toUTCString());\n  } else if (opt.expires === 0) {\n    pairs.push('Expires=0');\n  } else if (helpers.isNumber(opt.expires)) {\n    pairs.push(\"Expires=\" + new Date(opt.expires).toUTCString());\n  }\n\n  if (opt.httpOnly) {\n    pairs.push('HttpOnly');\n  }\n\n  if (opt.secure) {\n    pairs.push('Secure');\n  }\n\n  if (opt.firstPartyOnly) {\n    pairs.push('First-Party-Only');\n  }\n\n  if (opt.sameSite) {\n    pairs.push(opt.sameSite === true ? 'SameSite' : \"SameSite=\" + opt.sameSite);\n  }\n\n  return {\n    cookieString: pairs.join('; '),\n    sanitizedValue: sanitizedValue\n  };\n};\n\nvar isStringifiedRegEx = /JSON\\.parse\\((.*)\\)/;\nvar isTypedRegEx = /false|true|null|undefined/;\n\nvar deserialize = function (string) {\n  if (typeof string !== 'string') {\n    return string;\n  }\n\n  if (isStringifiedRegEx.test(string)) {\n    var obj = string.match(isStringifiedRegEx)[1];\n\n    if (obj) {\n      try {\n        return JSON.parse(decode(obj));\n      } catch (e) {\n        console.error('[ostrio:cookies] [.get()] [deserialize()] Exception:', e, string, obj);\n        return string;\n      }\n    }\n\n    return string;\n  } else if (isTypedRegEx.test(string)) {\n    return JSON.parse(string);\n  }\n\n  return string;\n};\n/*\n * @locus Anywhere\n * @class __cookies\n * @param opts {Object} - Options (configuration) object\n * @param opts._cookies {Object|String} - Current cookies as String or Object\n * @param opts.TTL {Number|Boolean} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.response {http.ServerResponse|Object} - This object is created internally by a HTTP server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Internal Class\n */\n\n\nvar __cookies = /*#__PURE__*/function () {\n  function __cookies(opts) {\n    this.__pendingCookies = [];\n    this.TTL = opts.TTL || false;\n    this.response = opts.response || false;\n    this.runOnServer = opts.runOnServer || false;\n    this.allowQueryStringCookies = opts.allowQueryStringCookies || false;\n    this.allowedCordovaOrigins = opts.allowedCordovaOrigins || false;\n\n    if (this.allowedCordovaOrigins === true) {\n      this.allowedCordovaOrigins = /^http:\\/\\/localhost:12[0-9]{3}$/;\n    }\n\n    this.originRE = new RegExp(\"^https?://(\" + (rootUrl ? rootUrl : '') + (mobileRootUrl ? '|' + mobileRootUrl : '') + \")$\");\n\n    if (helpers.isObject(opts._cookies)) {\n      this.cookies = opts._cookies;\n    } else {\n      this.cookies = parse(opts._cookies);\n    }\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name get\n   * @param {String} key  - The name of the cookie to read\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Read a cookie. If the cookie doesn't exist a null value will be returned.\n   * @returns {String|void}\n   */\n\n\n  var _proto = __cookies.prototype;\n\n  _proto.get = function () {\n    function get(key, _tmp) {\n      var cookieString = _tmp ? parse(_tmp) : this.cookies;\n\n      if (!key || !cookieString) {\n        return void 0;\n      }\n\n      if (cookieString.hasOwnProperty(key)) {\n        return deserialize(cookieString[key]);\n      }\n\n      return void 0;\n    }\n\n    return get;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name set\n   * @param {String} key   - The name of the cookie to create/overwrite\n   * @param {String} value - The value of the cookie\n   * @param {Object} opts  - [Optional] Cookie options (see readme docs)\n   * @summary Create/overwrite a cookie.\n   * @returns {Boolean}\n   */\n  ;\n\n  _proto.set = function () {\n    function set(key, value) {\n      var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n      if (key && !helpers.isUndefined(value)) {\n        if (helpers.isNumber(this.TTL) && opts.expires === undefined) {\n          opts.expires = new Date(+new Date() + this.TTL);\n        }\n\n        var _serialize = serialize(key, value, opts),\n            cookieString = _serialize.cookieString,\n            sanitizedValue = _serialize.sanitizedValue;\n\n        this.cookies[key] = sanitizedValue;\n\n        if (Meteor.isClient) {\n          document.cookie = cookieString;\n        } else if (this.response) {\n          this.__pendingCookies.push(cookieString);\n\n          this.response.setHeader('Set-Cookie', this.__pendingCookies);\n        }\n\n        return true;\n      }\n\n      return false;\n    }\n\n    return set;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name remove\n   * @param {String} key    - The name of the cookie to create/overwrite\n   * @param {String} path   - [Optional] The path from where the cookie will be\n   * readable. E.g., \"/\", \"/mydir\"; if not specified, defaults to the current\n   * path of the current document location (string or null). The path must be\n   * absolute (see RFC 2965). For more information on how to use relative paths\n   * in this argument, see: https://developer.mozilla.org/en-US/docs/Web/API/document.cookie#Using_relative_URLs_in_the_path_parameter\n   * @param {String} domain - [Optional] The domain from where the cookie will\n   * be readable. E.g., \"example.com\", \".example.com\" (includes all subdomains)\n   * or \"subdomain.example.com\"; if not specified, defaults to the host portion\n   * of the current document location (string or null).\n   * @summary Remove a cookie(s).\n   * @returns {Boolean}\n   */\n  ;\n\n  _proto.remove = function () {\n    function remove(key) {\n      var path = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '/';\n      var domain = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n\n      if (key && this.cookies.hasOwnProperty(key)) {\n        var _serialize2 = serialize(key, '', {\n          domain: domain,\n          path: path,\n          expires: new Date(0)\n        }),\n            cookieString = _serialize2.cookieString;\n\n        delete this.cookies[key];\n\n        if (Meteor.isClient) {\n          document.cookie = cookieString;\n        } else if (this.response) {\n          this.response.setHeader('Set-Cookie', cookieString);\n        }\n\n        return true;\n      } else if (!key && this.keys().length > 0 && this.keys()[0] !== '') {\n        var keys = Object.keys(this.cookies);\n\n        for (var _i = 0; _i < keys.length; _i++) {\n          this.remove(keys[_i]);\n        }\n\n        return true;\n      }\n\n      return false;\n    }\n\n    return remove;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name has\n   * @param {String} key  - The name of the cookie to create/overwrite\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Check whether a cookie exists in the current position.\n   * @returns {Boolean}\n   */\n  ;\n\n  _proto.has = function () {\n    function has(key, _tmp) {\n      var cookieString = _tmp ? parse(_tmp) : this.cookies;\n\n      if (!key || !cookieString) {\n        return false;\n      }\n\n      return cookieString.hasOwnProperty(key);\n    }\n\n    return has;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name keys\n   * @summary Returns an array of all readable cookies from this location.\n   * @returns {[String]}\n   */\n  ;\n\n  _proto.keys = function () {\n    function keys() {\n      if (this.cookies) {\n        return Object.keys(this.cookies);\n      }\n\n      return [];\n    }\n\n    return keys;\n  }()\n  /*\n   * @locus Client\n   * @memberOf __cookies\n   * @name send\n   * @param cb {Function} - Callback\n   * @summary Send all cookies over XHR to server.\n   * @returns {void}\n   */\n  ;\n\n  _proto.send = function () {\n    function send() {\n      var cb = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NoOp;\n\n      if (Meteor.isServer) {\n        cb(new Meteor.Error(400, 'Can\\'t run `.send()` on server, it\\'s Client only method!'));\n      }\n\n      if (this.runOnServer) {\n        var path = (window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || window.__meteor_runtime_config__.meteorEnv.ROOT_URL_PATH_PREFIX || '') + \"/___cookie___/set\";\n        var query = '';\n\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          var cookiesKeys = this.keys();\n          var cookiesArray = [];\n\n          for (var _i2 = 0; _i2 < cookiesKeys.length; _i2++) {\n            var _serialize3 = serialize(cookiesKeys[_i2], this.get(cookiesKeys[_i2])),\n                sanitizedValue = _serialize3.sanitizedValue;\n\n            var pair = cookiesKeys[_i2] + \"=\" + sanitizedValue;\n\n            if (!cookiesArray.includes(pair)) {\n              cookiesArray.push(pair);\n            }\n          }\n\n          if (cookiesArray.length) {\n            path = Meteor.absoluteUrl('___cookie___/set');\n            query = \"?___cookies___=\" + encodeURIComponent(cookiesArray.join('; '));\n          }\n        }\n\n        HTTP.get(\"\" + path + query, {\n          beforeSend: function (xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, cb);\n      } else {\n        cb(new Meteor.Error(400, 'Can\\'t send cookies on server when `runOnServer` is false.'));\n      }\n\n      return void 0;\n    }\n\n    return send;\n  }();\n\n  return __cookies;\n}();\n/*\n * @function\n * @locus Server\n * @summary Middleware handler\n * @private\n */\n\n\nvar __middlewareHandler = function (request, response, opts) {\n  var _cookies = {};\n\n  if (opts.runOnServer) {\n    if (request.headers && request.headers.cookie) {\n      _cookies = parse(request.headers.cookie);\n    }\n\n    return new __cookies({\n      _cookies: _cookies,\n      TTL: opts.TTL,\n      runOnServer: opts.runOnServer,\n      response: response,\n      allowQueryStringCookies: opts.allowQueryStringCookies\n    });\n  }\n\n  throw new Meteor.Error(400, 'Can\\'t use middleware when `runOnServer` is false.');\n};\n/*\n * @locus Anywhere\n * @class Cookies\n * @param opts {Object}\n * @param opts.TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.auto {Boolean} - [Server] Auto-bind in middleware as `req.Cookies`, by default `true`\n * @param opts.handler {Function} - [Server] Middleware handler\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Main Cookie class\n */\n\n\nvar Cookies = /*#__PURE__*/function (_cookies2) {\n  _inheritsLoose(Cookies, _cookies2);\n\n  function Cookies() {\n    var _this;\n\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    opts.TTL = helpers.isNumber(opts.TTL) ? opts.TTL : false;\n    opts.runOnServer = opts.runOnServer !== false ? true : false;\n    opts.allowQueryStringCookies = opts.allowQueryStringCookies !== true ? false : true;\n\n    if (Meteor.isClient) {\n      opts._cookies = document.cookie;\n      _this = _cookies2.call(this, opts) || this;\n    } else {\n      opts._cookies = {};\n      _this = _cookies2.call(this, opts) || this;\n      opts.auto = opts.auto !== false ? true : false;\n      _this.opts = opts;\n      _this.handler = helpers.isFunction(opts.handler) ? opts.handler : false;\n      _this.onCookies = helpers.isFunction(opts.onCookies) ? opts.onCookies : false;\n\n      if (opts.runOnServer && !Cookies.isLoadedOnServer) {\n        Cookies.isLoadedOnServer = true;\n\n        if (opts.auto) {\n          WebApp.connectHandlers.use(function (req, res, next) {\n            if (urlRE.test(req._parsedUrl.path)) {\n              var matchedCordovaOrigin = !!req.headers.origin && _this.allowedCordovaOrigins && _this.allowedCordovaOrigins.test(req.headers.origin);\n\n              var matchedOrigin = matchedCordovaOrigin || !!req.headers.origin && _this.originRE.test(req.headers.origin);\n\n              if (matchedOrigin) {\n                res.setHeader('Access-Control-Allow-Credentials', 'true');\n                res.setHeader('Access-Control-Allow-Origin', req.headers.origin);\n              }\n\n              var cookiesArray = [];\n              var cookiesObject = {};\n\n              if (matchedCordovaOrigin && opts.allowQueryStringCookies && req.query.___cookies___) {\n                cookiesObject = parse(decodeURIComponent(req.query.___cookies___));\n              } else if (req.headers.cookie) {\n                cookiesObject = parse(req.headers.cookie);\n              }\n\n              var cookiesKeys = Object.keys(cookiesObject);\n\n              if (cookiesKeys.length) {\n                for (var _i3 = 0; _i3 < cookiesKeys.length; _i3++) {\n                  var _serialize4 = serialize(cookiesKeys[_i3], cookiesObject[cookiesKeys[_i3]]),\n                      cookieString = _serialize4.cookieString;\n\n                  if (!cookiesArray.includes(cookieString)) {\n                    cookiesArray.push(cookieString);\n                  }\n                }\n\n                if (cookiesArray.length) {\n                  res.setHeader('Set-Cookie', cookiesArray);\n                }\n              }\n\n              helpers.isFunction(_this.onCookies) && _this.onCookies(__middlewareHandler(req, res, opts));\n              res.writeHead(200);\n              res.end('');\n            } else {\n              req.Cookies = __middlewareHandler(req, res, opts);\n              helpers.isFunction(_this.handler) && _this.handler(req.Cookies);\n              next();\n            }\n          });\n        }\n      }\n    }\n\n    return _assertThisInitialized(_this);\n  }\n  /*\n   * @locus Server\n   * @memberOf Cookies\n   * @name middleware\n   * @summary Get Cookies instance into callback\n   * @returns {void}\n   */\n\n\n  var _proto2 = Cookies.prototype;\n\n  _proto2.middleware = function () {\n    function middleware() {\n      var _this2 = this;\n\n      if (!Meteor.isServer) {\n        throw new Meteor.Error(500, '[ostrio:cookies] Can\\'t use `.middleware()` on Client, it\\'s Server only!');\n      }\n\n      return function (req, res, next) {\n        helpers.isFunction(_this2.handler) && _this2.handler(__middlewareHandler(req, res, _this2.opts));\n        next();\n      };\n    }\n\n    return middleware;\n  }();\n\n  return Cookies;\n}(__cookies);\n\nif (Meteor.isServer) {\n  Cookies.isLoadedOnServer = false;\n}\n/* Export the Cookies class */\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/ostrio:cookies/cookies.js\");\n\n/* Exports */\nPackage._define(\"ostrio:cookies\", exports);\n\n})();\n","servePath":"/packages/ostrio_cookies.js","sourceMap":{"version":3,"sources":["packages/ostrio:cookies/cookies.js"],"names":["_assertThisInitialized","module","link","default","v","_inheritsLoose","_typeof","export","Cookies","Meteor","HTTP","WebApp","isServer","require","NoOp","urlRE","rootUrl","process","env","ROOT_URL","window","__meteor_runtime_config__","meteorEnv","mobileRootUrl","MOBILE_ROOT_URL","helpers","isUndefined","obj","isArray","Array","clone","isObject","slice","Object","assign","_helpers","i","prototype","toString","call","length","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","tryDecode","str","d","e","parse","options","Error","opt","val","key","eqIndx","split","forEach","pair","indexOf","substr","trim","unescape","antiCircular","_obj","object","cache","Map","JSON","stringify","value","get","set","serialize","name","test","escape","sanitizedValue","stringified","pairs","isNumber","maxAge","push","domain","path","expires","expire","Infinity","Date","toUTCString","httpOnly","secure","firstPartyOnly","sameSite","cookieString","join","isStringifiedRegEx","isTypedRegEx","deserialize","string","match","console","error","__cookies","opts","__pendingCookies","TTL","response","runOnServer","allowQueryStringCookies","allowedCordovaOrigins","originRE","RegExp","_cookies","cookies","_tmp","hasOwnProperty","undefined","isClient","document","cookie","setHeader","remove","keys","has","send","cb","ROOT_URL_PATH_PREFIX","query","isCordova","cookiesKeys","cookiesArray","includes","absoluteUrl","beforeSend","xhr","withCredentials","__middlewareHandler","request","headers","auto","handler","isFunction","onCookies","isLoadedOnServer","connectHandlers","use","req","res","next","_parsedUrl","matchedCordovaOrigin","origin","matchedOrigin","cookiesObject","___cookies___","writeHead","end","middleware"],"mappings":"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","file":"/packages/ostrio_cookies.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nlet HTTP;\nlet WebApp;\n\nif (Meteor.isServer) {\n  WebApp = require('meteor/webapp').WebApp;\n} else {\n  HTTP = require('meteor/http').HTTP;\n}\n\nconst NoOp  = () => {};\nconst urlRE = /\\/___cookie___\\/set/;\nconst rootUrl = Meteor.isServer ? process.env.ROOT_URL : (window.__meteor_runtime_config__.ROOT_URL || window.__meteor_runtime_config__.meteorEnv.ROOT_URL || false);\nconst mobileRootUrl = Meteor.isServer ? process.env.MOBILE_ROOT_URL : (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.meteorEnv.MOBILE_ROOT_URL || false);\n\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  }\n};\nconst _helpers = ['Number', 'Object', 'Function'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @url https://github.com/jshttp/cookie/blob/master/index.js\n * @name cookie\n * @author jshttp\n * @license\n * (The MIT License)\n *\n * Copyright (c) 2012-2014 Roman Shtylman <shtylman@gmail.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nconst decode = decodeURIComponent;\nconst encode = encodeURIComponent;\nconst pairSplitRegExp = /; */;\n\n/*\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/*\n * @function\n * @name tryDecode\n * @param {String} str\n * @param {Function} d\n * @summary Try decoding a string using a decoding function.\n * @private\n */\nconst tryDecode = (str, d) => {\n  try {\n    return d(str);\n  } catch (e) {\n    return str;\n  }\n};\n\n/*\n * @function\n * @name parse\n * @param {String} str\n * @param {Object} [options]\n * @return {Object}\n * @summary\n * Parse a cookie header.\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n * @private\n */\nconst parse = (str, options) => {\n  if (typeof str !== 'string') {\n    throw new Meteor.Error(404, 'argument str must be a string');\n  }\n  const obj = {};\n  const opt = options || {};\n  let val;\n  let key;\n  let eqIndx;\n\n  str.split(pairSplitRegExp).forEach((pair) => {\n    eqIndx = pair.indexOf('=');\n    if (eqIndx < 0) {\n      return;\n    }\n    key = pair.substr(0, eqIndx).trim();\n    key = tryDecode(unescape(key), (opt.decode || decode));\n    val = pair.substr(++eqIndx, pair.length).trim();\n    if (val[0] === '\"') {\n      val = val.slice(1, -1);\n    }\n    if (void 0 === obj[key]) {\n      obj[key] = tryDecode(val, (opt.decode || decode));\n    }\n  });\n  return obj;\n};\n\n/*\n * @function\n * @name antiCircular\n * @param data {Object} - Circular or any other object which needs to be non-circular\n * @private\n */\nconst antiCircular = (_obj) => {\n  const object = helpers.clone(_obj);\n  const cache  = new Map();\n  return JSON.stringify(object, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.get(value)) {\n        return void 0;\n      }\n      cache.set(value, true);\n    }\n    return value;\n  });\n};\n\n/*\n * @function\n * @name serialize\n * @param {String} name\n * @param {String} val\n * @param {Object} [options]\n * @return { cookieString: String, sanitizedValue: Mixed }\n * @summary\n * Serialize data into a cookie header.\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n * serialize('foo', 'bar', { httpOnly: true }) => \"foo=bar; httpOnly\"\n * @private\n */\nconst serialize = (key, val, opt = {}) => {\n  let name;\n\n  if (!fieldContentRegExp.test(key)) {\n    name = escape(key);\n  } else {\n    name = key;\n  }\n\n  let sanitizedValue = val;\n  let value = val;\n  if (!helpers.isUndefined(value)) {\n    if (helpers.isObject(value) || helpers.isArray(value)) {\n      const stringified = antiCircular(value);\n      value = encode(`JSON.parse(${stringified})`);\n      sanitizedValue = JSON.parse(stringified);\n    } else {\n      value = encode(value);\n      if (value && !fieldContentRegExp.test(value)) {\n        value = escape(value);\n      }\n    }\n  } else {\n    value = '';\n  }\n\n  const pairs = [`${name}=${value}`];\n\n  if (helpers.isNumber(opt.maxAge)) {\n    pairs.push(`Max-Age=${opt.maxAge}`);\n  }\n\n  if (opt.domain && typeof opt.domain === 'string') {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new Meteor.Error(404, 'option domain is invalid');\n    }\n    pairs.push(`Domain=${opt.domain}`);\n  }\n\n  if (opt.path && typeof opt.path === 'string') {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new Meteor.Error(404, 'option path is invalid');\n    }\n    pairs.push(`Path=${opt.path}`);\n  } else {\n    pairs.push('Path=/');\n  }\n\n  opt.expires = opt.expires || opt.expire || false;\n  if (opt.expires === Infinity) {\n    pairs.push('Expires=Fri, 31 Dec 9999 23:59:59 GMT');\n  } else if (opt.expires instanceof Date) {\n    pairs.push(`Expires=${opt.expires.toUTCString()}`);\n  } else if (opt.expires === 0) {\n    pairs.push('Expires=0');\n  } else if (helpers.isNumber(opt.expires)) {\n    pairs.push(`Expires=${(new Date(opt.expires)).toUTCString()}`);\n  }\n\n  if (opt.httpOnly) {\n    pairs.push('HttpOnly');\n  }\n\n  if (opt.secure) {\n    pairs.push('Secure');\n  }\n\n  if (opt.firstPartyOnly) {\n    pairs.push('First-Party-Only');\n  }\n\n  if (opt.sameSite) {\n    pairs.push(opt.sameSite === true ? 'SameSite' : `SameSite=${opt.sameSite}`);\n  }\n\n  return { cookieString: pairs.join('; '), sanitizedValue };\n};\n\nconst isStringifiedRegEx = /JSON\\.parse\\((.*)\\)/;\nconst isTypedRegEx = /false|true|null|undefined/;\nconst deserialize = (string) => {\n  if (typeof string !== 'string') {\n    return string;\n  }\n\n  if (isStringifiedRegEx.test(string)) {\n    let obj = string.match(isStringifiedRegEx)[1];\n    if (obj) {\n      try {\n        return JSON.parse(decode(obj));\n      } catch (e) {\n        console.error('[ostrio:cookies] [.get()] [deserialize()] Exception:', e, string, obj);\n        return string;\n      }\n    }\n    return string;\n  } else if (isTypedRegEx.test(string)) {\n    return JSON.parse(string);\n  }\n  return string;\n};\n\n/*\n * @locus Anywhere\n * @class __cookies\n * @param opts {Object} - Options (configuration) object\n * @param opts._cookies {Object|String} - Current cookies as String or Object\n * @param opts.TTL {Number|Boolean} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.response {http.ServerResponse|Object} - This object is created internally by a HTTP server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Internal Class\n */\nclass __cookies {\n  constructor(opts) {\n    this.__pendingCookies = [];\n    this.TTL = opts.TTL || false;\n    this.response = opts.response || false;\n    this.runOnServer = opts.runOnServer || false;\n    this.allowQueryStringCookies = opts.allowQueryStringCookies || false;\n    this.allowedCordovaOrigins = opts.allowedCordovaOrigins || false;\n\n    if (this.allowedCordovaOrigins === true) {\n      this.allowedCordovaOrigins = /^http:\\/\\/localhost:12[0-9]{3}$/;\n    }\n\n    this.originRE = new RegExp(`^https?:\\/\\/(${rootUrl ? rootUrl : ''}${mobileRootUrl ? ('|' + mobileRootUrl) : ''})$`);\n\n    if (helpers.isObject(opts._cookies)) {\n      this.cookies = opts._cookies;\n    } else {\n      this.cookies = parse(opts._cookies);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name get\n   * @param {String} key  - The name of the cookie to read\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Read a cookie. If the cookie doesn't exist a null value will be returned.\n   * @returns {String|void}\n   */\n  get(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return void 0;\n    }\n\n    if (cookieString.hasOwnProperty(key)) {\n      return deserialize(cookieString[key]);\n    }\n\n    return void 0;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name set\n   * @param {String} key   - The name of the cookie to create/overwrite\n   * @param {String} value - The value of the cookie\n   * @param {Object} opts  - [Optional] Cookie options (see readme docs)\n   * @summary Create/overwrite a cookie.\n   * @returns {Boolean}\n   */\n  set(key, value, opts = {}) {\n    if (key && !helpers.isUndefined(value)) {\n      if (helpers.isNumber(this.TTL) && opts.expires === undefined) {\n        opts.expires = new Date(+new Date() + this.TTL);\n      }\n      const { cookieString, sanitizedValue } = serialize(key, value, opts);\n\n      this.cookies[key] = sanitizedValue;\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else if (this.response) {\n        this.__pendingCookies.push(cookieString);\n        this.response.setHeader('Set-Cookie', this.__pendingCookies);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name remove\n   * @param {String} key    - The name of the cookie to create/overwrite\n   * @param {String} path   - [Optional] The path from where the cookie will be\n   * readable. E.g., \"/\", \"/mydir\"; if not specified, defaults to the current\n   * path of the current document location (string or null). The path must be\n   * absolute (see RFC 2965). For more information on how to use relative paths\n   * in this argument, see: https://developer.mozilla.org/en-US/docs/Web/API/document.cookie#Using_relative_URLs_in_the_path_parameter\n   * @param {String} domain - [Optional] The domain from where the cookie will\n   * be readable. E.g., \"example.com\", \".example.com\" (includes all subdomains)\n   * or \"subdomain.example.com\"; if not specified, defaults to the host portion\n   * of the current document location (string or null).\n   * @summary Remove a cookie(s).\n   * @returns {Boolean}\n   */\n  remove(key, path = '/', domain = '') {\n    if (key && this.cookies.hasOwnProperty(key)) {\n      const { cookieString } = serialize(key, '', {\n        domain,\n        path,\n        expires: new Date(0)\n      });\n\n      delete this.cookies[key];\n      if (Meteor.isClient) {\n        document.cookie = cookieString;\n      } else if (this.response) {\n        this.response.setHeader('Set-Cookie', cookieString);\n      }\n      return true;\n    } else if (!key && this.keys().length > 0 && this.keys()[0] !== '') {\n      const keys = Object.keys(this.cookies);\n      for (let i = 0; i < keys.length; i++) {\n        this.remove(keys[i]);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name has\n   * @param {String} key  - The name of the cookie to create/overwrite\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Check whether a cookie exists in the current position.\n   * @returns {Boolean}\n   */\n  has(key, _tmp) {\n    const cookieString = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !cookieString) {\n      return false;\n    }\n\n    return cookieString.hasOwnProperty(key);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name keys\n   * @summary Returns an array of all readable cookies from this location.\n   * @returns {[String]}\n   */\n  keys() {\n    if (this.cookies) {\n      return Object.keys(this.cookies);\n    }\n    return [];\n  }\n\n  /*\n   * @locus Client\n   * @memberOf __cookies\n   * @name send\n   * @param cb {Function} - Callback\n   * @summary Send all cookies over XHR to server.\n   * @returns {void}\n   */\n  send(cb = NoOp) {\n    if (Meteor.isServer) {\n      cb(new Meteor.Error(400, 'Can\\'t run `.send()` on server, it\\'s Client only method!'));\n    }\n\n    if (this.runOnServer) {\n      let path = `${window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || window.__meteor_runtime_config__.meteorEnv.ROOT_URL_PATH_PREFIX || ''}/___cookie___/set`;\n      let query = '';\n\n      if (Meteor.isCordova && this.allowQueryStringCookies) {\n        const cookiesKeys = this.keys();\n        const cookiesArray = [];\n        for (let i = 0; i < cookiesKeys.length; i++) {\n          const { sanitizedValue } = serialize(cookiesKeys[i], this.get(cookiesKeys[i]));\n          const pair = `${cookiesKeys[i]}=${sanitizedValue}`;\n          if (!cookiesArray.includes(pair)) {\n            cookiesArray.push(pair);\n          }\n        }\n\n        if (cookiesArray.length) {\n          path = Meteor.absoluteUrl('___cookie___/set');\n          query = `?___cookies___=${encodeURIComponent(cookiesArray.join('; '))}`;\n        }\n      }\n\n      HTTP.get(`${path}${query}`, {\n        beforeSend(xhr) {\n          xhr.withCredentials = true;\n          return true;\n        }\n      }, cb);\n    } else {\n      cb(new Meteor.Error(400, 'Can\\'t send cookies on server when `runOnServer` is false.'));\n    }\n    return void 0;\n  }\n}\n\n/*\n * @function\n * @locus Server\n * @summary Middleware handler\n * @private\n */\nconst __middlewareHandler = (request, response, opts) => {\n  let _cookies = {};\n  if (opts.runOnServer) {\n    if (request.headers && request.headers.cookie) {\n      _cookies = parse(request.headers.cookie);\n    }\n\n    return new __cookies({\n      _cookies,\n      TTL: opts.TTL,\n      runOnServer: opts.runOnServer,\n      response,\n      allowQueryStringCookies: opts.allowQueryStringCookies\n    });\n  }\n\n  throw new Meteor.Error(400, 'Can\\'t use middleware when `runOnServer` is false.');\n};\n\n/*\n * @locus Anywhere\n * @class Cookies\n * @param opts {Object}\n * @param opts.TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.auto {Boolean} - [Server] Auto-bind in middleware as `req.Cookies`, by default `true`\n * @param opts.handler {Function} - [Server] Middleware handler\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @param opts.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment\n * @param opts.allowedCordovaOrigins {Regex|Boolean} - [Server] Allow setting Cookies from that specific origin which in Meteor/Cordova is localhost:12XXX (^http://localhost:12[0-9]{3}$)\n * @summary Main Cookie class\n */\nclass Cookies extends __cookies {\n  constructor(opts = {}) {\n    opts.TTL = helpers.isNumber(opts.TTL) ? opts.TTL : false;\n    opts.runOnServer = (opts.runOnServer !== false) ? true : false;\n    opts.allowQueryStringCookies = (opts.allowQueryStringCookies !== true) ? false : true;\n\n    if (Meteor.isClient) {\n      opts._cookies = document.cookie;\n      super(opts);\n    } else {\n      opts._cookies = {};\n      super(opts);\n      opts.auto = (opts.auto !== false) ? true : false;\n      this.opts = opts;\n      this.handler = helpers.isFunction(opts.handler) ? opts.handler : false;\n      this.onCookies = helpers.isFunction(opts.onCookies) ? opts.onCookies : false;\n\n      if (opts.runOnServer && !Cookies.isLoadedOnServer) {\n        Cookies.isLoadedOnServer = true;\n        if (opts.auto) {\n          WebApp.connectHandlers.use((req, res, next) => {\n            if (urlRE.test(req._parsedUrl.path)) {\n              const matchedCordovaOrigin = !!req.headers.origin\n                && this.allowedCordovaOrigins\n                && this.allowedCordovaOrigins.test(req.headers.origin);\n              const matchedOrigin = matchedCordovaOrigin\n                || (!!req.headers.origin && this.originRE.test(req.headers.origin));\n\n              if (matchedOrigin) {\n                res.setHeader('Access-Control-Allow-Credentials', 'true');\n                res.setHeader('Access-Control-Allow-Origin', req.headers.origin);\n              }\n\n              const cookiesArray = [];\n              let cookiesObject = {};\n              if (matchedCordovaOrigin && opts.allowQueryStringCookies && req.query.___cookies___) {\n                cookiesObject = parse(decodeURIComponent(req.query.___cookies___));\n              } else if (req.headers.cookie) {\n                cookiesObject = parse(req.headers.cookie);\n              }\n\n              const cookiesKeys = Object.keys(cookiesObject);\n              if (cookiesKeys.length) {\n                for (let i = 0; i < cookiesKeys.length; i++) {\n                  const { cookieString } = serialize(cookiesKeys[i], cookiesObject[cookiesKeys[i]]);\n                  if (!cookiesArray.includes(cookieString)) {\n                    cookiesArray.push(cookieString);\n                  }\n                }\n\n                if (cookiesArray.length) {\n                  res.setHeader('Set-Cookie', cookiesArray);\n                }\n              }\n\n              helpers.isFunction(this.onCookies) && this.onCookies(__middlewareHandler(req, res, opts));\n\n              res.writeHead(200);\n              res.end('');\n            } else {\n              req.Cookies = __middlewareHandler(req, res, opts);\n              helpers.isFunction(this.handler) && this.handler(req.Cookies);\n              next();\n            }\n          });\n        }\n      }\n    }\n  }\n\n  /*\n   * @locus Server\n   * @memberOf Cookies\n   * @name middleware\n   * @summary Get Cookies instance into callback\n   * @returns {void}\n   */\n  middleware() {\n    if (!Meteor.isServer) {\n      throw new Meteor.Error(500, '[ostrio:cookies] Can\\'t use `.middleware()` on Client, it\\'s Server only!');\n    }\n\n    return (req, res, next) => {\n      helpers.isFunction(this.handler) && this.handler(__middlewareHandler(req, res, this.opts));\n      next();\n    };\n  }\n}\n\nif (Meteor.isServer) {\n  Cookies.isLoadedOnServer = false;\n}\n\n/* Export the Cookies class */\nexport { Cookies };\n"]}}]