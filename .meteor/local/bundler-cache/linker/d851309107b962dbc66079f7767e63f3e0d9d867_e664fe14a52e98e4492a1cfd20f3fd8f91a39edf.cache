[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar ReactiveVar = Package['reactive-var'].ReactiveVar;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar HTTP = Package.http.HTTP;\nvar DDP = Package['ddp-client'].DDP;\nvar Mongo = Package.mongo.Mongo;\nvar check = Package.check.check;\nvar Match = Package.check.Match;\nvar Random = Package.random.Random;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package.modules.meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\nvar Symbol = Package['ecmascript-runtime-client'].Symbol;\nvar Map = Package['ecmascript-runtime-client'].Map;\nvar Set = Package['ecmascript-runtime-client'].Set;\n\n/* Package-scope variables */\nvar FilesCollection;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"ostrio:files\":{\"client.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/client.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _assertThisInitialized;\n\nmodule.link(\"@babel/runtime/helpers/assertThisInitialized\", {\n  default: function (v) {\n    _assertThisInitialized = v;\n  }\n}, 0);\n\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 1);\nmodule.export({\n  FilesCollection: function () {\n    return FilesCollection;\n  }\n});\nvar Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar DDP;\nmodule.link(\"meteor/ddp-client\", {\n  DDP: function (v) {\n    DDP = v;\n  }\n}, 2);\nvar Cookies;\nmodule.link(\"meteor/ostrio:cookies\", {\n  Cookies: function (v) {\n    Cookies = v;\n  }\n}, 3);\nvar check, Match;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 4);\nvar UploadInstance;\nmodule.link(\"./upload.js\", {\n  UploadInstance: function (v) {\n    UploadInstance = v;\n  }\n}, 5);\nvar FilesCollectionCore;\nmodule.link(\"./core.js\", {\n  \"default\": function (v) {\n    FilesCollectionCore = v;\n  }\n}, 6);\nvar formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL: function (v) {\n    formatFleURL = v;\n  },\n  helpers: function (v) {\n    helpers = v;\n  }\n}, 7);\n\nvar NOOP = function () {};\n\nvar allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\n\nvar FilesCollection = /*#__PURE__*/function (_FilesCollectionCore) {\n  _inheritsLoose(FilesCollection, _FilesCollectionCore);\n\n  function FilesCollection(config) {\n    var _this;\n\n    _this = _FilesCollectionCore.call(this) || this;\n\n    if (config) {\n      Object.keys(config).forEach(function (param) {\n        if (allowedParams.includes(param)) {\n          _this[param] = config[param];\n        }\n      });\n    }\n\n    var self = _assertThisInitialized(_this);\n\n    var cookie = new Cookies({\n      allowQueryStringCookies: _this.allowQueryStringCookies\n    });\n\n    if (!helpers.isBoolean(_this.debug)) {\n      _this.debug = false;\n    }\n\n    if (!helpers.isBoolean(_this.public)) {\n      _this.public = false;\n    }\n\n    if (!_this.chunkSize) {\n      _this.chunkSize = 1024 * 512;\n    }\n\n    _this.chunkSize = Math.floor(_this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(_this.collectionName) && !_this.collection) {\n      _this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!_this.collection) {\n      _this.collection = new Mongo.Collection(_this.collectionName);\n    } else {\n      _this.collectionName = _this.collection._name;\n    }\n\n    _this.collection.filesCollection = _assertThisInitialized(_this);\n    check(_this.collectionName, String);\n\n    if (_this.public && !_this.downloadRoute) {\n      throw new Meteor.Error(500, \"[FilesCollection.\" + _this.collectionName + \"]: \\\"downloadRoute\\\" must be precisely provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal or be inside of your web/proxy-server (relative) root.\");\n    }\n\n    if (!helpers.isBoolean(_this.disableUpload)) {\n      _this.disableUpload = false;\n    }\n\n    if (!helpers.isString(_this.downloadRoute)) {\n      _this.downloadRoute = '/cdn/storage';\n    }\n\n    _this.downloadRoute = _this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(_this.namingFunction)) {\n      _this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(_this.onBeforeUpload)) {\n      _this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(_this.allowClientCode)) {\n      _this.allowClientCode = true;\n    }\n\n    if (!_this.ddp) {\n      _this.ddp = Meteor;\n    }\n\n    if (!_this.onbeforeunloadMessage) {\n      _this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    var setTokenCookie = function () {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, {\n          path: '/',\n          sameSite: 'Lax'\n        });\n\n        if (Meteor.isCordova && _this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect(function (conn) {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(_this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      var _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        _this._supportWebWorker = true;\n        _this._webWorkerUrl = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {\n          type: 'application/javascript'\n        }));\n      } else if (window.Worker) {\n        _this._supportWebWorker = true;\n        _this._webWorkerUrl = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        _this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n\n      _this._supportWebWorker = false;\n    }\n\n    if (!_this.schema) {\n      _this.schema = FilesCollectionCore.schema;\n    }\n\n    check(_this.debug, Boolean);\n    check(_this.schema, Object);\n    check(_this.public, Boolean);\n    check(_this.chunkSize, Number);\n    check(_this.downloadRoute, String);\n    check(_this.disableUpload, Boolean);\n    check(_this.namingFunction, Match.OneOf(false, Function));\n    check(_this.onBeforeUpload, Match.OneOf(false, Function));\n    check(_this.allowClientCode, Boolean);\n    check(_this.ddp, Match.Any);\n    _this._methodNames = {\n      _Abort: \"_FilesCollectionAbort_\" + _this.collectionName,\n      _Write: \"_FilesCollectionWrite_\" + _this.collectionName,\n      _Start: \"_FilesCollectionStart_\" + _this.collectionName,\n      _Remove: \"_FilesCollectionRemove_\" + _this.collectionName\n    };\n    return _this;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n\n\n  var _proto = FilesCollection.prototype;\n\n  _proto._getMimeType = function () {\n    function _getMimeType(fileData) {\n      var mime;\n      check(fileData, Object);\n\n      if (helpers.isObject(fileData)) {\n        mime = fileData.type;\n      }\n\n      if (!mime || !helpers.isString(mime)) {\n        mime = 'application/octet-stream';\n      }\n\n      return mime;\n    }\n\n    return _getMimeType;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  ;\n\n  _proto._getUser = function () {\n    function _getUser() {\n      var result = {\n        user: function () {\n          return null;\n        },\n        userId: null\n      };\n\n      if (helpers.isFunction(Meteor.userId)) {\n        result.user = function () {\n          return Meteor.user();\n        };\n\n        result.userId = Meteor.userId();\n      }\n\n      return result;\n    }\n\n    return _getUser;\n  }()\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n  ;\n\n  _proto.insert = function () {\n    function insert(config) {\n      var autoStart = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n      if (this.disableUpload) {\n        console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n        return {};\n      }\n\n      return new UploadInstance(config, this)[autoStart ? 'start' : 'manual']();\n    }\n\n    return insert;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n  ;\n\n  _proto.remove = function () {\n    function remove() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var callback = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._debug(\"[FilesCollection] [remove(\" + JSON.stringify(selector) + \")]\");\n\n      check(selector, Match.OneOf(Object, String));\n      check(callback, Match.Optional(Function));\n\n      if (this.allowClientCode) {\n        this.ddp.call(this._methodNames._Remove, selector, callback || NOOP);\n      } else {\n        callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n\n        this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n      }\n\n      return this;\n    }\n\n    return remove;\n  }();\n\n  return FilesCollection;\n}(FilesCollectionCore);\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(function () {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', function (fileRef) {\n      var _version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n      var _URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      var version = !helpers.isString(_version) ? 'original' : _version;\n      var URIBase = !helpers.isString(_URIBase) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"core.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/core.js                                                                                      //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 0);\nmodule.export({\n  \"default\": function () {\n    return FilesCollectionCore;\n  }\n});\nvar EventEmitter;\nmodule.link(\"eventemitter3\", {\n  EventEmitter: function (v) {\n    EventEmitter = v;\n  }\n}, 0);\nvar check, Match;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 1);\nvar formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL: function (v) {\n    formatFleURL = v;\n  },\n  helpers: function (v) {\n    helpers = v;\n  }\n}, 2);\nvar FilesCursor, FileCursor;\nmodule.link(\"./cursor.js\", {\n  FilesCursor: function (v) {\n    FilesCursor = v;\n  },\n  FileCursor: function (v) {\n    FileCursor = v;\n  }\n}, 3);\n\nvar FilesCollectionCore = /*#__PURE__*/function (_EventEmitter) {\n  _inheritsLoose(FilesCollectionCore, _EventEmitter);\n\n  function FilesCollectionCore() {\n    return _EventEmitter.call(this) || this;\n  }\n\n  var _proto = FilesCollectionCore.prototype;\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _proto._debug = function () {\n    function _debug() {\n      if (this.debug) {\n        (console.info || console.log || function () {}).apply(void 0, arguments);\n      }\n    }\n\n    return _debug;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  ;\n\n  _proto._getFileName = function () {\n    function _getFileName(fileData) {\n      var fileName = fileData.name || fileData.fileName;\n\n      if (helpers.isString(fileName) && fileName.length > 0) {\n        return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n      }\n\n      return '';\n    }\n\n    return _getFileName;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  ;\n\n  _proto._getExt = function () {\n    function _getExt(fileName) {\n      if (fileName.includes('.')) {\n        var extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n        return {\n          ext: extension,\n          extension: extension,\n          extensionWithDot: \".\" + extension\n        };\n      }\n\n      return {\n        ext: '',\n        extension: '',\n        extensionWithDot: ''\n      };\n    }\n\n    return _getExt;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  ;\n\n  _proto._updateFileTypes = function () {\n    function _updateFileTypes(data) {\n      data.isVideo = /^video\\//i.test(data.type);\n      data.isAudio = /^audio\\//i.test(data.type);\n      data.isImage = /^image\\//i.test(data.type);\n      data.isText = /^text\\//i.test(data.type);\n      data.isJSON = /^application\\/json$/i.test(data.type);\n      data.isPDF = /^application\\/(x-)?pdf$/i.test(data.type);\n    }\n\n    return _updateFileTypes;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  ;\n\n  _proto._dataToSchema = function () {\n    function _dataToSchema(data) {\n      var ds = {\n        name: data.name,\n        extension: data.extension,\n        ext: data.extension,\n        extensionWithDot: '.' + data.extension,\n        path: data.path,\n        meta: data.meta,\n        type: data.type,\n        mime: data.type,\n        'mime-type': data.type,\n        size: data.size,\n        userId: data.userId || null,\n        versions: {\n          original: {\n            path: data.path,\n            size: data.size,\n            type: data.type,\n            extension: data.extension\n          }\n        },\n        _downloadRoute: data._downloadRoute || this.downloadRoute,\n        _collectionName: data._collectionName || this.collectionName\n      }; //Optional fileId\n\n      if (data.fileId) {\n        ds._id = data.fileId;\n      }\n\n      this._updateFileTypes(ds);\n\n      ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n      return ds;\n    }\n\n    return _dataToSchema;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n  ;\n\n  _proto.findOne = function () {\n    function findOne() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._debug(\"[FilesCollection] [findOne(\" + JSON.stringify(selector) + \", \" + JSON.stringify(options) + \")]\");\n\n      check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n      check(options, Match.Optional(Object));\n      var doc = this.collection.findOne(selector, options);\n\n      if (doc) {\n        return new FileCursor(doc, this);\n      }\n\n      return doc;\n    }\n\n    return findOne;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  ;\n\n  _proto.find = function () {\n    function find() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._debug(\"[FilesCollection] [find(\" + JSON.stringify(selector) + \", \" + JSON.stringify(options) + \")]\");\n\n      check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n      check(options, Match.Optional(Object));\n      return new FilesCursor(selector, options, this);\n    }\n\n    return find;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n  ;\n\n  _proto.update = function () {\n    function update() {\n      this.collection.update.apply(this.collection, arguments);\n      return this.collection;\n    }\n\n    return update;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  ;\n\n  _proto.link = function () {\n    function link(fileRef) {\n      var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n      var URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n      this._debug(\"[FilesCollection] [link(\" + (helpers.isObject(fileRef) ? fileRef._id : void 0) + \", \" + version + \")]\");\n\n      check(fileRef, Object);\n\n      if (!fileRef) {\n        return '';\n      }\n\n      return formatFleURL(fileRef, version, URIBase);\n    }\n\n    return link;\n  }();\n\n  return FilesCollectionCore;\n}(EventEmitter);\n\nFilesCollectionCore.__helpers = helpers;\nFilesCollectionCore.schema = {\n  _id: {\n    type: String\n  },\n  size: {\n    type: Number\n  },\n  name: {\n    type: String\n  },\n  type: {\n    type: String\n  },\n  path: {\n    type: String\n  },\n  isVideo: {\n    type: Boolean\n  },\n  isAudio: {\n    type: Boolean\n  },\n  isImage: {\n    type: Boolean\n  },\n  isText: {\n    type: Boolean\n  },\n  isJSON: {\n    type: Boolean\n  },\n  isPDF: {\n    type: Boolean\n  },\n  extension: {\n    type: String,\n    optional: true\n  },\n  ext: {\n    type: String,\n    optional: true\n  },\n  extensionWithDot: {\n    type: String,\n    optional: true\n  },\n  mime: {\n    type: String,\n    optional: true\n  },\n  'mime-type': {\n    type: String,\n    optional: true\n  },\n  _storagePath: {\n    type: String\n  },\n  _downloadRoute: {\n    type: String\n  },\n  _collectionName: {\n    type: String\n  },\n  \"public\": {\n    type: Boolean,\n    optional: true\n  },\n  meta: {\n    type: Object,\n    blackbox: true,\n    optional: true\n  },\n  userId: {\n    type: String,\n    optional: true\n  },\n  updatedAt: {\n    type: Date,\n    optional: true\n  },\n  versions: {\n    type: Object,\n    blackbox: true\n  }\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"cursor.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/cursor.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  FileCursor: function () {\n    return FileCursor;\n  },\n  FilesCursor: function () {\n    return FilesCursor;\n  }\n});\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\n\nvar FileCursor = /*#__PURE__*/function () {\n  function FileCursor(_fileRef, _collection) {\n    this._fileRef = _fileRef;\n    this._collection = _collection;\n    Object.assign(this, _fileRef);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Remove document\n   * @returns {FileCursor}\n   */\n\n\n  var _proto = FileCursor.prototype;\n\n  _proto.remove = function () {\n    function remove(callback) {\n      this._collection._debug('[FilesCollection] [FileCursor] [remove()]');\n\n      if (this._fileRef) {\n        this._collection.remove(this._fileRef._id, callback);\n      } else {\n        callback && callback(new Meteor.Error(404, 'No such file'));\n      }\n\n      return this;\n    }\n\n    return remove;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name link\n   * @param version {String} - Name of file's subversion\n   * @param URIBase {String} - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL to File\n   * @returns {String}\n   */\n  ;\n\n  _proto.link = function () {\n    function link() {\n      var version = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'original';\n      var URIBase = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._collection._debug(\"[FilesCollection] [FileCursor] [link(\" + version + \")]\");\n\n      if (this._fileRef) {\n        return this._collection.link(this._fileRef, version, URIBase);\n      }\n\n      return '';\n    }\n\n    return link;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name get\n   * @param property {String} - Name of sub-object property\n   * @summary Returns current document as a plain Object, if `property` is specified - returns value of sub-object property\n   * @returns {Object|mix}\n   */\n  ;\n\n  _proto.get = function () {\n    function get(property) {\n      this._collection._debug(\"[FilesCollection] [FileCursor] [get(\" + property + \")]\");\n\n      if (property) {\n        return this._fileRef[property];\n      }\n\n      return this._fileRef;\n    }\n\n    return get;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name fetch\n   * @summary Returns document as plain Object in Array\n   * @returns {[Object]}\n   */\n  ;\n\n  _proto.fetch = function () {\n    function fetch() {\n      this._collection._debug('[FilesCollection] [FileCursor] [fetch()]');\n\n      return [this._fileRef];\n    }\n\n    return fetch;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name with\n   * @summary Returns reactive version of current FileCursor, useful to use with `{{#with}}...{{/with}}` block template helper\n   * @returns {[Object]}\n   */\n  ;\n\n  _proto.with = function () {\n    function _with() {\n      this._collection._debug('[FilesCollection] [FileCursor] [with()]');\n\n      return Object.assign(this, this._collection.collection.findOne(this._fileRef._id));\n    }\n\n    return _with;\n  }();\n\n  return FileCursor;\n}();\n\nvar FilesCursor = /*#__PURE__*/function () {\n  function FilesCursor() {\n    var _selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var options = arguments.length > 1 ? arguments[1] : undefined;\n\n    var _collection = arguments.length > 2 ? arguments[2] : undefined;\n\n    this._collection = _collection;\n    this._selector = _selector;\n    this._current = -1;\n    this.cursor = this._collection.collection.find(this._selector, options);\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name get\n   * @summary Returns all matching document(s) as an Array. Alias of `.fetch()`\n   * @returns {[Object]}\n   */\n\n\n  var _proto2 = FilesCursor.prototype;\n\n  _proto2.get = function () {\n    function get() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [get()]');\n\n      return this.cursor.fetch();\n    }\n\n    return get;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasNext\n   * @summary Returns `true` if there is next item available on Cursor\n   * @returns {Boolean}\n   */\n  ;\n\n  _proto2.hasNext = function () {\n    function hasNext() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [hasNext()]');\n\n      return this._current < this.cursor.count() - 1;\n    }\n\n    return hasNext;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name next\n   * @summary Returns next item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  ;\n\n  _proto2.next = function () {\n    function next() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [next()]');\n\n      this.cursor.fetch()[++this._current];\n    }\n\n    return next;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasPrevious\n   * @summary Returns `true` if there is previous item available on Cursor\n   * @returns {Boolean}\n   */\n  ;\n\n  _proto2.hasPrevious = function () {\n    function hasPrevious() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [hasPrevious()]');\n\n      return this._current !== -1;\n    }\n\n    return hasPrevious;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name previous\n   * @summary Returns previous item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  ;\n\n  _proto2.previous = function () {\n    function previous() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [previous()]');\n\n      this.cursor.fetch()[--this._current];\n    }\n\n    return previous;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name fetch\n   * @summary Returns all matching document(s) as an Array.\n   * @returns {[Object]}\n   */\n  ;\n\n  _proto2.fetch = function () {\n    function fetch() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [fetch()]');\n\n      return this.cursor.fetch() || [];\n    }\n\n    return fetch;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name first\n   * @summary Returns first item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  ;\n\n  _proto2.first = function () {\n    function first() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [first()]');\n\n      this._current = 0;\n      return this.fetch()[this._current];\n    }\n\n    return first;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name last\n   * @summary Returns last item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  ;\n\n  _proto2.last = function () {\n    function last() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [last()]');\n\n      this._current = this.count() - 1;\n      return this.fetch()[this._current];\n    }\n\n    return last;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name count\n   * @summary Returns the number of documents that match a query\n   * @returns {Number}\n   */\n  ;\n\n  _proto2.count = function () {\n    function count() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [count()]');\n\n      return this.cursor.count();\n    }\n\n    return count;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Removes all documents that match a query\n   * @returns {FilesCursor}\n   */\n  ;\n\n  _proto2.remove = function () {\n    function remove(callback) {\n      this._collection._debug('[FilesCollection] [FilesCursor] [remove()]');\n\n      this._collection.remove(this._selector, callback);\n\n      return this;\n    }\n\n    return remove;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name forEach\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Call `callback` once for each matching document, sequentially and synchronously.\n   * @returns {undefined}\n   */\n  ;\n\n  _proto2.forEach = function () {\n    function forEach(callback) {\n      var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      this._collection._debug('[FilesCollection] [FilesCursor] [forEach()]');\n\n      this.cursor.forEach(callback, context);\n    }\n\n    return forEach;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name each\n   * @summary Returns an Array of FileCursor made for each document on current cursor\n   *          Useful when using in {{#each FilesCursor#each}}...{{/each}} block template helper\n   * @returns {[FileCursor]}\n   */\n  ;\n\n  _proto2.each = function () {\n    function each() {\n      var _this = this;\n\n      return this.map(function (file) {\n        return new FileCursor(file, _this._collection);\n      });\n    }\n\n    return each;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name map\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Map `callback` over all matching documents. Returns an Array.\n   * @returns {Array}\n   */\n  ;\n\n  _proto2.map = function () {\n    function map(callback) {\n      var context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      this._collection._debug('[FilesCollection] [FilesCursor] [map()]');\n\n      return this.cursor.map(callback, context);\n    }\n\n    return map;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name current\n   * @summary Returns current item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  ;\n\n  _proto2.current = function () {\n    function current() {\n      this._collection._debug('[FilesCollection] [FilesCursor] [current()]');\n\n      if (this._current < 0) {\n        this._current = 0;\n      }\n\n      return this.fetch()[this._current];\n    }\n\n    return current;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observe\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observe\n   * @returns {Object} - live query handle\n   */\n  ;\n\n  _proto2.observe = function () {\n    function observe(callbacks) {\n      this._collection._debug('[FilesCollection] [FilesCursor] [observe()]');\n\n      return this.cursor.observe(callbacks);\n    }\n\n    return observe;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observeChanges\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes. Only the differences between the old and new documents are passed to the callbacks.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observeChanges\n   * @returns {Object} - live query handle\n   */\n  ;\n\n  _proto2.observeChanges = function () {\n    function observeChanges(callbacks) {\n      this._collection._debug('[FilesCollection] [FilesCursor] [observeChanges()]');\n\n      return this.cursor.observeChanges(callbacks);\n    }\n\n    return observeChanges;\n  }();\n\n  return FilesCursor;\n}();\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"lib.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/lib.js                                                                                       //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.export({\n  fixJSONParse: function () {\n    return fixJSONParse;\n  },\n  fixJSONStringify: function () {\n    return fixJSONStringify;\n  },\n  formatFleURL: function () {\n    return formatFleURL;\n  },\n  helpers: function () {\n    return helpers;\n  }\n});\nvar check;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  }\n}, 0);\nvar helpers = {\n  isUndefined: function (obj) {\n    return obj === void 0;\n  },\n  isObject: function (obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n\n    return obj === Object(obj);\n  },\n  isArray: function (obj) {\n    return Array.isArray(obj);\n  },\n  isBoolean: function (obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n  isFunction: function (obj) {\n    return typeof obj === 'function' || false;\n  },\n  isEmpty: function (obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n\n    return false;\n  },\n  clone: function (obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n  has: function (_obj, path) {\n    var obj = _obj;\n\n    if (!this.isObject(obj)) {\n      return false;\n    }\n\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    var length = path.length;\n\n    for (var i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n\n      obj = obj[path[i]];\n    }\n\n    return !!length;\n  },\n  omit: function (obj) {\n    var clear = Object.assign({}, obj);\n\n    for (var _len = arguments.length, keys = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      keys[_key - 1] = arguments[_key];\n    }\n\n    for (var i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n  now: Date.now,\n  throttle: function (func, wait) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var previous = 0;\n    var timeout = null;\n    var result;\n    var that = this;\n    var self;\n    var args;\n\n    var later = function () {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n\n      if (!timeout) {\n        self = args = null;\n      }\n    };\n\n    var throttled = function () {\n      var now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n\n        previous = now;\n        result = func.apply(self, args);\n\n        if (!timeout) {\n          self = args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n\n      return result;\n    };\n\n    throttled.cancel = function () {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n};\nvar _helpers = ['String', 'Number', 'Date'];\n\nvar _loop = function (i) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n};\n\nfor (var i = 0; i < _helpers.length; i++) {\n  _loop(i);\n}\n/*\n * @const {Function} fixJSONParse - Fix issue with Date parse\n */\n\n\nvar fixJSONParse = function (obj) {\n  for (var key in meteorBabelHelpers.sanitizeForInObject(obj)) {\n    if (helpers.isString(obj[key]) && obj[key].includes('=--JSON-DATE--=')) {\n      obj[key] = obj[key].replace('=--JSON-DATE--=', '');\n      obj[key] = new Date(parseInt(obj[key]));\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONParse(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      var v = void 0;\n\n      for (var _i = 0; _i < obj[key].length; _i++) {\n        v = obj[key][_i];\n\n        if (helpers.isObject(v)) {\n          obj[key][_i] = fixJSONParse(v);\n        } else if (helpers.isString(v) && v.includes('=--JSON-DATE--=')) {\n          v = v.replace('=--JSON-DATE--=', '');\n          obj[key][_i] = new Date(parseInt(v));\n        }\n      }\n    }\n  }\n\n  return obj;\n};\n/*\n * @const {Function} fixJSONStringify - Fix issue with Date stringify\n */\n\n\nvar fixJSONStringify = function (obj) {\n  for (var key in meteorBabelHelpers.sanitizeForInObject(obj)) {\n    if (helpers.isDate(obj[key])) {\n      obj[key] = \"=--JSON-DATE--=\" + +obj[key];\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONStringify(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      var v = void 0;\n\n      for (var _i2 = 0; _i2 < obj[key].length; _i2++) {\n        v = obj[key][_i2];\n\n        if (helpers.isObject(v)) {\n          obj[key][_i2] = fixJSONStringify(v);\n        } else if (helpers.isDate(v)) {\n          obj[key][_i2] = \"=--JSON-DATE--=\" + +v;\n        }\n      }\n    }\n  }\n\n  return obj;\n};\n/*\n * @locus Anywhere\n * @private\n * @name formatFleURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like build URL for\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Returns formatted URL for file\n * @returns {String} Downloadable link\n */\n\n\nvar formatFleURL = function (fileRef) {\n  var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n  var _URIBase = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : (__meteor_runtime_config__ || {}).ROOT_URL;\n\n  check(fileRef, Object);\n  check(version, String);\n  var URIBase = _URIBase;\n\n  if (!helpers.isString(URIBase)) {\n    URIBase = (__meteor_runtime_config__ || {}).ROOT_URL || '/';\n  }\n\n  var _root = URIBase.replace(/\\/+$/, '');\n\n  var vRef = fileRef.versions && fileRef.versions[version] || fileRef || {};\n  var ext;\n\n  if (helpers.isString(vRef.extension)) {\n    ext = \".\" + vRef.extension.replace(/^\\./, '');\n  } else {\n    ext = '';\n  }\n\n  if (fileRef.public === true) {\n    return _root + (version === 'original' ? fileRef._downloadRoute + \"/\" + fileRef._id + ext : fileRef._downloadRoute + \"/\" + version + \"-\" + fileRef._id + ext);\n  }\n\n  return _root + (fileRef._downloadRoute + \"/\" + fileRef._collectionName + \"/\" + fileRef._id + \"/\" + version + \"/\" + fileRef._id + ext);\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"upload.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// packages/ostrio_files/upload.js                                                                                    //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nvar _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 0);\nmodule.export({\n  FileUpload: function () {\n    return FileUpload;\n  },\n  UploadInstance: function () {\n    return UploadInstance;\n  }\n});\nvar HTTP;\nmodule.link(\"meteor/http\", {\n  HTTP: function (v) {\n    HTTP = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Random;\nmodule.link(\"meteor/random\", {\n  Random: function (v) {\n    Random = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 4);\nvar EventEmitter;\nmodule.link(\"eventemitter3\", {\n  EventEmitter: function (v) {\n    EventEmitter = v;\n  }\n}, 5);\nvar check, Match;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 6);\nvar fixJSONParse, fixJSONStringify, helpers;\nmodule.link(\"./lib.js\", {\n  fixJSONParse: function (v) {\n    fixJSONParse = v;\n  },\n  fixJSONStringify: function (v) {\n    fixJSONStringify = v;\n  },\n  helpers: function (v) {\n    helpers = v;\n  }\n}, 7);\n\nvar _rootUrl = (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.ROOT_URL).replace(/\\/+$/, '');\n\nvar isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n/*\n * @locus Client\n * @name FileUpload\n * @class FileUpload\n * @summary Internal Class, instance of this class is returned from `.insert()` method\n */\n\nvar FileUpload = /*#__PURE__*/function (_EventEmitter) {\n  _inheritsLoose(FileUpload, _EventEmitter);\n\n  function FileUpload(config) {\n    var _this;\n\n    _this = _EventEmitter.call(this) || this;\n    _this.config = config;\n\n    _this.config._debug('[FilesCollection] [FileUpload] [constructor]');\n\n    if (!_this.config.isBase64) {\n      _this.file = Object.assign({}, helpers.clone(_this.config.file), _this.config.fileData);\n    } else {\n      _this.file = _this.config.fileData;\n    }\n\n    _this.state = new ReactiveVar('active');\n    _this.onPause = new ReactiveVar(false);\n    _this.progress = new ReactiveVar(0);\n\n    _this.continueFunc = function () {};\n\n    _this.estimateTime = new ReactiveVar(1000);\n    _this.estimateSpeed = new ReactiveVar(0);\n    _this.estimateTimer = Meteor.setInterval(function () {\n      if (_this.state.get() === 'active') {\n        var _currentTime = _this.estimateTime.get();\n\n        if (_currentTime > 1000) {\n          _this.estimateTime.set(_currentTime - 1000);\n        }\n      }\n    }, 1000);\n    return _this;\n  }\n\n  var _proto = FileUpload.prototype;\n\n  _proto.pause = function () {\n    function pause() {\n      this.config._debug('[FilesCollection] [insert] [.pause()]');\n\n      if (!this.onPause.get()) {\n        this.onPause.set(true);\n        this.state.set('paused');\n        this.emit('pause', this.file);\n      }\n    }\n\n    return pause;\n  }();\n\n  _proto.continue = function () {\n    function _continue() {\n      this.config._debug('[FilesCollection] [insert] [.continue()]');\n\n      if (this.onPause.get()) {\n        this.onPause.set(false);\n        this.state.set('active');\n        this.emit('continue', this.file);\n        this.continueFunc();\n      }\n    }\n\n    return _continue;\n  }();\n\n  _proto.toggle = function () {\n    function toggle() {\n      this.config._debug('[FilesCollection] [insert] [.toggle()]');\n\n      if (this.onPause.get()) {\n        this.continue();\n      } else {\n        this.pause();\n      }\n    }\n\n    return toggle;\n  }();\n\n  _proto.abort = function () {\n    function abort() {\n      this.config._debug('[FilesCollection] [insert] [.abort()]');\n\n      window.removeEventListener('beforeunload', this.config.beforeunload, false);\n      this.pause();\n\n      this.config._onEnd();\n\n      this.state.set('aborted');\n      this.config.onAbort && this.config.onAbort.call(this, this.file);\n      this.emit('abort', this.file);\n\n      if (this.config.debug) {\n        console.timeEnd(\"insert \" + this.config.fileData.name);\n      }\n\n      this.config.ddp.call(this.config._Abort, this.config.fileId);\n    }\n\n    return abort;\n  }();\n\n  return FileUpload;\n}(EventEmitter);\n\nvar UploadInstance = /*#__PURE__*/function (_EventEmitter2) {\n  _inheritsLoose(UploadInstance, _EventEmitter2);\n\n  function UploadInstance(config, collection) {\n    var _this2;\n\n    _this2 = _EventEmitter2.call(this) || this;\n    _this2.config = config;\n    _this2.collection = collection;\n\n    _this2.collection._debug('[FilesCollection] [insert()]');\n\n    if (!_this2.config.ddp) {\n      _this2.config.ddp = _this2.collection.ddp;\n    }\n\n    if (!_this2.config.meta) {\n      _this2.config.meta = {};\n    }\n\n    if (!_this2.config.streams) {\n      _this2.config.streams = 2;\n    }\n\n    if (_this2.config.streams < 1) {\n      _this2.config.streams = 2;\n    }\n\n    if (!helpers.isString(_this2.config.transport)) {\n      _this2.config.transport = 'ddp';\n    }\n\n    _this2.config.transport = _this2.config.transport.toLowerCase();\n\n    if (_this2.config.transport !== 'ddp' && _this2.config.transport !== 'http') {\n      _this2.config.transport = 'ddp';\n    }\n\n    if (!_this2.config.chunkSize) {\n      _this2.config.chunkSize = _this2.collection.chunkSize;\n    }\n\n    if (!helpers.isBoolean(_this2.config.allowWebWorkers)) {\n      _this2.config.allowWebWorkers = true;\n    }\n\n    check(_this2.config, {\n      ddp: Match.Any,\n      file: Match.Any,\n      fileId: Match.Optional(String),\n      meta: Match.Optional(Object),\n      type: Match.Optional(String),\n      onError: Match.Optional(Function),\n      onAbort: Match.Optional(Function),\n      streams: Match.OneOf('dynamic', Number),\n      onStart: Match.Optional(Function),\n      fileName: Match.Optional(String),\n      isBase64: Match.Optional(Boolean),\n      transport: Match.OneOf('http', 'ddp'),\n      chunkSize: Match.OneOf('dynamic', Number),\n      onUploaded: Match.Optional(Function),\n      onProgress: Match.Optional(Function),\n      onBeforeUpload: Match.Optional(Function),\n      allowWebWorkers: Boolean\n    });\n\n    if (_this2.config.isBase64 === true) {\n      check(_this2.config.file, String);\n\n      if (!_this2.config.fileName) {\n        throw new Meteor.Error(400, '\"fileName\" must me specified for base64 upload!');\n      }\n\n      if (_this2.config.file.includes('data:')) {\n        _this2.config.file = _this2.config.file.replace('data:', '');\n      }\n\n      if (_this2.config.file.includes(',')) {\n        var _file = _this2.config.file.split(',');\n\n        _this2.fileData = {\n          size: Math.floor(_file[1].replace(/\\=/g, '').length / 4 * 3),\n          type: _file[0].split(';')[0],\n          name: _this2.config.fileName,\n          meta: _this2.config.meta\n        };\n        _this2.config.file = _file[1];\n      } else if (!_this2.config.type) {\n        throw new Meteor.Error(400, '\"type\" must me specified for base64 upload! And represent mime-type of the file');\n      } else {\n        _this2.fileData = {\n          size: Math.floor(_this2.config.file.replace(/\\=/g, '').length / 4 * 3),\n          type: _this2.config.type,\n          name: _this2.config.fileName,\n          meta: _this2.config.meta\n        };\n      }\n    }\n\n    if (_this2.config.file) {\n      if (!_this2.config.isBase64) {\n        try {\n          if (!_this2.config.file.name || !_this2.config.file.size) {\n            throw new Meteor.Error(500, 'Not a File!');\n          }\n        } catch (e) {\n          throw new Meteor.Error(500, '[FilesCollection] [insert] Insert method accepts File, not a FileList. You need to provide a real File. File must have `.name` property, and its size must be larger than zero.');\n        }\n\n        _this2.fileData = {\n          size: _this2.config.file.size,\n          type: _this2.config.type || _this2.config.file.type,\n          name: _this2.config.fileName || _this2.config.file.name,\n          meta: _this2.config.meta\n        };\n      }\n\n      if (_this2.collection.debug) {\n        console.time(\"insert \" + _this2.fileData.name);\n        console.time(\"loadFile \" + _this2.fileData.name);\n      }\n\n      if (_this2.collection._supportWebWorker && _this2.config.allowWebWorkers) {\n        try {\n          _this2.worker = new Worker(_this2.collection._webWorkerUrl);\n        } catch (wwError) {\n          _this2.worker = false;\n\n          _this2.collection._debug('[FilesCollection] [insert] [create WebWorker]: Can\\'t create WebWorker, fallback to MainThread', wwError);\n        }\n      } else {\n        _this2.worker = null;\n      }\n\n      _this2.startTime = {};\n      _this2.config.debug = _this2.collection.debug;\n      _this2.config._debug = _this2.collection._debug;\n      _this2.currentChunk = 0;\n      _this2.transferTime = 0;\n      _this2.trackerComp = null;\n      _this2.sentChunks = 0;\n      _this2.fileLength = 1;\n      _this2.EOFsent = false;\n      _this2.fileId = _this2.config.fileId || Random.id();\n      _this2.FSName = _this2.collection.namingFunction ? _this2.collection.namingFunction(_this2.fileData) : _this2.fileId;\n      _this2.pipes = [];\n      _this2.fileData = Object.assign(_this2.fileData, _this2.collection._getExt(_this2.fileData.name), {\n        mime: _this2.collection._getMimeType(_this2.fileData)\n      });\n      _this2.fileData['mime-type'] = _this2.fileData.mime;\n      _this2.result = new FileUpload(Object.assign({}, _this2.config, {\n        fileData: _this2.fileData,\n        fileId: _this2.fileId,\n        _Abort: _this2.collection._methodNames._Abort\n      }));\n\n      _this2.beforeunload = function (e) {\n        var message = helpers.isFunction(_this2.collection.onbeforeunloadMessage) ? _this2.collection.onbeforeunloadMessage.call(_this2.result, _this2.fileData) : _this2.collection.onbeforeunloadMessage;\n\n        if (e) {\n          e.returnValue = message;\n        }\n\n        return message;\n      };\n\n      _this2.result.config.beforeunload = _this2.beforeunload;\n      window.addEventListener('beforeunload', _this2.beforeunload, false);\n\n      _this2.result.config._onEnd = function () {\n        return _this2.emit('_onEnd');\n      };\n\n      _this2.addListener('end', _this2.end);\n\n      _this2.addListener('start', _this2.start);\n\n      _this2.addListener('upload', _this2.upload);\n\n      _this2.addListener('sendEOF', _this2.sendEOF);\n\n      _this2.addListener('prepare', _this2.prepare);\n\n      _this2.addListener('sendChunk', _this2.sendChunk);\n\n      _this2.addListener('proceedChunk', _this2.proceedChunk);\n\n      _this2.addListener('createStreams', _this2.createStreams);\n\n      _this2.addListener('calculateStats', helpers.throttle(function () {\n        var _t = _this2.transferTime / _this2.sentChunks / _this2.config.streams;\n\n        _this2.result.estimateTime.set(_t * (_this2.fileLength - _this2.sentChunks));\n\n        _this2.result.estimateSpeed.set(_this2.config.chunkSize / (_t / 1000));\n\n        var progress = Math.round(_this2.sentChunks / _this2.fileLength * 100);\n        var sentBytes = _this2.config.chunkSize * _this2.sentChunks;\n\n        if (sentBytes > _this2.fileData.size) {\n          // this case often occurs, when the last chunk\n          // is smaller than chunkSize, so we limit to fileSize\n          sentBytes = _this2.fileData.size;\n        }\n\n        _this2.result.progress.set(progress);\n\n        _this2.config.onProgress && _this2.config.onProgress.call(_this2.result, progress, _this2.fileData);\n\n        _this2.result.emit('progress', progress, _this2.fileData, {\n          chunksSent: _this2.sentChunks,\n          chunksLength: _this2.fileLength,\n          bytesSent: sentBytes\n        });\n      }, 250));\n\n      _this2.addListener('_onEnd', function () {\n        if (_this2.result.estimateTimer) {\n          Meteor.clearInterval(_this2.result.estimateTimer);\n        }\n\n        if (_this2.worker) {\n          _this2.worker.terminate();\n        }\n\n        if (_this2.trackerComp) {\n          _this2.trackerComp.stop();\n        }\n\n        if (_this2.beforeunload) {\n          window.removeEventListener('beforeunload', _this2.beforeunload, false);\n        }\n\n        if (_this2.result) {\n          return _this2.result.progress.set(0);\n        }\n\n        return void 0;\n      });\n    } else {\n      throw new Meteor.Error(500, '[FilesCollection] [insert] Have you forget to pass a File itself?');\n    }\n\n    return _this2;\n  }\n\n  var _proto2 = UploadInstance.prototype;\n\n  _proto2.end = function () {\n    function end(error, data) {\n      this.collection._debug('[FilesCollection] [UploadInstance] [end]', this.fileData.name);\n\n      if (this.collection.debug) {\n        console.timeEnd(\"insert \" + this.fileData.name);\n      }\n\n      this.emit('_onEnd');\n      this.result.emit('uploaded', error, data);\n      this.config.onUploaded && this.config.onUploaded.call(this.result, error, data);\n\n      if (error) {\n        this.collection._debug('[FilesCollection] [insert] [end] Error:', error);\n\n        this.result.abort();\n        this.result.state.set('aborted');\n        this.result.emit('error', error, this.fileData);\n        this.config.onError && this.config.onError.call(this.result, error, this.fileData);\n      } else {\n        this.result.state.set('completed');\n        this.collection.emit('afterUpload', data);\n      }\n\n      this.result.emit('end', error, data || this.fileData);\n      return this.result;\n    }\n\n    return end;\n  }();\n\n  _proto2.sendChunk = function () {\n    function sendChunk(evt) {\n      var _this3 = this;\n\n      var opts = {\n        fileId: this.fileId,\n        binData: evt.data.bin,\n        chunkId: evt.data.chunkId\n      };\n\n      if (this.config.isBase64) {\n        var pad = opts.binData.length % 4;\n\n        if (pad) {\n          var p = 0;\n\n          while (p < pad) {\n            opts.binData += '=';\n            p++;\n          }\n        }\n      }\n\n      this.emit('data', evt.data.bin);\n\n      if (this.pipes.length) {\n        for (var i = this.pipes.length - 1; i >= 0; i--) {\n          opts.binData = this.pipes[i](opts.binData);\n        }\n      }\n\n      if (this.fileLength === evt.data.chunkId) {\n        if (this.collection.debug) {\n          console.timeEnd(\"loadFile \" + this.fileData.name);\n        }\n\n        this.emit('readEnd');\n      }\n\n      if (opts.binData) {\n        if (this.config.transport === 'ddp') {\n          this.config.ddp.call(this.collection._methodNames._Write, opts, function (error) {\n            _this3.transferTime += +new Date() - _this3.startTime[opts.chunkId];\n\n            if (error) {\n              if (_this3.result.state.get() !== 'aborted') {\n                _this3.emit('end', error);\n              }\n            } else {\n              ++_this3.sentChunks;\n\n              if (_this3.sentChunks >= _this3.fileLength) {\n                _this3.emit('sendEOF');\n              } else if (_this3.currentChunk < _this3.fileLength) {\n                _this3.emit('upload');\n              }\n\n              _this3.emit('calculateStats');\n            }\n          });\n        } else {\n          HTTP.call('POST', \"\" + _rootUrl + this.collection.downloadRoute + \"/\" + this.collection.collectionName + \"/__upload\", {\n            content: opts.binData,\n            headers: {\n              'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n              'x-fileid': opts.fileId,\n              'x-chunkid': opts.chunkId,\n              'content-type': 'text/plain'\n            },\n            beforeSend: function (xhr) {\n              xhr.withCredentials = true;\n              return true;\n            }\n          }, function (error) {\n            _this3.transferTime += +new Date() - _this3.startTime[opts.chunkId];\n\n            if (error) {\n              if (\"\" + error === 'Error: network' || \"\" + error === 'Error: Connection lost') {\n                _this3.result.pause();\n              } else {\n                if (_this3.result.state.get() !== 'aborted') {\n                  _this3.emit('end', error);\n                }\n              }\n            } else {\n              ++_this3.sentChunks;\n\n              if (_this3.sentChunks >= _this3.fileLength) {\n                _this3.emit('sendEOF');\n              } else if (_this3.currentChunk < _this3.fileLength) {\n                _this3.emit('upload');\n              }\n\n              _this3.emit('calculateStats');\n            }\n          });\n        }\n      }\n    }\n\n    return sendChunk;\n  }();\n\n  _proto2.sendEOF = function () {\n    function sendEOF() {\n      var _this4 = this;\n\n      this.collection._debug('[FilesCollection] [UploadInstance] [sendEOF]', this.EOFsent);\n\n      if (!this.EOFsent) {\n        this.EOFsent = true;\n        var opts = {\n          eof: true,\n          fileId: this.fileId\n        };\n\n        if (this.config.transport === 'ddp') {\n          this.config.ddp.call(this.collection._methodNames._Write, opts, function (error, result) {\n            _this4.emit('end', error, result);\n          });\n        } else {\n          HTTP.call('POST', \"\" + _rootUrl + this.collection.downloadRoute + \"/\" + this.collection.collectionName + \"/__upload\", {\n            content: '',\n            headers: {\n              'x-eof': '1',\n              'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n              'x-fileId': opts.fileId,\n              'content-type': 'text/plain'\n            },\n            beforeSend: function (xhr) {\n              xhr.withCredentials = true;\n              return true;\n            }\n          }, function (error, _result) {\n            var result;\n\n            try {\n              result = JSON.parse((helpers.isObject(_result) ? _result.content : void 0) || {});\n            } catch (e) {\n              console.warn('Something went wrong! [sendEOF] method doesn\\'t returned JSON! Looks like you\\'re on Cordova app or behind proxy, switching to DDP transport is recommended.');\n              result = {};\n            }\n\n            if (result.meta) {\n              result.meta = fixJSONParse(result.meta);\n            }\n\n            _this4.emit('end', error, result);\n          });\n        }\n      }\n    }\n\n    return sendEOF;\n  }();\n\n  _proto2.proceedChunk = function () {\n    function proceedChunk(chunkId) {\n      var _this5 = this;\n\n      var chunk = this.config.file.slice(this.config.chunkSize * (chunkId - 1), this.config.chunkSize * chunkId);\n\n      if (this.config.isBase64) {\n        this.emit('sendChunk', {\n          data: {\n            bin: chunk,\n            chunkId: chunkId\n          }\n        });\n      } else {\n        var fileReader;\n\n        if (window.FileReader) {\n          fileReader = new window.FileReader();\n\n          fileReader.onloadend = function (evt) {\n            _this5.emit('sendChunk', {\n              data: {\n                bin: ((helpers.isObject(fileReader) ? fileReader.result : void 0) || (evt.srcElement ? evt.srcElement.result : void 0) || (evt.target ? evt.target.result : void 0)).split(',')[1],\n                chunkId: chunkId\n              }\n            });\n          };\n\n          fileReader.onerror = function (e) {\n            _this5.emit('end', (e.target || e.srcElement).error);\n          };\n\n          fileReader.readAsDataURL(chunk);\n        } else if (window.FileReaderSync) {\n          fileReader = new window.FileReaderSync();\n          this.emit('sendChunk', {\n            data: {\n              bin: fileReader.readAsDataURL(chunk).split(',')[1],\n              chunkId: chunkId\n            }\n          });\n        } else {\n          this.emit('end', 'File API is not supported in this Browser!');\n        }\n      }\n    }\n\n    return proceedChunk;\n  }();\n\n  _proto2.upload = function () {\n    function upload() {\n      if (this.result.onPause.get()) {\n        return this;\n      }\n\n      if (this.result.state.get() === 'aborted') {\n        return this;\n      }\n\n      if (this.currentChunk <= this.fileLength) {\n        ++this.currentChunk;\n\n        if (this.worker) {\n          this.worker.postMessage({\n            f: this.config.file,\n            sc: this.sentChunks,\n            cc: this.currentChunk,\n            cs: this.config.chunkSize,\n            ib: this.config.isBase64\n          });\n        } else {\n          this.emit('proceedChunk', this.currentChunk);\n        }\n      } else {\n        this.emit('sendEOF');\n      }\n\n      this.startTime[this.currentChunk] = +new Date();\n      return this;\n    }\n\n    return upload;\n  }();\n\n  _proto2.createStreams = function () {\n    function createStreams() {\n      this.collection._debug('[FilesCollection] [UploadInstance] [createStreams]');\n\n      var i = 1;\n\n      while (i <= this.config.streams) {\n        this.emit('upload');\n        i++;\n      }\n    }\n\n    return createStreams;\n  }();\n\n  _proto2.prepare = function () {\n    function prepare() {\n      var _this6 = this;\n\n      var _len;\n\n      this.config.onStart && this.config.onStart.call(this.result, null, this.fileData);\n      this.result.emit('start', null, this.fileData);\n\n      if (this.config.chunkSize === 'dynamic') {\n        this.config.chunkSize = this.fileData.size / 1000;\n\n        if (this.config.chunkSize < 327680) {\n          this.config.chunkSize = 327680;\n        } else if (this.config.chunkSize > 1048576) {\n          this.config.chunkSize = 1048576;\n        }\n\n        if (this.config.transport === 'http') {\n          this.config.chunkSize = Math.round(this.config.chunkSize / 2);\n        } else if (isSafari) {\n          this.config.chunkSize = Math.ceil(this.config.chunkSize / 8);\n        }\n      }\n\n      if (this.config.isBase64) {\n        this.config.chunkSize = Math.floor(this.config.chunkSize / 4) * 4;\n        _len = Math.ceil(this.config.file.length / this.config.chunkSize);\n      } else {\n        this.config.chunkSize = Math.floor(this.config.chunkSize / 8) * 8;\n        _len = Math.ceil(this.fileData.size / this.config.chunkSize);\n      }\n\n      if (this.config.streams === 'dynamic') {\n        this.config.streams = helpers.clone(_len);\n\n        if (this.config.streams > 24) {\n          this.config.streams = 24;\n        }\n\n        if (this.config.transport === 'http') {\n          this.config.streams = Math.round(this.config.streams / 2);\n        } else if (isSafari) {\n          this.config.streams = 1;\n        }\n      }\n\n      this.fileLength = _len <= 0 ? 1 : _len;\n\n      if (this.config.streams > this.fileLength) {\n        this.config.streams = this.fileLength;\n      }\n\n      this.result.config.fileLength = this.fileLength;\n      var opts = {\n        file: this.fileData,\n        fileId: this.fileId,\n        chunkSize: this.config.isBase64 ? this.config.chunkSize / 4 * 3 : this.config.chunkSize,\n        fileLength: this.fileLength\n      };\n\n      if (this.FSName !== this.fileId) {\n        opts.FSName = this.FSName;\n      }\n\n      var handleStart = function (error) {\n        if (error) {\n          _this6.collection._debug('[FilesCollection] [_Start] Error:', error);\n\n          _this6.emit('end', error);\n        } else {\n          _this6.result.continueFunc = function () {\n            _this6.collection._debug('[FilesCollection] [insert] [continueFunc]');\n\n            _this6.emit('createStreams');\n          };\n\n          _this6.emit('createStreams');\n        }\n      };\n\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Start, opts, handleStart);\n      } else {\n        if (helpers.isObject(opts.file) ? opts.file.meta : void 0) {\n          opts.file.meta = fixJSONStringify(opts.file.meta);\n        }\n\n        HTTP.call('POST', \"\" + _rootUrl + this.collection.downloadRoute + \"/\" + this.collection.collectionName + \"/__upload\", {\n          data: opts,\n          headers: {\n            'x-start': '1',\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null\n          },\n          beforeSend: function (xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, handleStart);\n      }\n    }\n\n    return prepare;\n  }();\n\n  _proto2.pipe = function () {\n    function pipe(func) {\n      this.pipes.push(func);\n      return this;\n    }\n\n    return pipe;\n  }();\n\n  _proto2.start = function () {\n    function start() {\n      var _this7 = this;\n\n      var isUploadAllowed;\n\n      if (this.fileData.size <= 0) {\n        this.end(new Meteor.Error(400, 'Can\\'t upload empty file'));\n        return this.result;\n      }\n\n      if (this.config.onBeforeUpload && helpers.isFunction(this.config.onBeforeUpload)) {\n        isUploadAllowed = this.config.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n\n        if (isUploadAllowed !== true) {\n          return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'config.onBeforeUpload() returned false'));\n        }\n      }\n\n      if (this.collection.onBeforeUpload && helpers.isFunction(this.collection.onBeforeUpload)) {\n        isUploadAllowed = this.collection.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n\n        if (isUploadAllowed !== true) {\n          return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'collection.onBeforeUpload() returned false'));\n        }\n      }\n\n      Tracker.autorun(function (computation) {\n        _this7.trackerComp = computation;\n\n        if (!_this7.result.onPause.curValue && !Meteor.status().connected) {\n          _this7.collection._debug('[FilesCollection] [insert] [Tracker] [pause]');\n\n          _this7.result.pause();\n        }\n      });\n\n      if (this.worker) {\n        this.collection._debug('[FilesCollection] [insert] using WebWorkers');\n\n        this.worker.onmessage = function (evt) {\n          if (evt.data.error) {\n            _this7.collection._debug('[FilesCollection] [insert] [worker] [onmessage] [ERROR:]', evt.data.error);\n\n            _this7.emit('proceedChunk', evt.data.chunkId);\n          } else {\n            _this7.emit('sendChunk', evt);\n          }\n        };\n\n        this.worker.onerror = function (e) {\n          _this7.collection._debug('[FilesCollection] [insert] [worker] [onerror] [ERROR:]', e);\n\n          _this7.emit('end', e.message);\n        };\n      } else {\n        this.collection._debug('[FilesCollection] [insert] using MainThread');\n      }\n\n      this.emit('prepare');\n      return this.result;\n    }\n\n    return start;\n  }();\n\n  _proto2.manual = function () {\n    function manual() {\n      var _this8 = this;\n\n      this.result.start = function () {\n        _this8.emit('start');\n      };\n\n      var self = this;\n\n      this.result.pipe = function (func) {\n        self.pipe(func);\n        return this;\n      };\n\n      return this.result;\n    }\n\n    return manual;\n  }();\n\n  return UploadInstance;\n}(EventEmitter);\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"node_modules\":{\"eventemitter3\":{\"package.json\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/ostrio_files/node_modules/eventemitter3/package.json                                           //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\nmodule.exports = {\n  \"name\": \"eventemitter3\",\n  \"version\": \"4.0.7\",\n  \"main\": \"index.js\"\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"index.js\":function module(require,exports,module){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                    //\n// node_modules/meteor/ostrio_files/node_modules/eventemitter3/index.js                                               //\n//                                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                      //\n'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/ostrio:files/client.js\");\n\n/* Exports */\nPackage._define(\"ostrio:files\", exports, {\n  FilesCollection: FilesCollection\n});\n\n})();\n","servePath":"/packages/ostrio_files.js","sourceMap":{"version":3,"sources":["packages/ostrio:files/client.js","packages/ostrio:files/core.js","packages/ostrio:files/cursor.js","packages/ostrio:files/lib.js","packages/ostrio:files/upload.js"],"names":["_assertThisInitialized","module","link","default","v","_inheritsLoose","export","FilesCollection","Mongo","Meteor","DDP","Cookies","check","Match","UploadInstance","FilesCollectionCore","formatFleURL","helpers","NOOP","allowedParams","config","Object","keys","forEach","param","includes","self","cookie","allowQueryStringCookies","isBoolean","debug","public","chunkSize","Math","floor","isString","collectionName","collection","Collection","_name","filesCollection","String","downloadRoute","Error","disableUpload","replace","isFunction","namingFunction","onBeforeUpload","allowClientCode","ddp","onbeforeunloadMessage","setTokenCookie","connection","_lastSessionId","set","path","sameSite","isCordova","send","Accounts","onReconnect","conn","startup","onLogin","OneOf","Function","_URL","window","URL","webkitURL","mozURL","msURL","oURL","Worker","Blob","createObjectURL","_supportWebWorker","_webWorkerUrl","type","absoluteUrl","e","_debug","schema","Boolean","Number","Any","_methodNames","_Abort","_Write","_Start","_Remove","_getMimeType","fileData","mime","isObject","_getUser","result","user","userId","insert","autoStart","console","warn","remove","selector","callback","JSON","stringify","Optional","call","Template","registerHelper","fileRef","_version","_URIBase","version","URIBase","EventEmitter","FilesCursor","FileCursor","info","log","apply","arguments","_getFileName","fileName","name","length","_getExt","extension","split","pop","toLowerCase","ext","extensionWithDot","_updateFileTypes","data","isVideo","test","isAudio","isImage","isText","isJSON","isPDF","_dataToSchema","ds","meta","size","versions","original","_downloadRoute","_collectionName","fileId","_id","_storagePath","storagePath","assign","findOne","options","doc","find","update","__helpers","optional","blackbox","updatedAt","Date","_fileRef","_collection","get","property","fetch","with","_selector","_current","cursor","hasNext","count","next","hasPrevious","previous","first","last","context","each","map","file","current","observe","callbacks","observeChanges","fixJSONParse","fixJSONStringify","isUndefined","obj","isArray","Array","prototype","toString","isEmpty","isDate","clone","slice","has","_obj","hasOwnProperty","i","omit","clear","now","throttle","func","wait","timeout","that","args","later","leading","throttled","remaining","clearTimeout","trailing","setTimeout","cancel","_helpers","key","parseInt","__meteor_runtime_config__","ROOT_URL","_root","vRef","FileUpload","HTTP","Random","Tracker","ReactiveVar","_rootUrl","MOBILE_ROOT_URL","isSafari","navigator","userAgent","isBase64","state","onPause","progress","continueFunc","estimateTime","estimateSpeed","estimateTimer","setInterval","_currentTime","pause","emit","continue","toggle","abort","removeEventListener","beforeunload","_onEnd","onAbort","timeEnd","streams","transport","allowWebWorkers","onError","onStart","onUploaded","onProgress","_file","time","worker","wwError","startTime","currentChunk","transferTime","trackerComp","sentChunks","fileLength","EOFsent","id","FSName","pipes","message","returnValue","addEventListener","addListener","end","start","upload","sendEOF","prepare","sendChunk","proceedChunk","createStreams","_t","round","sentBytes","chunksSent","chunksLength","bytesSent","clearInterval","terminate","stop","error","evt","opts","binData","bin","chunkId","pad","p","content","headers","beforeSend","xhr","withCredentials","eof","_result","parse","chunk","fileReader","FileReader","onloadend","srcElement","target","onerror","readAsDataURL","FileReaderSync","postMessage","f","sc","cc","cs","ib","_len","ceil","handleStart","pipe","push","isUploadAllowed","autorun","computation","curValue","status","connected","onmessage","manual"],"mappings":"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","file":"/packages/ostrio_files.js","sourcesContent":["import { Mongo }           from 'meteor/mongo';\nimport { Meteor }          from 'meteor/meteor';\nimport { DDP }             from 'meteor/ddp-client';\nimport { Cookies }         from 'meteor/ostrio:cookies';\nimport { check, Match }    from 'meteor/check';\nimport { UploadInstance }  from './upload.js';\nimport FilesCollectionCore from './core.js';\nimport { formatFleURL, helpers } from './lib.js';\n\nconst NOOP = () => { };\nconst allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\nexport class FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n    if (config) {\n      Object.keys(config).forEach((param) => {\n        if (allowedParams.includes(param)) {\n          this[param] = config[param];\n        }\n      });\n    }\n\n    const self = this;\n    const cookie = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies\n    });\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: \"downloadRoute\" must be precisely provided on \"public\" collections! Note: \"downloadRoute\" must be equal or be inside of your web/proxy-server (relative) root.`);\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, { path: '/', sameSite: 'Lax' });\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect((conn) => {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {type: 'application/javascript'}));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n\n    this._methodNames = {\n      _Abort: `_FilesCollectionAbort_${this.collectionName}`,\n      _Write: `_FilesCollectionWrite_${this.collectionName}`,\n      _Start: `_FilesCollectionStart_${this.collectionName}`,\n      _Remove: `_FilesCollectionRemove_${this.collectionName}`\n    };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n    if (helpers.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n    return mime;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n      userId: null\n    };\n\n    if (helpers.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n  insert(config, autoStart = true) {\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n    return (new UploadInstance(config, this))[autoStart ? 'start' : 'manual']();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n  remove(selector = {}, callback) {\n    this._debug(`[FilesCollection] [remove(${JSON.stringify(selector)})]`);\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, (callback || NOOP));\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', (fileRef, _version = 'original', _URIBase) => {\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      const version = (!helpers.isString(_version)) ? 'original' : _version;\n      const URIBase = (!helpers.isString(_URIBase)) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});\n","import { EventEmitter }            from 'eventemitter3';\nimport { check, Match }            from 'meteor/check';\nimport { formatFleURL, helpers }   from './lib.js';\nimport { FilesCursor, FileCursor } from './cursor.js';\n\nexport default class FilesCollectionCore extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  static __helpers = helpers;\n\n  static schema = {\n    _id: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    name: {\n      type: String\n    },\n    type: {\n      type: String\n    },\n    path: {\n      type: String\n    },\n    isVideo: {\n      type: Boolean\n    },\n    isAudio: {\n      type: Boolean\n    },\n    isImage: {\n      type: Boolean\n    },\n    isText: {\n      type: Boolean\n    },\n    isJSON: {\n      type: Boolean\n    },\n    isPDF: {\n      type: Boolean\n    },\n    extension: {\n      type: String,\n      optional: true\n    },\n    ext: {\n      type: String,\n      optional: true\n    },\n    extensionWithDot: {\n      type: String,\n      optional: true\n    },\n    mime: {\n      type: String,\n      optional: true\n    },\n    'mime-type': {\n      type: String,\n      optional: true\n    },\n    _storagePath: {\n      type: String\n    },\n    _downloadRoute: {\n      type: String\n    },\n    _collectionName: {\n      type: String\n    },\n    public: {\n      type: Boolean,\n      optional: true\n    },\n    meta: {\n      type: Object,\n      blackbox: true,\n      optional: true\n    },\n    userId: {\n      type: String,\n      optional: true\n    },\n    updatedAt: {\n      type: Date,\n      optional: true\n    },\n    versions: {\n      type: Object,\n      blackbox: true\n    }\n  };\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _debug() {\n    if (this.debug) {\n      (console.info || console.log || function () { }).apply(void 0, arguments);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  _getFileName(fileData) {\n    const fileName = fileData.name || fileData.fileName;\n    if (helpers.isString(fileName) && (fileName.length > 0)) {\n      return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  _getExt(fileName) {\n    if (fileName.includes('.')) {\n      const extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n      return { ext: extension, extension, extensionWithDot: `.${extension}` };\n    }\n    return { ext: '', extension: '', extensionWithDot: '' };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  _updateFileTypes(data) {\n    data.isVideo  = /^video\\//i.test(data.type);\n    data.isAudio  = /^audio\\//i.test(data.type);\n    data.isImage  = /^image\\//i.test(data.type);\n    data.isText   = /^text\\//i.test(data.type);\n    data.isJSON   = /^application\\/json$/i.test(data.type);\n    data.isPDF    = /^application\\/(x-)?pdf$/i.test(data.type);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  _dataToSchema(data) {\n    const ds = {\n      name: data.name,\n      extension: data.extension,\n      ext: data.extension,\n      extensionWithDot: '.' + data.extension,\n      path: data.path,\n      meta: data.meta,\n      type: data.type,\n      mime: data.type,\n      'mime-type': data.type,\n      size: data.size,\n      userId: data.userId || null,\n      versions: {\n        original: {\n          path: data.path,\n          size: data.size,\n          type: data.type,\n          extension: data.extension\n        }\n      },\n      _downloadRoute: data._downloadRoute || this.downloadRoute,\n      _collectionName: data._collectionName || this.collectionName\n    };\n\n    //Optional fileId\n    if (data.fileId) {\n      ds._id = data.fileId;\n    }\n\n    this._updateFileTypes(ds);\n    ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n    return ds;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n  findOne(selector = {}, options) {\n    this._debug(`[FilesCollection] [findOne(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    const doc = this.collection.findOne(selector, options);\n    if (doc) {\n      return new FileCursor(doc, this);\n    }\n    return doc;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  find(selector = {}, options) {\n    this._debug(`[FilesCollection] [find(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    return new FilesCursor(selector, options, this);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n  update() {\n    this.collection.update.apply(this.collection, arguments);\n    return this.collection;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  link(fileRef, version = 'original', URIBase) {\n    this._debug(`[FilesCollection] [link(${(helpers.isObject(fileRef) ? fileRef._id : void 0)}, ${version})]`);\n    check(fileRef, Object);\n\n    if (!fileRef) {\n      return '';\n    }\n    return formatFleURL(fileRef, version, URIBase);\n  }\n}\n","import { Meteor } from 'meteor/meteor';\n\n/*\n * @private\n * @locus Anywhere\n * @class FileCursor\n * @param _fileRef    {Object} - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Internal class, represents each record in `FilesCursor.each()` or document returned from `.findOne()` method\n */\nexport class FileCursor {\n  constructor(_fileRef, _collection) {\n    this._fileRef    = _fileRef;\n    this._collection = _collection;\n    Object.assign(this, _fileRef);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Remove document\n   * @returns {FileCursor}\n   */\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FileCursor] [remove()]');\n    if (this._fileRef) {\n      this._collection.remove(this._fileRef._id, callback);\n    } else {\n      callback && callback(new Meteor.Error(404, 'No such file'));\n    }\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name link\n   * @param version {String} - Name of file's subversion\n   * @param URIBase {String} - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL to File\n   * @returns {String}\n   */\n  link(version = 'original', URIBase) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [link(${version})]`);\n    if (this._fileRef) {\n      return this._collection.link(this._fileRef, version, URIBase);\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name get\n   * @param property {String} - Name of sub-object property\n   * @summary Returns current document as a plain Object, if `property` is specified - returns value of sub-object property\n   * @returns {Object|mix}\n   */\n  get(property) {\n    this._collection._debug(`[FilesCollection] [FileCursor] [get(${property})]`);\n    if (property) {\n      return this._fileRef[property];\n    }\n    return this._fileRef;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name fetch\n   * @summary Returns document as plain Object in Array\n   * @returns {[Object]}\n   */\n  fetch() {\n    this._collection._debug('[FilesCollection] [FileCursor] [fetch()]');\n    return [this._fileRef];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FileCursor\n   * @name with\n   * @summary Returns reactive version of current FileCursor, useful to use with `{{#with}}...{{/with}}` block template helper\n   * @returns {[Object]}\n   */\n  with() {\n    this._collection._debug('[FilesCollection] [FileCursor] [with()]');\n    return Object.assign(this, this._collection.collection.findOne(this._fileRef._id));\n  }\n}\n\n/*\n * @private\n * @locus Anywhere\n * @class FilesCursor\n * @param _selector   {String|Object}   - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n * @param options     {Object}          - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#selectors)\n * @param _collection {FilesCollection} - FilesCollection Instance\n * @summary Implementation of Cursor for FilesCollection\n */\nexport class FilesCursor {\n  constructor(_selector = {}, options, _collection) {\n    this._collection = _collection;\n    this._selector   = _selector;\n    this._current    = -1;\n    this.cursor      = this._collection.collection.find(this._selector, options);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name get\n   * @summary Returns all matching document(s) as an Array. Alias of `.fetch()`\n   * @returns {[Object]}\n   */\n  get() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [get()]');\n    return this.cursor.fetch();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasNext\n   * @summary Returns `true` if there is next item available on Cursor\n   * @returns {Boolean}\n   */\n  hasNext() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasNext()]');\n    return this._current < (this.cursor.count() - 1);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name next\n   * @summary Returns next item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  next() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [next()]');\n    this.cursor.fetch()[++this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name hasPrevious\n   * @summary Returns `true` if there is previous item available on Cursor\n   * @returns {Boolean}\n   */\n  hasPrevious() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [hasPrevious()]');\n    return this._current !== -1;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name previous\n   * @summary Returns previous item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  previous() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [previous()]');\n    this.cursor.fetch()[--this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name fetch\n   * @summary Returns all matching document(s) as an Array.\n   * @returns {[Object]}\n   */\n  fetch() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [fetch()]');\n    return this.cursor.fetch() || [];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name first\n   * @summary Returns first item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  first() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [first()]');\n    this._current = 0;\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name last\n   * @summary Returns last item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  last() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [last()]');\n    this._current = this.count() - 1;\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name count\n   * @summary Returns the number of documents that match a query\n   * @returns {Number}\n   */\n  count() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [count()]');\n    return this.cursor.count();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name remove\n   * @param callback {Function} - Triggered asynchronously after item is removed or failed to be removed\n   * @summary Removes all documents that match a query\n   * @returns {FilesCursor}\n   */\n  remove(callback) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [remove()]');\n    this._collection.remove(this._selector, callback);\n    return this;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name forEach\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Call `callback` once for each matching document, sequentially and synchronously.\n   * @returns {undefined}\n   */\n  forEach(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [forEach()]');\n    this.cursor.forEach(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name each\n   * @summary Returns an Array of FileCursor made for each document on current cursor\n   *          Useful when using in {{#each FilesCursor#each}}...{{/each}} block template helper\n   * @returns {[FileCursor]}\n   */\n  each() {\n    return this.map((file) => {\n      return new FileCursor(file, this._collection);\n    });\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name map\n   * @param callback {Function} - Function to call. It will be called with three arguments: the `file`, a 0-based index, and cursor itself\n   * @param context {Object} - An object which will be the value of `this` inside `callback`\n   * @summary Map `callback` over all matching documents. Returns an Array.\n   * @returns {Array}\n   */\n  map(callback, context = {}) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [map()]');\n    return this.cursor.map(callback, context);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name current\n   * @summary Returns current item on Cursor, if available\n   * @returns {Object|undefined}\n   */\n  current() {\n    this._collection._debug('[FilesCollection] [FilesCursor] [current()]');\n    if (this._current < 0) {\n      this._current = 0;\n    }\n    return this.fetch()[this._current];\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observe\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observe\n   * @returns {Object} - live query handle\n   */\n  observe(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observe()]');\n    return this.cursor.observe(callbacks);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCursor\n   * @name observeChanges\n   * @param callbacks {Object} - Functions to call to deliver the result set as it changes\n   * @summary Watch a query. Receive callbacks as the result set changes. Only the differences between the old and new documents are passed to the callbacks.\n   * @url http://docs.meteor.com/api/collections.html#Mongo-Cursor-observeChanges\n   * @returns {Object} - live query handle\n   */\n  observeChanges(callbacks) {\n    this._collection._debug('[FilesCollection] [FilesCursor] [observeChanges()]');\n    return this.cursor.observeChanges(callbacks);\n  }\n}\n","import { check } from 'meteor/check';\n\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isObject(obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n    return obj === Object(obj);\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  isBoolean(obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n  isFunction(obj) {\n    return typeof obj === 'function' || false;\n  },\n  isEmpty(obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n    return false;\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n  has(_obj, path) {\n    let obj = _obj;\n    if (!this.isObject(obj)) {\n      return false;\n    }\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    const length = path.length;\n    for (let i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n      obj = obj[path[i]];\n    }\n    return !!length;\n  },\n  omit(obj, ...keys) {\n    const clear = Object.assign({}, obj);\n    for (let i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n  now: Date.now,\n  throttle(func, wait, options = {}) {\n    let previous = 0;\n    let timeout = null;\n    let result;\n    const that = this;\n    let self;\n    let args;\n\n    const later = () => {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n      if (!timeout) {\n        self = args = null;\n      }\n    };\n\n    const throttled = function () {\n      const now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      const remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(self, args);\n        if (!timeout) {\n          self = args = null;\n        }\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = () => {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n};\n\nconst _helpers = ['String', 'Number', 'Date'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @const {Function} fixJSONParse - Fix issue with Date parse\n */\nconst fixJSONParse = function(obj) {\n  for (let key in obj) {\n    if (helpers.isString(obj[key]) && obj[key].includes('=--JSON-DATE--=')) {\n      obj[key] = obj[key].replace('=--JSON-DATE--=', '');\n      obj[key] = new Date(parseInt(obj[key]));\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONParse(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONParse(v);\n        } else if (helpers.isString(v) && v.includes('=--JSON-DATE--=')) {\n          v = v.replace('=--JSON-DATE--=', '');\n          obj[key][i] = new Date(parseInt(v));\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @const {Function} fixJSONStringify - Fix issue with Date stringify\n */\nconst fixJSONStringify = function(obj) {\n  for (let key in obj) {\n    if (helpers.isDate(obj[key])) {\n      obj[key] = `=--JSON-DATE--=${+obj[key]}`;\n    } else if (helpers.isObject(obj[key])) {\n      obj[key] = fixJSONStringify(obj[key]);\n    } else if (helpers.isArray(obj[key])) {\n      let v;\n      for (let i = 0; i < obj[key].length; i++) {\n        v = obj[key][i];\n        if (helpers.isObject(v)) {\n          obj[key][i] = fixJSONStringify(v);\n        } else if (helpers.isDate(v)) {\n          obj[key][i] = `=--JSON-DATE--=${+v}`;\n        }\n      }\n    }\n  }\n  return obj;\n};\n\n/*\n * @locus Anywhere\n * @private\n * @name formatFleURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like build URL for\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Returns formatted URL for file\n * @returns {String} Downloadable link\n */\nconst formatFleURL = (fileRef, version = 'original', _URIBase = (__meteor_runtime_config__ || {}).ROOT_URL) => {\n  check(fileRef, Object);\n  check(version, String);\n  let URIBase = _URIBase;\n\n  if (!helpers.isString(URIBase)) {\n    URIBase = (__meteor_runtime_config__ || {}).ROOT_URL || '/';\n  }\n\n  const _root = URIBase.replace(/\\/+$/, '');\n  const vRef = (fileRef.versions && fileRef.versions[version]) || fileRef || {};\n\n  let ext;\n  if (helpers.isString(vRef.extension)) {\n    ext = `.${vRef.extension.replace(/^\\./, '')}`;\n  } else {\n    ext = '';\n  }\n\n  if (fileRef.public === true) {\n    return _root + (version === 'original' ? `${fileRef._downloadRoute}/${fileRef._id}${ext}` : `${fileRef._downloadRoute}/${version}-${fileRef._id}${ext}`);\n  }\n  return _root + `${fileRef._downloadRoute}/${fileRef._collectionName}/${fileRef._id}/${version}/${fileRef._id}${ext}`;\n};\n\nexport { fixJSONParse, fixJSONStringify, formatFleURL, helpers };\n","import { HTTP }         from 'meteor/http';\nimport { Meteor }       from 'meteor/meteor';\nimport { Random }       from 'meteor/random';\nimport { Tracker }      from 'meteor/tracker';\nimport { ReactiveVar }  from 'meteor/reactive-var';\nimport { EventEmitter } from 'eventemitter3';\nimport { check, Match } from 'meteor/check';\nimport { fixJSONParse, fixJSONStringify, helpers } from './lib.js';\n\nconst _rootUrl = (window.__meteor_runtime_config__.MOBILE_ROOT_URL || window.__meteor_runtime_config__.ROOT_URL).replace(/\\/+$/, '');\nconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\n/*\n * @locus Client\n * @name FileUpload\n * @class FileUpload\n * @summary Internal Class, instance of this class is returned from `.insert()` method\n */\nexport class FileUpload extends EventEmitter {\n  constructor(config) {\n    super();\n    this.config = config;\n    this.config._debug('[FilesCollection] [FileUpload] [constructor]');\n\n    if (!this.config.isBase64) {\n      this.file        = Object.assign({}, helpers.clone(this.config.file), this.config.fileData);\n    } else {\n      this.file        = this.config.fileData;\n    }\n    this.state         = new ReactiveVar('active');\n    this.onPause       = new ReactiveVar(false);\n    this.progress      = new ReactiveVar(0);\n    this.continueFunc  = () => { };\n    this.estimateTime  = new ReactiveVar(1000);\n    this.estimateSpeed = new ReactiveVar(0);\n    this.estimateTimer = Meteor.setInterval(() => {\n      if (this.state.get() === 'active') {\n        const _currentTime = this.estimateTime.get();\n        if (_currentTime > 1000) {\n          this.estimateTime.set(_currentTime - 1000);\n        }\n      }\n    }, 1000);\n  }\n  pause() {\n    this.config._debug('[FilesCollection] [insert] [.pause()]');\n    if (!this.onPause.get()) {\n      this.onPause.set(true);\n      this.state.set('paused');\n      this.emit('pause', this.file);\n    }\n  }\n  continue() {\n    this.config._debug('[FilesCollection] [insert] [.continue()]');\n    if (this.onPause.get()) {\n      this.onPause.set(false);\n      this.state.set('active');\n      this.emit('continue', this.file);\n      this.continueFunc();\n    }\n  }\n  toggle() {\n    this.config._debug('[FilesCollection] [insert] [.toggle()]');\n    if (this.onPause.get()) {\n      this.continue();\n    } else {\n      this.pause();\n    }\n  }\n  abort() {\n    this.config._debug('[FilesCollection] [insert] [.abort()]');\n    window.removeEventListener('beforeunload', this.config.beforeunload, false);\n    this.pause();\n    this.config._onEnd();\n    this.state.set('aborted');\n    this.config.onAbort && this.config.onAbort.call(this, this.file);\n    this.emit('abort', this.file);\n    if (this.config.debug) {\n      console.timeEnd(`insert ${this.config.fileData.name}`);\n    }\n\n    this.config.ddp.call(this.config._Abort, this.config.fileId);\n  }\n}\n\n/*\n * @locus Client\n * @name UploadInstance\n * @class UploadInstance\n * @summary Internal Class, used for file upload\n */\nexport class UploadInstance extends EventEmitter {\n  constructor(config, collection) {\n    super();\n    this.config     = config;\n    this.collection = collection;\n    this.collection._debug('[FilesCollection] [insert()]');\n\n    if (!this.config.ddp) {\n      this.config.ddp = this.collection.ddp;\n    }\n\n    if (!this.config.meta) {\n      this.config.meta = {};\n    }\n\n    if (!this.config.streams) {\n      this.config.streams = 2;\n    }\n\n    if (this.config.streams < 1) {\n      this.config.streams = 2;\n    }\n\n    if (!helpers.isString(this.config.transport)) {\n      this.config.transport = 'ddp';\n    }\n\n    this.config.transport = this.config.transport.toLowerCase();\n\n    if (this.config.transport !== 'ddp' && this.config.transport !== 'http') {\n      this.config.transport = 'ddp';\n    }\n\n    if (!this.config.chunkSize) {\n      this.config.chunkSize = this.collection.chunkSize;\n    }\n\n    if (!helpers.isBoolean(this.config.allowWebWorkers)) {\n      this.config.allowWebWorkers = true;\n    }\n\n    check(this.config, {\n      ddp: Match.Any,\n      file: Match.Any,\n      fileId: Match.Optional(String),\n      meta: Match.Optional(Object),\n      type: Match.Optional(String),\n      onError: Match.Optional(Function),\n      onAbort: Match.Optional(Function),\n      streams: Match.OneOf('dynamic', Number),\n      onStart: Match.Optional(Function),\n      fileName: Match.Optional(String),\n      isBase64: Match.Optional(Boolean),\n      transport: Match.OneOf('http', 'ddp'),\n      chunkSize: Match.OneOf('dynamic', Number),\n      onUploaded: Match.Optional(Function),\n      onProgress: Match.Optional(Function),\n      onBeforeUpload: Match.Optional(Function),\n      allowWebWorkers: Boolean\n    });\n\n    if (this.config.isBase64 === true) {\n      check(this.config.file, String);\n\n      if (!this.config.fileName) {\n        throw new Meteor.Error(400, '\"fileName\" must me specified for base64 upload!');\n      }\n\n      if (this.config.file.includes('data:')) {\n        this.config.file = this.config.file.replace('data:', '');\n      }\n\n      if (this.config.file.includes(',')) {\n        const _file = this.config.file.split(',');\n        this.fileData = {\n          size: Math.floor(((_file[1].replace(/\\=/g, '')).length / 4) * 3),\n          type: _file[0].split(';')[0],\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n        this.config.file = _file[1];\n      } else if (!this.config.type) {\n        throw new Meteor.Error(400, '\"type\" must me specified for base64 upload! And represent mime-type of the file');\n      } else {\n        this.fileData = {\n          size: Math.floor(((this.config.file.replace(/\\=/g, '')).length / 4) * 3),\n          type: this.config.type,\n          name: this.config.fileName,\n          meta: this.config.meta\n        };\n      }\n    }\n\n    if (this.config.file) {\n      if (!this.config.isBase64) {\n        try {\n          if (!this.config.file.name || !this.config.file.size) {\n            throw new Meteor.Error(500, 'Not a File!');\n          }\n        } catch (e) {\n          throw new Meteor.Error(500, '[FilesCollection] [insert] Insert method accepts File, not a FileList. You need to provide a real File. File must have `.name` property, and its size must be larger than zero.');\n        }\n\n        this.fileData = {\n          size: this.config.file.size,\n          type: this.config.type || this.config.file.type,\n          name: this.config.fileName || this.config.file.name,\n          meta: this.config.meta\n        };\n      }\n\n      if (this.collection.debug) {\n        console.time(`insert ${this.fileData.name}`);\n        console.time(`loadFile ${this.fileData.name}`);\n      }\n\n      if (this.collection._supportWebWorker && this.config.allowWebWorkers) {\n        try {\n          this.worker = new Worker(this.collection._webWorkerUrl);\n        } catch (wwError) {\n          this.worker = false;\n          this.collection._debug('[FilesCollection] [insert] [create WebWorker]: Can\\'t create WebWorker, fallback to MainThread', wwError);\n        }\n      } else {\n        this.worker = null;\n      }\n\n      this.startTime     = {};\n      this.config.debug  = this.collection.debug;\n      this.config._debug = this.collection._debug;\n      this.currentChunk  = 0;\n      this.transferTime  = 0;\n      this.trackerComp   = null;\n      this.sentChunks    = 0;\n      this.fileLength    = 1;\n      this.EOFsent       = false;\n      this.fileId        = this.config.fileId || Random.id();\n      this.FSName        = this.collection.namingFunction ? this.collection.namingFunction(this.fileData) : this.fileId;\n      this.pipes         = [];\n\n      this.fileData = Object.assign(this.fileData, this.collection._getExt(this.fileData.name), {mime: this.collection._getMimeType(this.fileData)});\n      this.fileData['mime-type'] = this.fileData.mime;\n\n      this.result = new FileUpload(Object.assign({}, this.config, {\n        fileData: this.fileData,\n        fileId: this.fileId,\n        _Abort: this.collection._methodNames._Abort\n      }));\n\n      this.beforeunload = (e) => {\n        const message = helpers.isFunction(this.collection.onbeforeunloadMessage) ? this.collection.onbeforeunloadMessage.call(this.result, this.fileData) : this.collection.onbeforeunloadMessage;\n\n        if (e) {\n          e.returnValue = message;\n        }\n        return message;\n      };\n\n      this.result.config.beforeunload = this.beforeunload;\n      window.addEventListener('beforeunload', this.beforeunload, false);\n\n      this.result.config._onEnd = () => this.emit('_onEnd');\n\n      this.addListener('end', this.end);\n      this.addListener('start', this.start);\n      this.addListener('upload', this.upload);\n      this.addListener('sendEOF', this.sendEOF);\n      this.addListener('prepare', this.prepare);\n      this.addListener('sendChunk', this.sendChunk);\n      this.addListener('proceedChunk', this.proceedChunk);\n      this.addListener('createStreams', this.createStreams);\n\n      this.addListener('calculateStats', helpers.throttle(() => {\n        const _t = (this.transferTime / this.sentChunks) / this.config.streams;\n        this.result.estimateTime.set((_t * (this.fileLength - this.sentChunks)));\n        this.result.estimateSpeed.set((this.config.chunkSize / (_t / 1000)));\n\n        const progress = Math.round((this.sentChunks / this.fileLength) * 100);\n        let sentBytes = this.config.chunkSize * this.sentChunks;\n        if (sentBytes > this.fileData.size) {\n          // this case often occurs, when the last chunk\n          // is smaller than chunkSize, so we limit to fileSize\n          sentBytes = this.fileData.size;\n        }\n\n        this.result.progress.set(progress);\n        this.config.onProgress && this.config.onProgress.call(this.result, progress, this.fileData);\n        this.result.emit('progress', progress, this.fileData, { chunksSent: this.sentChunks, chunksLength: this.fileLength, bytesSent: sentBytes });\n      }, 250));\n\n      this.addListener('_onEnd', () => {\n        if (this.result.estimateTimer) {\n          Meteor.clearInterval(this.result.estimateTimer);\n        }\n        if (this.worker) {\n          this.worker.terminate();\n        }\n        if (this.trackerComp) {\n          this.trackerComp.stop();\n        }\n        if (this.beforeunload) {\n          window.removeEventListener('beforeunload', this.beforeunload, false);\n        }\n        if (this.result) {\n          return this.result.progress.set(0);\n        }\n        return void 0;\n      });\n    } else {\n      throw new Meteor.Error(500, '[FilesCollection] [insert] Have you forget to pass a File itself?');\n    }\n  }\n\n  end(error, data) {\n    this.collection._debug('[FilesCollection] [UploadInstance] [end]', this.fileData.name);\n    if (this.collection.debug) {\n      console.timeEnd(`insert ${this.fileData.name}`);\n    }\n\n    this.emit('_onEnd');\n    this.result.emit('uploaded', error, data);\n    this.config.onUploaded && this.config.onUploaded.call(this.result, error, data);\n\n    if (error) {\n      this.collection._debug('[FilesCollection] [insert] [end] Error:', error);\n      this.result.abort();\n      this.result.state.set('aborted');\n      this.result.emit('error', error, this.fileData);\n      this.config.onError && this.config.onError.call(this.result, error, this.fileData);\n    } else {\n      this.result.state.set('completed');\n      this.collection.emit('afterUpload', data);\n    }\n    this.result.emit('end', error, (data || this.fileData));\n    return this.result;\n  }\n\n  sendChunk(evt) {\n    const opts = {\n      fileId: this.fileId,\n      binData: evt.data.bin,\n      chunkId: evt.data.chunkId\n    };\n\n    if (this.config.isBase64) {\n      const pad = opts.binData.length % 4;\n      if (pad) {\n        let p = 0;\n        while (p < pad) {\n          opts.binData += '=';\n          p++;\n        }\n      }\n    }\n\n    this.emit('data', evt.data.bin);\n    if (this.pipes.length) {\n      for (let i = this.pipes.length - 1; i >= 0; i--) {\n        opts.binData = this.pipes[i](opts.binData);\n      }\n    }\n\n    if (this.fileLength === evt.data.chunkId) {\n      if (this.collection.debug) {\n        console.timeEnd(`loadFile ${this.fileData.name}`);\n      }\n      this.emit('readEnd');\n    }\n\n    if (opts.binData) {\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, (error) => {\n          this.transferTime += (+new Date) - this.startTime[opts.chunkId];\n          if (error) {\n            if (this.result.state.get() !== 'aborted') {\n              this.emit('end', error);\n            }\n          } else {\n            ++this.sentChunks;\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n            this.emit('calculateStats');\n          }\n        });\n      } else {\n        HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n          content: opts.binData,\n          headers: {\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileid': opts.fileId,\n            'x-chunkid': opts.chunkId,\n            'content-type': 'text/plain'\n          },\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, (error) => {\n          this.transferTime += +new Date() - this.startTime[opts.chunkId];\n          if (error) {\n            if (`${error}` === 'Error: network' || `${error}` === 'Error: Connection lost') {\n              this.result.pause();\n            } else {\n              if (this.result.state.get() !== 'aborted') {\n                this.emit('end', error);\n              }\n            }\n          } else {\n            ++this.sentChunks;\n            if (this.sentChunks >= this.fileLength) {\n              this.emit('sendEOF');\n            } else if (this.currentChunk < this.fileLength) {\n              this.emit('upload');\n            }\n            this.emit('calculateStats');\n          }\n        });\n      }\n    }\n  }\n\n  sendEOF() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [sendEOF]', this.EOFsent);\n    if (!this.EOFsent) {\n      this.EOFsent = true;\n      const opts = {\n        eof: true,\n        fileId: this.fileId\n      };\n\n      if (this.config.transport === 'ddp') {\n        this.config.ddp.call(this.collection._methodNames._Write, opts, (error, result) => {\n          this.emit('end', error, result);\n        });\n      } else {\n        HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n          content: '',\n          headers: {\n            'x-eof': '1',\n            'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null,\n            'x-fileId': opts.fileId,\n            'content-type': 'text/plain'\n          },\n          beforeSend(xhr) {\n            xhr.withCredentials = true;\n            return true;\n          }\n        }, (error, _result) => {\n          let result;\n          try {\n            result = JSON.parse((helpers.isObject(_result) ? _result.content : void 0) || {});\n          } catch (e) {\n            console.warn('Something went wrong! [sendEOF] method doesn\\'t returned JSON! Looks like you\\'re on Cordova app or behind proxy, switching to DDP transport is recommended.');\n            result = {};\n          }\n\n          if (result.meta) {\n            result.meta = fixJSONParse(result.meta);\n          }\n\n          this.emit('end', error, result);\n        });\n      }\n    }\n  }\n\n  proceedChunk(chunkId) {\n    const chunk = this.config.file.slice((this.config.chunkSize * (chunkId - 1)), (this.config.chunkSize * chunkId));\n\n    if (this.config.isBase64) {\n      this.emit('sendChunk', {\n        data: {\n          bin: chunk,\n          chunkId\n        }\n      });\n    } else {\n      let fileReader;\n      if (window.FileReader) {\n        fileReader = new window.FileReader;\n\n        fileReader.onloadend = (evt) => {\n          this.emit('sendChunk', {\n            data: {\n              bin: ((helpers.isObject(fileReader) ? fileReader.result : void 0) || (evt.srcElement ? evt.srcElement.result : void 0) || (evt.target ? evt.target.result : void 0)).split(',')[1],\n              chunkId\n            }\n          });\n        };\n\n        fileReader.onerror = (e) => {\n          this.emit('end', (e.target || e.srcElement).error);\n        };\n\n        fileReader.readAsDataURL(chunk);\n      } else if (window.FileReaderSync) {\n        fileReader = new window.FileReaderSync;\n\n        this.emit('sendChunk', {\n          data: {\n            bin: fileReader.readAsDataURL(chunk).split(',')[1],\n            chunkId\n          }\n        });\n      } else {\n        this.emit('end', 'File API is not supported in this Browser!');\n      }\n    }\n  }\n\n  upload() {\n    if (this.result.onPause.get()) {\n      return this;\n    }\n\n    if (this.result.state.get() === 'aborted') {\n      return this;\n    }\n\n    if (this.currentChunk <= this.fileLength) {\n      ++this.currentChunk;\n      if (this.worker) {\n        this.worker.postMessage({\n          f: this.config.file,\n          sc: this.sentChunks,\n          cc: this.currentChunk,\n          cs: this.config.chunkSize,\n          ib: this.config.isBase64\n        });\n      } else {\n        this.emit('proceedChunk', this.currentChunk);\n      }\n    } else {\n      this.emit('sendEOF');\n    }\n    this.startTime[this.currentChunk] = +new Date();\n    return this;\n  }\n\n  createStreams() {\n    this.collection._debug('[FilesCollection] [UploadInstance] [createStreams]');\n    let i = 1;\n    while (i <= this.config.streams) {\n      this.emit('upload');\n      i++;\n    }\n  }\n\n  prepare() {\n    let _len;\n\n    this.config.onStart && this.config.onStart.call(this.result, null, this.fileData);\n    this.result.emit('start', null, this.fileData);\n\n    if (this.config.chunkSize === 'dynamic') {\n      this.config.chunkSize = this.fileData.size / 1000;\n      if (this.config.chunkSize < 327680) {\n        this.config.chunkSize = 327680;\n      } else if (this.config.chunkSize > 1048576) {\n        this.config.chunkSize = 1048576;\n      }\n\n      if (this.config.transport === 'http') {\n        this.config.chunkSize = Math.round(this.config.chunkSize / 2);\n      } else if (isSafari) {\n        this.config.chunkSize = Math.ceil(this.config.chunkSize / 8);\n      }\n    }\n\n    if (this.config.isBase64) {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 4) * 4;\n      _len = Math.ceil(this.config.file.length / this.config.chunkSize);\n    } else {\n      this.config.chunkSize = Math.floor(this.config.chunkSize / 8) * 8;\n      _len = Math.ceil(this.fileData.size / this.config.chunkSize);\n    }\n\n    if (this.config.streams === 'dynamic') {\n      this.config.streams = helpers.clone(_len);\n      if (this.config.streams > 24) { this.config.streams = 24; }\n\n      if (this.config.transport === 'http') {\n        this.config.streams = Math.round(this.config.streams / 2);\n      } else if (isSafari) {\n        this.config.streams = 1;\n      }\n    }\n\n    this.fileLength = _len <= 0 ? 1 : _len;\n    if (this.config.streams > this.fileLength) {\n      this.config.streams = this.fileLength;\n    }\n    this.result.config.fileLength = this.fileLength;\n\n    const opts = {\n      file: this.fileData,\n      fileId: this.fileId,\n      chunkSize: this.config.isBase64 ? ((this.config.chunkSize  / 4) * 3) : this.config.chunkSize,\n      fileLength: this.fileLength\n    };\n\n    if (this.FSName !== this.fileId) {\n      opts.FSName = this.FSName;\n    }\n\n    const handleStart = (error) => {\n      if (error) {\n        this.collection._debug('[FilesCollection] [_Start] Error:', error);\n        this.emit('end', error);\n      } else {\n        this.result.continueFunc = () => {\n          this.collection._debug('[FilesCollection] [insert] [continueFunc]');\n          this.emit('createStreams');\n        };\n        this.emit('createStreams');\n      }\n    };\n\n    if (this.config.transport === 'ddp') {\n      this.config.ddp.call(this.collection._methodNames._Start, opts, handleStart);\n    } else {\n      if (helpers.isObject(opts.file) ? opts.file.meta : void 0) {\n        opts.file.meta = fixJSONStringify(opts.file.meta);\n      }\n\n      HTTP.call('POST', `${_rootUrl}${this.collection.downloadRoute}/${this.collection.collectionName}/__upload`, {\n        data: opts,\n        headers: {\n          'x-start': '1',\n          'x-mtok': (helpers.isObject(Meteor.connection) ? Meteor.connection._lastSessionId : void 0) || null\n        },\n        beforeSend(xhr) {\n          xhr.withCredentials = true;\n          return true;\n        }\n      }, handleStart);\n    }\n  }\n\n  pipe(func) {\n    this.pipes.push(func);\n    return this;\n  }\n\n  start() {\n    let isUploadAllowed;\n    if (this.fileData.size <= 0) {\n      this.end(new Meteor.Error(400, 'Can\\'t upload empty file'));\n      return this.result;\n    }\n\n    if (this.config.onBeforeUpload && helpers.isFunction(this.config.onBeforeUpload)) {\n      isUploadAllowed = this.config.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'config.onBeforeUpload() returned false'));\n      }\n    }\n\n    if (this.collection.onBeforeUpload && helpers.isFunction(this.collection.onBeforeUpload)) {\n      isUploadAllowed = this.collection.onBeforeUpload.call(Object.assign({}, this.result, this.collection._getUser()), this.fileData);\n      if (isUploadAllowed !== true) {\n        return this.end(new Meteor.Error(403, helpers.isString(isUploadAllowed) ? isUploadAllowed : 'collection.onBeforeUpload() returned false'));\n      }\n    }\n\n    Tracker.autorun((computation) => {\n      this.trackerComp = computation;\n      if (!this.result.onPause.curValue && !Meteor.status().connected) {\n        this.collection._debug('[FilesCollection] [insert] [Tracker] [pause]');\n        this.result.pause();\n      }\n    });\n\n    if (this.worker) {\n      this.collection._debug('[FilesCollection] [insert] using WebWorkers');\n      this.worker.onmessage = (evt) => {\n        if (evt.data.error) {\n          this.collection._debug('[FilesCollection] [insert] [worker] [onmessage] [ERROR:]', evt.data.error);\n          this.emit('proceedChunk', evt.data.chunkId);\n        } else {\n          this.emit('sendChunk', evt);\n        }\n      };\n\n      this.worker.onerror = (e) => {\n        this.collection._debug('[FilesCollection] [insert] [worker] [onerror] [ERROR:]', e);\n        this.emit('end', e.message);\n      };\n    } else {\n      this.collection._debug('[FilesCollection] [insert] using MainThread');\n    }\n\n    this.emit('prepare');\n    return this.result;\n  }\n\n  manual() {\n    this.result.start = () => {\n      this.emit('start');\n    };\n\n    const self = this;\n    this.result.pipe = function (func) {\n      self.pipe(func);\n      return this;\n    };\n    return this.result;\n  }\n}\n"]}}]