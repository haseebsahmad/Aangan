{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\client.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:files/client.js","filename":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\client.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main","root":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\client.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:files/client.js"}},"code":"module.export({\n  FilesCollection: () => FilesCollection\n});\nlet Mongo;\nmodule.link(\"meteor/mongo\", {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet DDP;\nmodule.link(\"meteor/ddp-client\", {\n  DDP(v) {\n    DDP = v;\n  }\n\n}, 2);\nlet Cookies;\nmodule.link(\"meteor/ostrio:cookies\", {\n  Cookies(v) {\n    Cookies = v;\n  }\n\n}, 3);\nlet check, Match;\nmodule.link(\"meteor/check\", {\n  check(v) {\n    check = v;\n  },\n\n  Match(v) {\n    Match = v;\n  }\n\n}, 4);\nlet UploadInstance;\nmodule.link(\"./upload.js\", {\n  UploadInstance(v) {\n    UploadInstance = v;\n  }\n\n}, 5);\nlet FilesCollectionCore;\nmodule.link(\"./core.js\", {\n  default(v) {\n    FilesCollectionCore = v;\n  }\n\n}, 6);\nlet formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL(v) {\n    formatFleURL = v;\n  },\n\n  helpers(v) {\n    helpers = v;\n  }\n\n}, 7);\n\nconst NOOP = () => {};\n\nconst allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\n\nclass FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n\n    if (config) {\n      Object.keys(config).forEach(param => {\n        if (allowedParams.includes(param)) {\n          this[param] = config[param];\n        }\n      });\n    }\n\n    const self = this;\n    const cookie = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies\n    });\n\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, \"[FilesCollection.\".concat(this.collectionName, \"]: \\\"downloadRoute\\\" must be precisely provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal or be inside of your web/proxy-server (relative) root.\"));\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, {\n          path: '/',\n          sameSite: 'Lax'\n        });\n\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect(conn => {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {\n          type: 'application/javascript'\n        }));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n    this._methodNames = {\n      _Abort: \"_FilesCollectionAbort_\".concat(this.collectionName),\n      _Write: \"_FilesCollectionWrite_\".concat(this.collectionName),\n      _Start: \"_FilesCollectionStart_\".concat(this.collectionName),\n      _Remove: \"_FilesCollectionRemove_\".concat(this.collectionName)\n    };\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n\n\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n\n    if (helpers.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n\n    return mime;\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n\n\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n\n      userId: null\n    };\n\n    if (helpers.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n\n\n  insert(config) {\n    let autoStart = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n\n    return new UploadInstance(config, this)[autoStart ? 'start' : 'manual']();\n  }\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n\n\n  remove() {\n    let selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let callback = arguments.length > 1 ? arguments[1] : undefined;\n\n    this._debug(\"[FilesCollection] [remove(\".concat(JSON.stringify(selector), \")]\"));\n\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, callback || NOOP);\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', function (fileRef) {\n      let _version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n\n      let _URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      const version = !helpers.isString(_version) ? 'original' : _version;\n      const URIBase = !helpers.isString(_URIBase) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});","map":{"version":3,"sources":["packages/ostrio:files/client.js"],"names":["module","export","FilesCollection","Mongo","link","v","Meteor","DDP","Cookies","check","Match","UploadInstance","FilesCollectionCore","default","formatFleURL","helpers","NOOP","allowedParams","constructor","config","Object","keys","forEach","param","includes","self","cookie","allowQueryStringCookies","isBoolean","debug","public","chunkSize","Math","floor","isString","collectionName","collection","Collection","_name","filesCollection","String","downloadRoute","Error","disableUpload","replace","isFunction","namingFunction","onBeforeUpload","allowClientCode","ddp","onbeforeunloadMessage","setTokenCookie","connection","_lastSessionId","set","path","sameSite","isCordova","send","Accounts","onReconnect","conn","startup","onLogin","OneOf","Function","_URL","window","URL","webkitURL","mozURL","msURL","oURL","Worker","Blob","createObjectURL","_supportWebWorker","_webWorkerUrl","type","absoluteUrl","e","_debug","schema","Boolean","Number","Any","_methodNames","_Abort","_Write","_Start","_Remove","_getMimeType","fileData","mime","isObject","_getUser","result","user","userId","insert","autoStart","console","warn","remove","selector","callback","JSON","stringify","Optional","call","Template","registerHelper","fileRef","_version","_URIBase","version","URIBase"],"mappings":"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","sourcesContent":["import { Mongo }           from 'meteor/mongo';\nimport { Meteor }          from 'meteor/meteor';\nimport { DDP }             from 'meteor/ddp-client';\nimport { Cookies }         from 'meteor/ostrio:cookies';\nimport { check, Match }    from 'meteor/check';\nimport { UploadInstance }  from './upload.js';\nimport FilesCollectionCore from './core.js';\nimport { formatFleURL, helpers } from './lib.js';\n\nconst NOOP = () => { };\nconst allowedParams = ['debug', 'ddp', 'schema', 'public', 'chunkSize', 'downloadRoute', 'collection', 'collectionName', 'namingFunction', 'onBeforeUpload', 'allowClientCode', 'onbeforeunloadMessage', 'disableUpload', 'allowQueryStringCookies'];\n\n/*\n * @locus Anywhere\n * @class FilesCollection\n * @param config           {Object}   - [Both]   Configuration object with next properties:\n * @param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n * @param config.ddp       {Object}   - [Client] Custom DDP connection. Object returned form `DDP.connect()`\n * @param config.schema    {Object}   - [Both]   Collection Schema\n * @param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs`\n * @param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n * @param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n * @param config.collection     {Mongo.Collection} - [Both] Mongo Collection Instance\n * @param config.collectionName {String}  - [Both]   Collection name\n * @param config.namingFunction {Function}- [Both]   Function which returns `String`\n * @param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\n * return `true` to continue\n * return `false` or `String` to abort upload\n * @param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n * @param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n * @param config.disableUpload {Boolean} - Disable file upload, useful for server only solutions\n * @param config.allowQueryStringCookies {Boolean} - Allow passing Cookies in a query string (in URL). Primary should be used only in Cordova environment. Note: this option will be used only on Cordova. Default: `false`\n * @summary Create new instance of FilesCollection\n */\nexport class FilesCollection extends FilesCollectionCore {\n  constructor(config) {\n    super();\n    if (config) {\n      Object.keys(config).forEach((param) => {\n        if (allowedParams.includes(param)) {\n          this[param] = config[param];\n        }\n      });\n    }\n\n    const self = this;\n    const cookie = new Cookies({\n      allowQueryStringCookies: this.allowQueryStringCookies\n    });\n    if (!helpers.isBoolean(this.debug)) {\n      this.debug = false;\n    }\n\n    if (!helpers.isBoolean(this.public)) {\n      this.public = false;\n    }\n\n    if (!this.chunkSize) {\n      this.chunkSize = 1024 * 512;\n    }\n    this.chunkSize = Math.floor(this.chunkSize / 8) * 8;\n\n    if (!helpers.isString(this.collectionName) && !this.collection) {\n      this.collectionName = 'MeteorUploadFiles';\n    }\n\n    if (!this.collection) {\n      this.collection = new Mongo.Collection(this.collectionName);\n    } else {\n      this.collectionName = this.collection._name;\n    }\n\n    this.collection.filesCollection = this;\n    check(this.collectionName, String);\n\n    if (this.public && !this.downloadRoute) {\n      throw new Meteor.Error(500, `[FilesCollection.${this.collectionName}]: \"downloadRoute\" must be precisely provided on \"public\" collections! Note: \"downloadRoute\" must be equal or be inside of your web/proxy-server (relative) root.`);\n    }\n\n    if (!helpers.isBoolean(this.disableUpload)) {\n      this.disableUpload = false;\n    }\n\n    if (!helpers.isString(this.downloadRoute)) {\n      this.downloadRoute = '/cdn/storage';\n    }\n\n    this.downloadRoute = this.downloadRoute.replace(/\\/$/, '');\n\n    if (!helpers.isFunction(this.namingFunction)) {\n      this.namingFunction = false;\n    }\n\n    if (!helpers.isFunction(this.onBeforeUpload)) {\n      this.onBeforeUpload = false;\n    }\n\n    if (!helpers.isBoolean(this.allowClientCode)) {\n      this.allowClientCode = true;\n    }\n\n    if (!this.ddp) {\n      this.ddp = Meteor;\n    }\n\n    if (!this.onbeforeunloadMessage) {\n      this.onbeforeunloadMessage = 'Upload in a progress... Do you want to abort?';\n    }\n\n    const setTokenCookie = () => {\n      if (Meteor.connection._lastSessionId) {\n        cookie.set('x_mtok', Meteor.connection._lastSessionId, { path: '/', sameSite: 'Lax' });\n        if (Meteor.isCordova && this.allowQueryStringCookies) {\n          cookie.send();\n        }\n      }\n    };\n\n    if (typeof Accounts !== 'undefined' && Accounts !== null) {\n      DDP.onReconnect((conn) => {\n        conn.onReconnect = setTokenCookie;\n      });\n      Meteor.startup(setTokenCookie);\n      Accounts.onLogin(setTokenCookie);\n    }\n\n    check(this.onbeforeunloadMessage, Match.OneOf(String, Function));\n\n    try {\n      const _URL = window.URL || window.webkitURL || window.mozURL || window.msURL || window.oURL || false;\n      if (window.Worker && window.Blob && _URL && helpers.isFunction(_URL.createObjectURL)) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = _URL.createObjectURL(new window.Blob(['!function(a){\"use strict\";a.onmessage=function(b){var c=b.data.f.slice(b.data.cs*(b.data.cc-1),b.data.cs*b.data.cc);if(b.data.ib===!0)postMessage({bin:c,chunkId:b.data.cc});else{var d;a.FileReader?(d=new FileReader,d.onloadend=function(a){postMessage({bin:(d.result||a.srcElement||a.target).split(\",\")[1],chunkId:b.data.cc,s:b.data.s})},d.onerror=function(a){throw(a.target||a.srcElement).error},d.readAsDataURL(c)):a.FileReaderSync?(d=new FileReaderSync,postMessage({bin:d.readAsDataURL(c).split(\",\")[1],chunkId:b.data.cc})):postMessage({bin:null,chunkId:b.data.cc,error:\"File API is not supported in WebWorker!\"})}}}(this);'], {type: 'application/javascript'}));\n      } else if (window.Worker) {\n        this._supportWebWorker = true;\n        this._webWorkerUrl     = Meteor.absoluteUrl('packages/ostrio_files/worker.min.js');\n      } else {\n        this._supportWebWorker = false;\n      }\n    } catch (e) {\n      self._debug('[FilesCollection] [Check WebWorker Availability] Error:', e);\n      this._supportWebWorker = false;\n    }\n\n    if (!this.schema) {\n      this.schema = FilesCollectionCore.schema;\n    }\n\n    check(this.debug, Boolean);\n    check(this.schema, Object);\n    check(this.public, Boolean);\n    check(this.chunkSize, Number);\n    check(this.downloadRoute, String);\n    check(this.disableUpload, Boolean);\n    check(this.namingFunction, Match.OneOf(false, Function));\n    check(this.onBeforeUpload, Match.OneOf(false, Function));\n    check(this.allowClientCode, Boolean);\n    check(this.ddp, Match.Any);\n\n    this._methodNames = {\n      _Abort: `_FilesCollectionAbort_${this.collectionName}`,\n      _Write: `_FilesCollectionWrite_${this.collectionName}`,\n      _Start: `_FilesCollectionStart_${this.collectionName}`,\n      _Remove: `_FilesCollectionRemove_${this.collectionName}`\n    };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getMimeType\n   * @param {Object} fileData - File Object\n   * @summary Returns file's mime-type\n   * @returns {String}\n   */\n  _getMimeType(fileData) {\n    let mime;\n    check(fileData, Object);\n    if (helpers.isObject(fileData)) {\n      mime = fileData.type;\n    }\n\n    if (!mime || !helpers.isString(mime)) {\n      mime = 'application/octet-stream';\n    }\n    return mime;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name _getUser\n   * @summary Returns object with `userId` and `user()` method which return user's object\n   * @returns {Object}\n   */\n  _getUser() {\n    const result = {\n      user() {\n        return null;\n      },\n      userId: null\n    };\n\n    if (helpers.isFunction(Meteor.userId)) {\n      result.user = () => Meteor.user();\n      result.userId = Meteor.userId();\n    }\n\n    return result;\n  }\n\n  /*\n   * @locus Client\n   * @memberOf FilesCollection\n   * @name insert\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n   * @param {Object} config - Configuration object with next properties:\n   *   {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n   *   {String}      fileId         - Optionnal `fileId` used at insert\n   *   {Object}      meta           - Additional data as object, use later for search\n   *   {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n   *   {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n   *   {Number|dynamic} chunkSize   - Chunk size for upload\n   *   {String}      transport      - Upload transport `http` or `ddp`\n   *   {Object}      ddp            - Custom DDP connection. Object returned form `DDP.connect()`\n   *   {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n   *   {Function}    onStart        - Callback triggered when upload is started after all successful validations, with two arguments `error` (always null) and `fileRef`\n   *   {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n   *   {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n   *   {Function}    onBeforeUpload - Callback triggered right before upload is started:\n   *       return true to continue\n   *       return false to abort upload\n   * @param {Boolean} autoStart     - Start upload immediately. If set to false, you need manually call .start() method on returned class. Useful to set EventListeners.\n   * @summary Upload file to server over DDP or HTTP\n   * @returns {UploadInstance} Instance. UploadInstance has next properties:\n   *   {ReactiveVar} onPause  - Is upload process on the pause?\n   *   {ReactiveVar} state    - active|paused|aborted|completed\n   *   {ReactiveVar} progress - Current progress in percentage\n   *   {Function}    pause    - Pause upload process\n   *   {Function}    continue - Continue paused upload process\n   *   {Function}    toggle   - Toggle continue/pause if upload process\n   *   {Function}    abort    - Abort upload\n   *   {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n   */\n  insert(config, autoStart = true) {\n    if (this.disableUpload) {\n      console.warn('[FilesCollection] [insert()] Upload is disabled with [disableUpload]!');\n      return {};\n    }\n    return (new UploadInstance(config, this))[autoStart ? 'start' : 'manual']();\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollection\n   * @name remove\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Function} callback - Callback with one `error` argument\n   * @summary Remove documents from the collection\n   * @returns {FilesCollection} Instance\n   */\n  remove(selector = {}, callback) {\n    this._debug(`[FilesCollection] [remove(${JSON.stringify(selector)})]`);\n    check(selector, Match.OneOf(Object, String));\n    check(callback, Match.Optional(Function));\n\n    if (this.allowClientCode) {\n      this.ddp.call(this._methodNames._Remove, selector, (callback || NOOP));\n    } else {\n      callback && callback(new Meteor.Error(401, '[FilesCollection] [remove] Run code from client is not allowed!'));\n      this._debug('[FilesCollection] [remove] Run code from client is not allowed!');\n    }\n\n    return this;\n  }\n}\n\n/*\n * @locus Client\n * @TemplateHelper\n * @name fileURL\n * @param {Object} fileRef - File reference object\n * @param {String} version - [Optional] Version of file you would like to request\n * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n * @summary Get download URL for file by fileRef, even without subscription\n * @example {{fileURL fileRef}}\n * @returns {String}\n */\nMeteor.startup(() => {\n  if (typeof Template !== 'undefined' && Template !== null) {\n    Template.registerHelper('fileURL', (fileRef, _version = 'original', _URIBase) => {\n      if (!helpers.isObject(fileRef)) {\n        return '';\n      }\n\n      const version = (!helpers.isString(_version)) ? 'original' : _version;\n      const URIBase = (!helpers.isString(_URIBase)) ? void 0 : _URIBase;\n      return formatFleURL(fileRef, version, URIBase);\n    });\n  }\n});\n"]},"sourceType":"module","hash":"6e5d32f35ad932c3c2ab765b5d6db364b03345c7"}
