{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\core.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","objectRestSpread"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.cordova"},"sourceFileName":"packages/ostrio:files/core.js","filename":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\core.js","targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main","root":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":true,"enforceStrictMode":false,"dynamicImport":true}},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.13.10","helpers":true,"useESModules":false,"corejs":false}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$3","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$4","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-chaining","visitor":{"_exploded":{},"_verified":{},"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]}},"options":{}},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{}},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"StaticBlock":{"enter":[null]},"TSModuleBlock":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectPattern":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"ObjectMethod":{"enter":[null],"exit":[null]},"ClassMethod":{"enter":[null],"exit":[null]},"ClassPrivateMethod":{"enter":[null],"exit":[null]},"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Users\\Haseeb\\Desktop\\Aangan-main\\Aangan-main\\packages\\ostrio:files\\core.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:files/core.js"}},"code":"var _inheritsLoose;\n\nmodule.link(\"@babel/runtime/helpers/inheritsLoose\", {\n  default: function (v) {\n    _inheritsLoose = v;\n  }\n}, 0);\nmodule.export({\n  \"default\": function () {\n    return FilesCollectionCore;\n  }\n});\nvar EventEmitter;\nmodule.link(\"eventemitter3\", {\n  EventEmitter: function (v) {\n    EventEmitter = v;\n  }\n}, 0);\nvar check, Match;\nmodule.link(\"meteor/check\", {\n  check: function (v) {\n    check = v;\n  },\n  Match: function (v) {\n    Match = v;\n  }\n}, 1);\nvar formatFleURL, helpers;\nmodule.link(\"./lib.js\", {\n  formatFleURL: function (v) {\n    formatFleURL = v;\n  },\n  helpers: function (v) {\n    helpers = v;\n  }\n}, 2);\nvar FilesCursor, FileCursor;\nmodule.link(\"./cursor.js\", {\n  FilesCursor: function (v) {\n    FilesCursor = v;\n  },\n  FileCursor: function (v) {\n    FileCursor = v;\n  }\n}, 3);\n\nvar FilesCollectionCore = /*#__PURE__*/function (_EventEmitter) {\n  _inheritsLoose(FilesCollectionCore, _EventEmitter);\n\n  function FilesCollectionCore() {\n    return _EventEmitter.call(this) || this;\n  }\n\n  var _proto = FilesCollectionCore.prototype;\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _proto._debug = function () {\n    function _debug() {\n      if (this.debug) {\n        (console.info || console.log || function () {}).apply(void 0, arguments);\n      }\n    }\n\n    return _debug;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  ;\n\n  _proto._getFileName = function () {\n    function _getFileName(fileData) {\n      var fileName = fileData.name || fileData.fileName;\n\n      if (helpers.isString(fileName) && fileName.length > 0) {\n        return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n      }\n\n      return '';\n    }\n\n    return _getFileName;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  ;\n\n  _proto._getExt = function () {\n    function _getExt(fileName) {\n      if (fileName.includes('.')) {\n        var extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n        return {\n          ext: extension,\n          extension: extension,\n          extensionWithDot: \".\" + extension\n        };\n      }\n\n      return {\n        ext: '',\n        extension: '',\n        extensionWithDot: ''\n      };\n    }\n\n    return _getExt;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  ;\n\n  _proto._updateFileTypes = function () {\n    function _updateFileTypes(data) {\n      data.isVideo = /^video\\//i.test(data.type);\n      data.isAudio = /^audio\\//i.test(data.type);\n      data.isImage = /^image\\//i.test(data.type);\n      data.isText = /^text\\//i.test(data.type);\n      data.isJSON = /^application\\/json$/i.test(data.type);\n      data.isPDF = /^application\\/(x-)?pdf$/i.test(data.type);\n    }\n\n    return _updateFileTypes;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  ;\n\n  _proto._dataToSchema = function () {\n    function _dataToSchema(data) {\n      var ds = {\n        name: data.name,\n        extension: data.extension,\n        ext: data.extension,\n        extensionWithDot: '.' + data.extension,\n        path: data.path,\n        meta: data.meta,\n        type: data.type,\n        mime: data.type,\n        'mime-type': data.type,\n        size: data.size,\n        userId: data.userId || null,\n        versions: {\n          original: {\n            path: data.path,\n            size: data.size,\n            type: data.type,\n            extension: data.extension\n          }\n        },\n        _downloadRoute: data._downloadRoute || this.downloadRoute,\n        _collectionName: data._collectionName || this.collectionName\n      }; //Optional fileId\n\n      if (data.fileId) {\n        ds._id = data.fileId;\n      }\n\n      this._updateFileTypes(ds);\n\n      ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n      return ds;\n    }\n\n    return _dataToSchema;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n  ;\n\n  _proto.findOne = function () {\n    function findOne() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._debug(\"[FilesCollection] [findOne(\" + JSON.stringify(selector) + \", \" + JSON.stringify(options) + \")]\");\n\n      check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n      check(options, Match.Optional(Object));\n      var doc = this.collection.findOne(selector, options);\n\n      if (doc) {\n        return new FileCursor(doc, this);\n      }\n\n      return doc;\n    }\n\n    return findOne;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  ;\n\n  _proto.find = function () {\n    function find() {\n      var selector = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 ? arguments[1] : undefined;\n\n      this._debug(\"[FilesCollection] [find(\" + JSON.stringify(selector) + \", \" + JSON.stringify(options) + \")]\");\n\n      check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n      check(options, Match.Optional(Object));\n      return new FilesCursor(selector, options, this);\n    }\n\n    return find;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n  ;\n\n  _proto.update = function () {\n    function update() {\n      this.collection.update.apply(this.collection, arguments);\n      return this.collection;\n    }\n\n    return update;\n  }()\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  ;\n\n  _proto.link = function () {\n    function link(fileRef) {\n      var version = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'original';\n      var URIBase = arguments.length > 2 ? arguments[2] : undefined;\n\n      this._debug(\"[FilesCollection] [link(\" + (helpers.isObject(fileRef) ? fileRef._id : void 0) + \", \" + version + \")]\");\n\n      check(fileRef, Object);\n\n      if (!fileRef) {\n        return '';\n      }\n\n      return formatFleURL(fileRef, version, URIBase);\n    }\n\n    return link;\n  }();\n\n  return FilesCollectionCore;\n}(EventEmitter);\n\nFilesCollectionCore.__helpers = helpers;\nFilesCollectionCore.schema = {\n  _id: {\n    type: String\n  },\n  size: {\n    type: Number\n  },\n  name: {\n    type: String\n  },\n  type: {\n    type: String\n  },\n  path: {\n    type: String\n  },\n  isVideo: {\n    type: Boolean\n  },\n  isAudio: {\n    type: Boolean\n  },\n  isImage: {\n    type: Boolean\n  },\n  isText: {\n    type: Boolean\n  },\n  isJSON: {\n    type: Boolean\n  },\n  isPDF: {\n    type: Boolean\n  },\n  extension: {\n    type: String,\n    optional: true\n  },\n  ext: {\n    type: String,\n    optional: true\n  },\n  extensionWithDot: {\n    type: String,\n    optional: true\n  },\n  mime: {\n    type: String,\n    optional: true\n  },\n  'mime-type': {\n    type: String,\n    optional: true\n  },\n  _storagePath: {\n    type: String\n  },\n  _downloadRoute: {\n    type: String\n  },\n  _collectionName: {\n    type: String\n  },\n  \"public\": {\n    type: Boolean,\n    optional: true\n  },\n  meta: {\n    type: Object,\n    blackbox: true,\n    optional: true\n  },\n  userId: {\n    type: String,\n    optional: true\n  },\n  updatedAt: {\n    type: Date,\n    optional: true\n  },\n  versions: {\n    type: Object,\n    blackbox: true\n  }\n};","map":{"version":3,"sources":["packages/ostrio:files/core.js"],"names":["_inheritsLoose","module","link","default","v","export","FilesCollectionCore","EventEmitter","check","Match","formatFleURL","helpers","FilesCursor","FileCursor","_debug","debug","console","info","log","apply","arguments","_getFileName","fileData","fileName","name","isString","length","replace","_getExt","includes","extension","split","pop","toLowerCase","ext","extensionWithDot","_updateFileTypes","data","isVideo","test","type","isAudio","isImage","isText","isJSON","isPDF","_dataToSchema","ds","path","meta","mime","size","userId","versions","original","_downloadRoute","downloadRoute","_collectionName","collectionName","fileId","_id","_storagePath","storagePath","Object","assign","findOne","selector","options","JSON","stringify","Optional","OneOf","String","Boolean","Number","doc","collection","find","update","fileRef","version","URIBase","isObject","__helpers","schema","optional","blackbox","updatedAt","Date"],"mappings":"AAAA,IAAIA,cAAJ;;AAAmBC,MAAM,CAACC,IAAP,CAAY,sCAAZ,EAAmD;AAACC,EAAAA,OAAO,EAAC,UAASC,CAAT,EAAW;AAACJ,IAAAA,cAAc,GAACI,CAAf;AAAiB;AAAtC,CAAnD,EAA2F,CAA3F;AAAnBH,MAAM,CAACI,MAAP,CAAc;AAAC,aAAQ,YAAU;AAAC,WAAOC,mBAAP;AAA2B;AAA/C,CAAd;AAAgE,IAAIC,YAAJ;AAAiBN,MAAM,CAACC,IAAP,CAAY,eAAZ,EAA4B;AAACK,EAAAA,YAAY,EAAC,UAASH,CAAT,EAAW;AAACG,IAAAA,YAAY,GAACH,CAAb;AAAe;AAAzC,CAA5B,EAAuE,CAAvE;AAA0E,IAAII,KAAJ,EAAUC,KAAV;AAAgBR,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACM,EAAAA,KAAK,EAAC,UAASJ,CAAT,EAAW;AAACI,IAAAA,KAAK,GAACJ,CAAN;AAAQ,GAA3B;AAA4BK,EAAAA,KAAK,EAAC,UAASL,CAAT,EAAW;AAACK,IAAAA,KAAK,GAACL,CAAN;AAAQ;AAAtD,CAA3B,EAAmF,CAAnF;AAAsF,IAAIM,YAAJ,EAAiBC,OAAjB;AAAyBV,MAAM,CAACC,IAAP,CAAY,UAAZ,EAAuB;AAACQ,EAAAA,YAAY,EAAC,UAASN,CAAT,EAAW;AAACM,IAAAA,YAAY,GAACN,CAAb;AAAe,GAAzC;AAA0CO,EAAAA,OAAO,EAAC,UAASP,CAAT,EAAW;AAACO,IAAAA,OAAO,GAACP,CAAR;AAAU;AAAxE,CAAvB,EAAiG,CAAjG;AAAoG,IAAIQ,WAAJ,EAAgBC,UAAhB;AAA2BZ,MAAM,CAACC,IAAP,CAAY,aAAZ,EAA0B;AAACU,EAAAA,WAAW,EAAC,UAASR,CAAT,EAAW;AAACQ,IAAAA,WAAW,GAACR,CAAZ;AAAc,GAAvC;AAAwCS,EAAAA,UAAU,EAAC,UAAST,CAAT,EAAW;AAACS,IAAAA,UAAU,GAACT,CAAX;AAAa;AAA5E,CAA1B,EAAwG,CAAxG;;IAKpYE,mB;;;AACnB,iCAAc;AAAA,WACZ,wBADY;AAEb;;;;AA0FD;AACF;AACA;AACA;AACA;AACA;AACA;SACEQ,M;AAAA,sBAAS;AACP,UAAI,KAAKC,KAAT,EAAgB;AACd,SAACC,OAAO,CAACC,IAAR,IAAgBD,OAAO,CAACE,GAAxB,IAA+B,YAAY,CAAG,CAA/C,EAAiDC,KAAjD,CAAuD,KAAK,CAA5D,EAA+DC,SAA/D;AACD;AACF;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEC,Y;AAAA,0BAAaC,QAAb,EAAuB;AACrB,UAAMC,QAAQ,GAAGD,QAAQ,CAACE,IAAT,IAAiBF,QAAQ,CAACC,QAA3C;;AACA,UAAIZ,OAAO,CAACc,QAAR,CAAiBF,QAAjB,KAA+BA,QAAQ,CAACG,MAAT,GAAkB,CAArD,EAAyD;AACvD,eAAO,CAACJ,QAAQ,CAACE,IAAT,IAAiBF,QAAQ,CAACC,QAA3B,EAAqCI,OAArC,CAA6C,QAA7C,EAAuD,EAAvD,EAA2DA,OAA3D,CAAmE,SAAnE,EAA8E,GAA9E,EAAmFA,OAAnF,CAA2F,KAA3F,EAAkG,EAAlG,CAAP;AACD;;AACD,aAAO,EAAP;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEC,O;AAAA,qBAAQL,QAAR,EAAkB;AAChB,UAAIA,QAAQ,CAACM,QAAT,CAAkB,GAAlB,CAAJ,EAA4B;AAC1B,YAAMC,SAAS,GAAG,CAACP,QAAQ,CAACQ,KAAT,CAAe,GAAf,EAAoBC,GAApB,GAA0BD,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,KAA2C,EAA5C,EAAgDE,WAAhD,EAAlB;AACA,eAAO;AAAEC,UAAAA,GAAG,EAAEJ,SAAP;AAAkBA,UAAAA,SAAS,EAATA,SAAlB;AAA6BK,UAAAA,gBAAgB,QAAML;AAAnD,SAAP;AACD;;AACD,aAAO;AAAEI,QAAAA,GAAG,EAAE,EAAP;AAAWJ,QAAAA,SAAS,EAAE,EAAtB;AAA0BK,QAAAA,gBAAgB,EAAE;AAA5C,OAAP;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;;;SACEC,gB;AAAA,8BAAiBC,IAAjB,EAAuB;AACrBA,MAAAA,IAAI,CAACC,OAAL,GAAgB,YAAYC,IAAZ,CAAiBF,IAAI,CAACG,IAAtB,CAAhB;AACAH,MAAAA,IAAI,CAACI,OAAL,GAAgB,YAAYF,IAAZ,CAAiBF,IAAI,CAACG,IAAtB,CAAhB;AACAH,MAAAA,IAAI,CAACK,OAAL,GAAgB,YAAYH,IAAZ,CAAiBF,IAAI,CAACG,IAAtB,CAAhB;AACAH,MAAAA,IAAI,CAACM,MAAL,GAAgB,WAAWJ,IAAX,CAAgBF,IAAI,CAACG,IAArB,CAAhB;AACAH,MAAAA,IAAI,CAACO,MAAL,GAAgB,uBAAuBL,IAAvB,CAA4BF,IAAI,CAACG,IAAjC,CAAhB;AACAH,MAAAA,IAAI,CAACQ,KAAL,GAAgB,2BAA2BN,IAA3B,CAAgCF,IAAI,CAACG,IAArC,CAAhB;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEM,a;AAAA,2BAAcT,IAAd,EAAoB;AAClB,UAAMU,EAAE,GAAG;AACTvB,QAAAA,IAAI,EAAEa,IAAI,CAACb,IADF;AAETM,QAAAA,SAAS,EAAEO,IAAI,CAACP,SAFP;AAGTI,QAAAA,GAAG,EAAEG,IAAI,CAACP,SAHD;AAITK,QAAAA,gBAAgB,EAAE,MAAME,IAAI,CAACP,SAJpB;AAKTkB,QAAAA,IAAI,EAAEX,IAAI,CAACW,IALF;AAMTC,QAAAA,IAAI,EAAEZ,IAAI,CAACY,IANF;AAOTT,QAAAA,IAAI,EAAEH,IAAI,CAACG,IAPF;AAQTU,QAAAA,IAAI,EAAEb,IAAI,CAACG,IARF;AAST,qBAAaH,IAAI,CAACG,IATT;AAUTW,QAAAA,IAAI,EAAEd,IAAI,CAACc,IAVF;AAWTC,QAAAA,MAAM,EAAEf,IAAI,CAACe,MAAL,IAAe,IAXd;AAYTC,QAAAA,QAAQ,EAAE;AACRC,UAAAA,QAAQ,EAAE;AACRN,YAAAA,IAAI,EAAEX,IAAI,CAACW,IADH;AAERG,YAAAA,IAAI,EAAEd,IAAI,CAACc,IAFH;AAGRX,YAAAA,IAAI,EAAEH,IAAI,CAACG,IAHH;AAIRV,YAAAA,SAAS,EAAEO,IAAI,CAACP;AAJR;AADF,SAZD;AAoBTyB,QAAAA,cAAc,EAAElB,IAAI,CAACkB,cAAL,IAAuB,KAAKC,aApBnC;AAqBTC,QAAAA,eAAe,EAAEpB,IAAI,CAACoB,eAAL,IAAwB,KAAKC;AArBrC,OAAX,CADkB,CAyBlB;;AACA,UAAIrB,IAAI,CAACsB,MAAT,EAAiB;AACfZ,QAAAA,EAAE,CAACa,GAAH,GAASvB,IAAI,CAACsB,MAAd;AACD;;AAED,WAAKvB,gBAAL,CAAsBW,EAAtB;;AACAA,MAAAA,EAAE,CAACc,YAAH,GAAkBxB,IAAI,CAACwB,YAAL,IAAqB,KAAKC,WAAL,CAAiBC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB3B,IAAlB,EAAwBU,EAAxB,CAAjB,CAAvC;AACA,aAAOA,EAAP;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEkB,O;AAAA,uBAAgC;AAAA,UAAxBC,QAAwB,uEAAb,EAAa;AAAA,UAATC,OAAS;;AAC9B,WAAKrD,MAAL,iCAA0CsD,IAAI,CAACC,SAAL,CAAeH,QAAf,CAA1C,UAAuEE,IAAI,CAACC,SAAL,CAAeF,OAAf,CAAvE;;AACA3D,MAAAA,KAAK,CAAC0D,QAAD,EAAWzD,KAAK,CAAC6D,QAAN,CAAe7D,KAAK,CAAC8D,KAAN,CAAYR,MAAZ,EAAoBS,MAApB,EAA4BC,OAA5B,EAAqCC,MAArC,EAA6C,IAA7C,CAAf,CAAX,CAAL;AACAlE,MAAAA,KAAK,CAAC2D,OAAD,EAAU1D,KAAK,CAAC6D,QAAN,CAAeP,MAAf,CAAV,CAAL;AAEA,UAAMY,GAAG,GAAG,KAAKC,UAAL,CAAgBX,OAAhB,CAAwBC,QAAxB,EAAkCC,OAAlC,CAAZ;;AACA,UAAIQ,GAAJ,EAAS;AACP,eAAO,IAAI9D,UAAJ,CAAe8D,GAAf,EAAoB,IAApB,CAAP;AACD;;AACD,aAAOA,GAAP;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEE,I;AAAA,oBAA6B;AAAA,UAAxBX,QAAwB,uEAAb,EAAa;AAAA,UAATC,OAAS;;AAC3B,WAAKrD,MAAL,8BAAuCsD,IAAI,CAACC,SAAL,CAAeH,QAAf,CAAvC,UAAoEE,IAAI,CAACC,SAAL,CAAeF,OAAf,CAApE;;AACA3D,MAAAA,KAAK,CAAC0D,QAAD,EAAWzD,KAAK,CAAC6D,QAAN,CAAe7D,KAAK,CAAC8D,KAAN,CAAYR,MAAZ,EAAoBS,MAApB,EAA4BC,OAA5B,EAAqCC,MAArC,EAA6C,IAA7C,CAAf,CAAX,CAAL;AACAlE,MAAAA,KAAK,CAAC2D,OAAD,EAAU1D,KAAK,CAAC6D,QAAN,CAAeP,MAAf,CAAV,CAAL;AAEA,aAAO,IAAInD,WAAJ,CAAgBsD,QAAhB,EAA0BC,OAA1B,EAAmC,IAAnC,CAAP;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;SACEW,M;AAAA,sBAAS;AACP,WAAKF,UAAL,CAAgBE,MAAhB,CAAuB3D,KAAvB,CAA6B,KAAKyD,UAAlC,EAA8CxD,SAA9C;AACA,aAAO,KAAKwD,UAAZ;AACD;;;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;SACE1E,I;AAAA,kBAAK6E,OAAL,EAA6C;AAAA,UAA/BC,OAA+B,uEAArB,UAAqB;AAAA,UAATC,OAAS;;AAC3C,WAAKnE,MAAL,+BAAwCH,OAAO,CAACuE,QAAR,CAAiBH,OAAjB,IAA4BA,OAAO,CAACnB,GAApC,GAA0C,KAAK,CAAvF,WAA8FoB,OAA9F;;AACAxE,MAAAA,KAAK,CAACuE,OAAD,EAAUhB,MAAV,CAAL;;AAEA,UAAI,CAACgB,OAAL,EAAc;AACZ,eAAO,EAAP;AACD;;AACD,aAAOrE,YAAY,CAACqE,OAAD,EAAUC,OAAV,EAAmBC,OAAnB,CAAnB;AACD;;;;;;EA1Q8C1E,Y;;AAA5BD,mB,CAKZ6E,S,GAAYxE,O;AALAL,mB,CAOZ8E,M,GAAS;AACdxB,EAAAA,GAAG,EAAE;AACHpB,IAAAA,IAAI,EAAEgC;AADH,GADS;AAIdrB,EAAAA,IAAI,EAAE;AACJX,IAAAA,IAAI,EAAEkC;AADF,GAJQ;AAOdlD,EAAAA,IAAI,EAAE;AACJgB,IAAAA,IAAI,EAAEgC;AADF,GAPQ;AAUdhC,EAAAA,IAAI,EAAE;AACJA,IAAAA,IAAI,EAAEgC;AADF,GAVQ;AAadxB,EAAAA,IAAI,EAAE;AACJR,IAAAA,IAAI,EAAEgC;AADF,GAbQ;AAgBdlC,EAAAA,OAAO,EAAE;AACPE,IAAAA,IAAI,EAAEiC;AADC,GAhBK;AAmBdhC,EAAAA,OAAO,EAAE;AACPD,IAAAA,IAAI,EAAEiC;AADC,GAnBK;AAsBd/B,EAAAA,OAAO,EAAE;AACPF,IAAAA,IAAI,EAAEiC;AADC,GAtBK;AAyBd9B,EAAAA,MAAM,EAAE;AACNH,IAAAA,IAAI,EAAEiC;AADA,GAzBM;AA4Bd7B,EAAAA,MAAM,EAAE;AACNJ,IAAAA,IAAI,EAAEiC;AADA,GA5BM;AA+Bd5B,EAAAA,KAAK,EAAE;AACLL,IAAAA,IAAI,EAAEiC;AADD,GA/BO;AAkCd3C,EAAAA,SAAS,EAAE;AACTU,IAAAA,IAAI,EAAEgC,MADG;AAETa,IAAAA,QAAQ,EAAE;AAFD,GAlCG;AAsCdnD,EAAAA,GAAG,EAAE;AACHM,IAAAA,IAAI,EAAEgC,MADH;AAEHa,IAAAA,QAAQ,EAAE;AAFP,GAtCS;AA0CdlD,EAAAA,gBAAgB,EAAE;AAChBK,IAAAA,IAAI,EAAEgC,MADU;AAEhBa,IAAAA,QAAQ,EAAE;AAFM,GA1CJ;AA8CdnC,EAAAA,IAAI,EAAE;AACJV,IAAAA,IAAI,EAAEgC,MADF;AAEJa,IAAAA,QAAQ,EAAE;AAFN,GA9CQ;AAkDd,eAAa;AACX7C,IAAAA,IAAI,EAAEgC,MADK;AAEXa,IAAAA,QAAQ,EAAE;AAFC,GAlDC;AAsDdxB,EAAAA,YAAY,EAAE;AACZrB,IAAAA,IAAI,EAAEgC;AADM,GAtDA;AAyDdjB,EAAAA,cAAc,EAAE;AACdf,IAAAA,IAAI,EAAEgC;AADQ,GAzDF;AA4Ddf,EAAAA,eAAe,EAAE;AACfjB,IAAAA,IAAI,EAAEgC;AADS,GA5DH;AA+Dd,YAAQ;AACNhC,IAAAA,IAAI,EAAEiC,OADA;AAENY,IAAAA,QAAQ,EAAE;AAFJ,GA/DM;AAmEdpC,EAAAA,IAAI,EAAE;AACJT,IAAAA,IAAI,EAAEuB,MADF;AAEJuB,IAAAA,QAAQ,EAAE,IAFN;AAGJD,IAAAA,QAAQ,EAAE;AAHN,GAnEQ;AAwEdjC,EAAAA,MAAM,EAAE;AACNZ,IAAAA,IAAI,EAAEgC,MADA;AAENa,IAAAA,QAAQ,EAAE;AAFJ,GAxEM;AA4EdE,EAAAA,SAAS,EAAE;AACT/C,IAAAA,IAAI,EAAEgD,IADG;AAETH,IAAAA,QAAQ,EAAE;AAFD,GA5EG;AAgFdhC,EAAAA,QAAQ,EAAE;AACRb,IAAAA,IAAI,EAAEuB,MADE;AAERuB,IAAAA,QAAQ,EAAE;AAFF;AAhFI,C","sourcesContent":["import { EventEmitter }            from 'eventemitter3';\nimport { check, Match }            from 'meteor/check';\nimport { formatFleURL, helpers }   from './lib.js';\nimport { FilesCursor, FileCursor } from './cursor.js';\n\nexport default class FilesCollectionCore extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  static __helpers = helpers;\n\n  static schema = {\n    _id: {\n      type: String\n    },\n    size: {\n      type: Number\n    },\n    name: {\n      type: String\n    },\n    type: {\n      type: String\n    },\n    path: {\n      type: String\n    },\n    isVideo: {\n      type: Boolean\n    },\n    isAudio: {\n      type: Boolean\n    },\n    isImage: {\n      type: Boolean\n    },\n    isText: {\n      type: Boolean\n    },\n    isJSON: {\n      type: Boolean\n    },\n    isPDF: {\n      type: Boolean\n    },\n    extension: {\n      type: String,\n      optional: true\n    },\n    ext: {\n      type: String,\n      optional: true\n    },\n    extensionWithDot: {\n      type: String,\n      optional: true\n    },\n    mime: {\n      type: String,\n      optional: true\n    },\n    'mime-type': {\n      type: String,\n      optional: true\n    },\n    _storagePath: {\n      type: String\n    },\n    _downloadRoute: {\n      type: String\n    },\n    _collectionName: {\n      type: String\n    },\n    public: {\n      type: Boolean,\n      optional: true\n    },\n    meta: {\n      type: Object,\n      blackbox: true,\n      optional: true\n    },\n    userId: {\n      type: String,\n      optional: true\n    },\n    updatedAt: {\n      type: Date,\n      optional: true\n    },\n    versions: {\n      type: Object,\n      blackbox: true\n    }\n  };\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _debug\n   * @summary Print logs in debug mode\n   * @returns {void}\n   */\n  _debug() {\n    if (this.debug) {\n      (console.info || console.log || function () { }).apply(void 0, arguments);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getFileName\n   * @param {Object} fileData - File Object\n   * @summary Returns file's name\n   * @returns {String}\n   */\n  _getFileName(fileData) {\n    const fileName = fileData.name || fileData.fileName;\n    if (helpers.isString(fileName) && (fileName.length > 0)) {\n      return (fileData.name || fileData.fileName).replace(/^\\.\\.+/, '').replace(/\\.{2,}/g, '.').replace(/\\//g, '');\n    }\n    return '';\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _getExt\n   * @param {String} FileName - File name\n   * @summary Get extension from FileName\n   * @returns {Object}\n   */\n  _getExt(fileName) {\n    if (fileName.includes('.')) {\n      const extension = (fileName.split('.').pop().split('?')[0] || '').toLowerCase();\n      return { ext: extension, extension, extensionWithDot: `.${extension}` };\n    }\n    return { ext: '', extension: '', extensionWithDot: '' };\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _updateFileTypes\n   * @param {Object} data - File data\n   * @summary Internal method. Classify file based on 'type' field\n   */\n  _updateFileTypes(data) {\n    data.isVideo  = /^video\\//i.test(data.type);\n    data.isAudio  = /^audio\\//i.test(data.type);\n    data.isImage  = /^image\\//i.test(data.type);\n    data.isText   = /^text\\//i.test(data.type);\n    data.isJSON   = /^application\\/json$/i.test(data.type);\n    data.isPDF    = /^application\\/(x-)?pdf$/i.test(data.type);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name _dataToSchema\n   * @param {Object} data - File data\n   * @summary Internal method. Build object in accordance with default schema from File data\n   * @returns {Object}\n   */\n  _dataToSchema(data) {\n    const ds = {\n      name: data.name,\n      extension: data.extension,\n      ext: data.extension,\n      extensionWithDot: '.' + data.extension,\n      path: data.path,\n      meta: data.meta,\n      type: data.type,\n      mime: data.type,\n      'mime-type': data.type,\n      size: data.size,\n      userId: data.userId || null,\n      versions: {\n        original: {\n          path: data.path,\n          size: data.size,\n          type: data.type,\n          extension: data.extension\n        }\n      },\n      _downloadRoute: data._downloadRoute || this.downloadRoute,\n      _collectionName: data._collectionName || this.collectionName\n    };\n\n    //Optional fileId\n    if (data.fileId) {\n      ds._id = data.fileId;\n    }\n\n    this._updateFileTypes(ds);\n    ds._storagePath = data._storagePath || this.storagePath(Object.assign({}, data, ds));\n    return ds;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name findOne\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object} options - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching document Object\n   * @returns {FileCursor} Instance\n   */\n  findOne(selector = {}, options) {\n    this._debug(`[FilesCollection] [findOne(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    const doc = this.collection.findOne(selector, options);\n    if (doc) {\n      return new FileCursor(doc, this);\n    }\n    return doc;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name find\n   * @param {String|Object} selector - Mongo-Style selector (http://docs.meteor.com/api/collections.html#selectors)\n   * @param {Object}        options  - Mongo-Style selector Options (http://docs.meteor.com/api/collections.html#sortspecifiers)\n   * @summary Find and return Cursor for matching documents\n   * @returns {FilesCursor} Instance\n   */\n  find(selector = {}, options) {\n    this._debug(`[FilesCollection] [find(${JSON.stringify(selector)}, ${JSON.stringify(options)})]`);\n    check(selector, Match.Optional(Match.OneOf(Object, String, Boolean, Number, null)));\n    check(options, Match.Optional(Object));\n\n    return new FilesCursor(selector, options, this);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name update\n   * @see http://docs.meteor.com/#/full/update\n   * @summary link Mongo.Collection update method\n   * @returns {Mongo.Collection} Instance\n   */\n  update() {\n    this.collection.update.apply(this.collection, arguments);\n    return this.collection;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf FilesCollectionCore\n   * @name link\n   * @param {Object} fileRef - File reference object\n   * @param {String} version - Version of file you would like to request\n   * @param {String} URIBase - [Optional] URI base, see - https://github.com/VeliovGroup/Meteor-Files/issues/626\n   * @summary Returns downloadable URL\n   * @returns {String} Empty string returned in case if file not found in DB\n   */\n  link(fileRef, version = 'original', URIBase) {\n    this._debug(`[FilesCollection] [link(${(helpers.isObject(fileRef) ? fileRef._id : void 0)}, ${version})]`);\n    check(fileRef, Object);\n\n    if (!fileRef) {\n      return '';\n    }\n    return formatFleURL(fileRef, version, URIBase);\n  }\n}\n"]},"sourceType":"module","hash":"cb8bc81268cfd4f7dedc757fd76ce0a144eb2d09"}
